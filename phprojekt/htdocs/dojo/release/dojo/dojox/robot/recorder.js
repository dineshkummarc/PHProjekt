/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.robot.recorder"]||(dojo._hasResource["dojox.robot.recorder"]=!0,dojo.provide("dojox.robot.recorder"),dojo.experimental("dojox.robot.recorder"),function(){var g=[],r=0,h=null,j=null,f=function(a,b){if(!(h==null||a=="doh.robot.keyPress"&&b[0]==dojo.keys.ENTER&&eval("("+b[2]+")").ctrl&&eval("("+b[2]+")").alt)){var c=Math.max(Math.min(Math.round((new Date).getTime()-j.getTime()),1E4),1);a=="doh.robot.mouseMove"?b[2]=c:b[1]=c;g.push({name:a,args:b});j=new Date}},s=function(){var a=
g;a[0].name=="doh.robot.keyPress"&&(a[0].args[0]==dojo.keys.ENTER||a[0].args[0]==77)&&a.splice(0,1);for(var b=a.length-1;b>=a.length-2&&b>=0;b--)(a[b].name=="doh.robot.keyPress"&&a[b].args[0]==dojo.keys.ALT||a[b].args[0]==dojo.keys.CTRL)&&a.splice(b,1);for(b=0;b<a.length;b++){var c,d;if(a[b+1]&&a[b].name=="doh.robot.mouseMove"&&a[b+1].name==a[b].name&&a[b+1].args[2]<500){c=a[b+1];for(d=0;c&&c.name==a[b].name&&c.args[2]<500;)a.splice(b+1,1),d+=c.args[2],a[b].args[0]=c.args[0],a[b].args[1]=c.args[1],
c=a[b+1];a[b].args[3]=d}else if(a[b+1]&&a[b].name=="doh.robot.mouseWheel"&&a[b+1].name==a[b].name&&a[b+1].args[1]<500){c=a[b+1];for(d=0;c&&c.name==a[b].name&&c.args[1]<500;)a.splice(b+1,1),d+=c.args[1],a[b].args[0]+=c.args[0],c=a[b+1];a[b].args[2]=d}else if(a[b+2]&&a[b].name=="doh.robot.mouseMoveAt"&&a[b+2].name=="doh.robot.scrollIntoView")c=a.splice(b+2,1)[0],a.splice(b,0,c);else if(a[b+1]&&a[b].name=="doh.robot.mousePress"&&a[b+1].name=="doh.robot.mouseRelease"&&a[b].args[0]==a[b+1].args[0])a[b].name=
"doh.robot.mouseClick",a.splice(b+1,1),a[b+1]&&a[b+1].name=="doh.robot.mouseClick"&&a[b].args[0]==a[b+1].args[0]&&a.splice(b+1,1);else if(a[b+1]&&a[b-1]&&a[b-1].name=="doh.robot.mouseMoveAt"&&a[b].name=="doh.robot.mousePress"&&a[b+1].name=="doh.robot.mouseMove")a.splice(b+1,0,{name:"doh.robot.mouseMoveAt",args:[a[b-1].args[0],1,100,a[b-1].args[3]+1,a[b-1].args[4]]});else if(a[b+1]&&(a[b].name=="doh.robot.keyPress"&&typeof a[b].args[0]=="string"||a[b].name=="doh.robot.typeKeys")&&a[b+1].name=="doh.robot.keyPress"&&
typeof a[b+1].args[0]=="string"&&a[b+1].args[1]<=1E3&&!eval("("+a[b].args[2]+")").ctrl&&!eval("("+a[b].args[2]+")").alt&&!eval("("+a[b+1].args[2]+")").ctrl&&!eval("("+a[b+1].args[2]+")").alt){a[b].name="doh.robot.typeKeys";a[b].args.splice(3,1);c=a[b+1];for(d=0;c&&c.name=="doh.robot.keyPress"&&typeof c.args[0]=="string"&&c.args[1]<=1E3&&!eval("("+c.args[2]+")").ctrl&&!eval("("+c.args[2]+")").alt;)a.splice(b+1,1),a[b].args[0]+=c.args[0],d+=c.args[1],c=a[b+1];a[b].args[2]=d;a[b].args[0]="'"+a[b].args[0]+
"'"}else if(a[b].name=="doh.robot.keyPress")if(typeof a[b].args[0]=="string")a[b].args[0]="'"+a[b].args[0]+"'";else if(a[b].args[0]==0)a.splice(b,1);else for(var e in dojo.keys)if(dojo.keys[e]==a[b].args[0]){a[b].args[0]="dojo.keys."+e;break}}},t=function(){var a=Math.round((new Date).getTime()-h.getTime());h=null;s();var b=g;console.log("Stop called. Commands: "+b.length);if(b.length){var c="doh.register('dojox.robot.AutoGeneratedTestGroup',{\n";c+="     name: 'autotest"+r++ +"',\n";c+="     timeout: "+
(a+2E3)+",\n";c+="     runTest: function(){\n";c+="          var d = new doh.Deferred();\n";for(a=0;a<b.length;a++){c+="          "+b[a].name+"(";for(var d=0;d<b[a].args.length;d++)c+=b[a].args[d],d!=b[a].args.length-1&&(c+=", ");c+=");\n"}c+="          doh.robot.sequence(function(){\n";c+="               if(/*Your condition here*/){\n";c+="                    d.callback(true);\n";c+="               }else{\n";c+="                    d.errback(new Error('We got a failure'));\n";c+="               }\n";
c+="          }, 1000);\n";c+="          return d;\n";c+="     }\n";c+="});\n";var e=document.createElement("div");e.id="dojox.robot.recorder";e.style.backgroundColor="white";e.style.position="absolute";b={y:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,x:window.pageXOffset||(window.dojo?dojo._fixIeBiDiScrollLeft(document.documentElement.scrollLeft):void 0)||document.body.scrollLeft||0};e.style.left=b.x+"px";e.style.top=b.y+"px";b=document.createElement("h1");
b.innerHTML="Your code:";e.appendChild(b);b=document.createElement("pre");b.innerText!==void 0?b.innerText=c:b.textContent=c;e.appendChild(b);c=document.createElement("button");c.innerHTML="Close";var f=dojo.connect(c,"onmouseup",function(a){dojo.stopEvent(a);document.body.removeChild(e);dojo.disconnect(f)});e.appendChild(c);document.body.appendChild(e);g=[]}},i=function(a){if(typeof a=="string")return"'"+a+"'";else if(a.id)return"'"+a.id+"'";else{var b=document.getElementsByTagName(a.nodeName),c;
for(c=0;c<b.length;c++)if(b[c]==a)break;return"function(){ return document.getElementsByTagName('"+a.nodeName+"')["+c+"]; }"}},k=function(a){return"{left:"+(a==0)+", middle:"+(a==1)+", right:"+(a==2)+"}"};dojo.connect(document,"onkeydown",function(a){if((a.keyCode==dojo.keys.ENTER||a.keyCode==77)&&a.ctrlKey&&a.altKey)dojo.stopEvent(a),h?t():(alert("Started recording."),g=[],h=new Date,j=new Date)});var d={type:""},l=function(a){if(a&&!(d.type==a.type&&d.button==a.button)){d={type:a.type,button:a.button};
var b=i(a.target),c=dojo.coords(a.target);f("doh.robot.mouseMoveAt",[b,0,100,a.clientX-c.x,a.clientY-c.y]);f("doh.robot.mousePress",[k(a.button-(dojo.isIE?1:0)),0])}},m=function(a){a&&!(d.type==a.type&&d.button==a.button)&&(d={type:a.type,button:a.button},i(a.target),dojo.coords(a.target),f("doh.robot.mouseClick",[k(a.button-(dojo.isIE?1:0)),0]))},n=function(a){a&&!(d.type==a.type&&d.button==a.button)&&(d={type:a.type,button:a.button},i(a.target),dojo.coords(a.target),f("doh.robot.mouseRelease",[k(a.button-
(dojo.isIE?1:0)),0]))},o=function(a){a&&!(d.type==a.type&&d.pageX==a.pageX&&d.pageY==a.pageY)&&(d={type:a.type,detail:a.detail?a.detail:-a.wheelDelta/120},f("doh.robot.mouseWheel",[d.detail]))},p=function(a){a&&!(d.type==a.type&&d.charCode==a.charCode&&d.keyCode==a.keyCode)&&(d={type:a.type,charCode:a.charCode,keyCode:a.keyCode},f("doh.robot.keyPress",[a.charOrCode==dojo.keys.SPACE?" ":a.charOrCode,0,"{'shift':"+a.shiftKey+", 'ctrl':"+a.ctrlKey+", 'alt':"+a.altKey+"}"]))},q=function(a){a&&!(d.type==
a.type&&d.charCode==a.charCode&&d.keyCode==a.keyCode)&&(d={type:a.type,charCode:a.charCode,keyCode:a.keyCode})};dojo.connect(document,"onmousedown",l);dojo.connect(document,"onmouseup",n);dojo.connect(document,"onclick",m);dojo.connect(document,"onkeypress",p);dojo.connect(document,"onkeyup",q);dojo.connect(document,"onmousemove",function(a){a&&!(d.type==a.type&&d.pageX==a.pageX&&d.pageY==a.pageY)&&(d={type:a.type,pageX:a.pageX,pageY:a.pageY},f("doh.robot.mouseMove",[a.pageX,a.pageY,0,100,!0]))});
dojo.connect(document,!dojo.isMozilla?"onmousewheel":"DOMMouseScroll",o);dojo.addOnLoad(function(){dojo.window&&dojo.connect(dojo.window,"scrollIntoView",function(a){f("doh.robot.scrollIntoView",[i(a)])})});dojo.connect(dojo,"connect",function(a,b,c){if(a&&(!c||!c._mine))if(c=null,b.toLowerCase()=="onmousedown"?c=dojo.hitch(this,l):b.toLowerCase()==(!dojo.isMozilla?"onmousewheel":"dommousescroll")?c=dojo.hitch(this,o):b.toLowerCase()=="onclick"?c=dojo.hitch(this,m):b.toLowerCase()=="onmouseup"?c=
dojo.hitch(this,n):b.toLowerCase()=="onkeypress"?c=dojo.hitch(this,p):b.toLowerCase()=="onkeyup"&&(c=dojo.hitch(this,q)),c!=null)c._mine=!0,dojo.connect(a,b,c)})}());