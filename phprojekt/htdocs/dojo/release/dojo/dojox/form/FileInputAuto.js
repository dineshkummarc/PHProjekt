/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.form.FileInputAuto"]||(dojo._hasResource["dojox.form.FileInputAuto"]=!0,dojo.provide("dojox.form.FileInputAuto"),dojo.require("dojox.form.FileInput"),dojo.require("dojo.io.iframe"),dojo.declare("dojox.form.FileInputAuto",dojox.form.FileInput,{url:"",blurDelay:2E3,duration:500,uploadMessage:"Uploading ...",triggerEvent:"onblur",_sent:!1,templateString:dojo.cache("dojox.form","resources/FileInputAuto.html",'<div class="dijitFileInput">\n\t<input id="${id}" name="${name}" class="dijitFileInputReal" type="file" dojoAttachPoint="fileInput" />\n\t<div class="dijitFakeInput" dojoAttachPoint="fakeNodeHolder">\n\t\t<input class="dijitFileInputVisible" type="text" dojoAttachPoint="focusNode, inputNode" />\n\t\t<div class="dijitInline dijitFileInputText" dojoAttachPoint="titleNode">${label}</div>\n\t\t<div class="dijitInline dijitFileInputButton" dojoAttachPoint="cancelNode" dojoAttachEvent="onclick:reset">${cancelText}</div>\n\t</div>\n\t<div class="dijitProgressOverlay" dojoAttachPoint="overlay">&nbsp;</div>\n</div>\n'),
onBeforeSend:function(){return{}},startup:function(){this._blurListener=this.connect(this.fileInput,this.triggerEvent,"_onBlur");this._focusListener=this.connect(this.fileInput,"onfocus","_onFocus");this.inherited(arguments)},_onFocus:function(){this._blurTimer&&clearTimeout(this._blurTimer)},_onBlur:function(){this._blurTimer&&clearTimeout(this._blurTimer);if(!this._sent)this._blurTimer=setTimeout(dojo.hitch(this,"_sendFile"),this.blurDelay)},setMessage:function(a){this.overlay.removeChild(this.overlay.firstChild);
this.overlay.appendChild(document.createTextNode(a))},_sendFile:function(){if(!this._sent&&!this._sending&&this.fileInput.value){this._sending=!0;dojo.style(this.fakeNodeHolder,"display","none");dojo.style(this.overlay,{opacity:0,display:"block"});this.setMessage(this.uploadMessage);dojo.fadeIn({node:this.overlay,duration:this.duration}).play();var a;dojo.isIE<9||dojo.isIE&&dojo.isQuirks?(a=document.createElement('<form enctype="multipart/form-data" method="post">'),a.encoding="multipart/form-data"):
(a=document.createElement("form"),a.setAttribute("enctype","multipart/form-data"));a.appendChild(this.fileInput);dojo.body().appendChild(a);dojo.io.iframe.send({url:this.url,form:a,handleAs:"json",handle:dojo.hitch(this,"_handleSend"),content:this.onBeforeSend()})}},_handleSend:function(a,b){this.overlay.removeChild(this.overlay.firstChild);this._sent=!0;this._sending=!1;dojo.style(this.overlay,{opacity:0,border:"none",background:"none"});this.overlay.style.backgroundImage="none";this.fileInput.style.display=
"none";this.fakeNodeHolder.style.display="none";dojo.fadeIn({node:this.overlay,duration:this.duration}).play(250);this.disconnect(this._blurListener);this.disconnect(this._focusListener);dojo.body().removeChild(b.args.form);this.fileInput=null;this.onComplete(a,b,this)},reset:function(a){this._blurTimer&&clearTimeout(this._blurTimer);this.disconnect(this._blurListener);this.disconnect(this._focusListener);this.overlay.style.display="none";this.fakeNodeHolder.style.display="";this.inherited(arguments);
this._sending=this._sent=!1;this._blurListener=this.connect(this.fileInput,this.triggerEvent,"_onBlur");this._focusListener=this.connect(this.fileInput,"onfocus","_onFocus")},onComplete:function(){}}),dojo.declare("dojox.form.FileInputBlind",dojox.form.FileInputAuto,{startup:function(){this.inherited(arguments);this._off=dojo.style(this.inputNode,"width");this.inputNode.style.display="none";this._fixPosition()},_fixPosition:function(){dojo.isIE?dojo.style(this.fileInput,"width","1px"):dojo.style(this.fileInput,
"left","-"+this._off+"px")},reset:function(a){this.inherited(arguments);this._fixPosition()}}));