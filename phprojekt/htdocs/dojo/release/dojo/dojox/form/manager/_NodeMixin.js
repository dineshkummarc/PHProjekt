/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.form.manager._NodeMixin"]||(dojo._hasResource["dojox.form.manager._NodeMixin"]=!0,dojo.provide("dojox.form.manager._NodeMixin"),dojo.require("dojox.form.manager._Mixin"),function(){var f=dojox.form.manager,h=f.actionAdapter,l=f._keys,m=f.changeEvent=function(a){var c="onclick";switch(a.tagName.toLowerCase()){case "textarea":c="onkeyup";break;case "select":c="onchange";break;case "input":switch(a.type.toLowerCase()){case "text":case "password":c="onkeyup"}}return c},i=function(a,
c){var d=dojo.attr(a,"name"),c=c||this.domNode;if(d&&!(d in this.formWidgets)){for(var b=a;b&&b!==c;b=b.parentNode)if(dojo.attr(b,"widgetId")&&dijit.byNode(b)instanceof dijit.form._FormWidget)return null;a.tagName.toLowerCase()=="input"&&a.type.toLowerCase()=="radio"?(b=(b=this.formNodes[d])&&b.node)&&dojo.isArray(b)?b.push(a):this.formNodes[d]={node:[a],connections:[]}:this.formNodes[d]={node:a,connections:[]}}else d=null;return d},j=function(a){var c={};h(function(a,b){var e=dojo.attr(b,"observer");
e&&typeof e=="string"&&dojo.forEach(e.split(","),function(a){(a=dojo.trim(a))&&dojo.isFunction(this[a])&&(c[a]=1)},this)}).call(this,null,this.formNodes[a].node);return l(c)},k=function(a,c){var d=this.formNodes[a],b=d.connections;if(b.length)dojo.forEach(b,dojo.disconnect),b=d.connections=[];h(function(d,g){var f=m(g);dojo.forEach(c,function(c){b.push(dojo.connect(g,f,this,function(b){if(this.watching)this[c](this.formNodeValue(a),a,g,b)}))},this)}).call(this,null,d.node)};dojo.declare("dojox.form.manager._NodeMixin",
null,{destroy:function(){for(var a in this.formNodes)dojo.forEach(this.formNodes[a].connections,dojo.disconnect);this.formNodes={};this.inherited(arguments)},registerNode:function(a){typeof a=="string"&&(a=dojo.byId(a));(a=i.call(this,a))&&k.call(this,a,j.call(this,a));return this},unregisterNode:function(a){a in this.formNodes&&(dojo.forEach(this.formNodes[a].connections,this.disconnect,this),delete this.formNodes[a]);return this},registerNodeDescendants:function(a){typeof a=="string"&&(a=dojo.byId(a));
dojo.query("input, select, textarea, button",a).map(function(c){return i.call(this,c,a)},this).forEach(function(a){a&&k.call(this,a,j.call(this,a))},this);return this},unregisterNodeDescendants:function(a){typeof a=="string"&&(a=dojo.byId(a));dojo.query("input, select, textarea, button",a).map(function(){return dojo.attr(a,"name")||null}).forEach(function(a){a&&this.unregisterNode(a)},this);return this},formNodeValue:function(a,c){var d=arguments.length==2&&c!==void 0,b;if(typeof a=="string"&&(a=
this.formNodes[a]))a=a.node;if(!a)return null;if(dojo.isArray(a)){if(d)return dojo.forEach(a,function(a){a.checked=""}),dojo.forEach(a,function(a){a.checked=a.value===c?"checked":""}),this;dojo.some(a,function(a){return a.checked?(b=a,!0):!1});return b?b.value:""}switch(a.tagName.toLowerCase()){case "select":if(a.multiple){if(d){if(dojo.isArray(c)){var e={};dojo.forEach(c,function(a){e[a]=1});dojo.query("> option",a).forEach(function(a){a.selected=a.value in e});return this}dojo.query("> option",
a).forEach(function(a){a.selected=a.value===c});return this}b=dojo.query("> option",a).filter(function(a){return a.selected}).map(function(a){return a.value});return b.length==1?b[0]:b}return d?(dojo.query("> option",a).forEach(function(a){a.selected=a.value===c}),this):a.value||"";case "button":return d?(a.innerHTML=""+c,this):a.innerHTML;case "input":if(a.type.toLowerCase()=="checkbox")return d?(a.checked=c?"checked":"",this):Boolean(a.checked)}return d?(a.value=""+c,this):a.value},inspectFormNodes:function(a,
c,d){var b,e={};if(c)if(dojo.isArray(c))dojo.forEach(c,function(b){b in this.formNodes&&(e[b]=a.call(this,b,this.formNodes[b].node,d))},this);else for(b in c)b in this.formNodes&&(e[b]=a.call(this,b,this.formNodes[b].node,c[b]));else for(b in this.formNodes)e[b]=a.call(this,b,this.formNodes[b].node,d);return e}})}());