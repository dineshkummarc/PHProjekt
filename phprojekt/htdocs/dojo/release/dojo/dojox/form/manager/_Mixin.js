/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.form.manager._Mixin"]||(dojo._hasResource["dojox.form.manager._Mixin"]=!0,dojo.provide("dojox.form.manager._Mixin"),dojo.require("dijit._Widget"),function(){var g=dojox.form.manager,k=g.actionAdapter=function(a){return function(b,d,c){dojo.isArray(d)?dojo.forEach(d,function(d){a.call(this,b,d,c)},this):a.apply(this,arguments)}};g.inspectorAdapter=function(a){return function(b,d,c){return a.call(this,b,dojo.isArray(d)?d[0]:d,c)}};var l={domNode:1,containerNode:1,srcNodeRef:1,
bgIframe:1},m=g._keys=function(a){var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d);return b},h=function(a){var b=a.get("name");if(b&&a instanceof dijit.form._FormWidget)if(b in this.formWidgets){var d=this.formWidgets[b].widget;dojo.isArray(d)?d.push(a):this.formWidgets[b].widget=[d,a]}else this.formWidgets[b]={widget:a,connections:[]};else b=null;return b},i=function(a){var b={};k(function(a,c){var e=c.get("observer");e&&typeof e=="string"&&dojo.forEach(e.split(","),function(a){(a=dojo.trim(a))&&
dojo.isFunction(this[a])&&(b[a]=1)},this)}).call(this,null,this.formWidgets[a].widget);return m(b)},j=function(a,b){var d=this.formWidgets[a],c=d.widget,e=d.connections;if(e.length)dojo.forEach(e,dojo.disconnect),e=d.connections=[];if(dojo.isArray(c))dojo.forEach(c,function(c){dojo.forEach(b,function(b){e.push(dojo.connect(c,"onChange",this,function(d){if(this.watching&&dojo.attr(c.focusNode,"checked"))this[b](c.get("value"),a,c,d)}))},this)},this);else{var f=c.declaredClass=="dijit.form.Button"?
"onClick":"onChange";dojo.forEach(b,function(b){e.push(dojo.connect(c,f,this,function(d){if(this.watching)this[b](c.get("value"),a,c,d)}))},this)}};dojo.declare("dojox.form.manager._Mixin",null,{watching:!0,startup:function(){if(!this._started)this.formWidgets={},this.formNodes={},this.registerWidgetDescendants(this),this.inherited(arguments)},destroy:function(){for(var a in this.formWidgets)dojo.forEach(this.formWidgets[a].connections,dojo.disconnect);this.formWidgets={};this.inherited(arguments)},
registerWidget:function(a){typeof a=="string"?a=dijit.byId(a):a.tagName&&a.cloneNode&&(a=dijit.byNode(a));(a=h.call(this,a))&&j.call(this,a,i.call(this,a));return this},unregisterWidget:function(a){a in this.formWidgets&&(dojo.forEach(this.formWidgets[a].connections,this.disconnect,this),delete this.formWidgets[a]);return this},registerWidgetDescendants:function(a){typeof a=="string"?a=dijit.byId(a):a.tagName&&a.cloneNode&&(a=dijit.byNode(a));var b=dojo.map(a.getDescendants(),h,this);dojo.forEach(b,
function(a){a&&j.call(this,a,i.call(this,a))},this);return this.registerNodeDescendants?this.registerNodeDescendants(a.domNode):this},unregisterWidgetDescendants:function(a){typeof a=="string"?a=dijit.byId(a):a.tagName&&a.cloneNode&&(a=dijit.byNode(a));dojo.forEach(dojo.map(a.getDescendants(),function(a){return a instanceof dijit.form._FormWidget&&a.get("name")||null}),function(a){a&&this.unregisterNode(a)},this);return this.unregisterNodeDescendants?this.unregisterNodeDescendants(a.domNode):this},
formWidgetValue:function(a,b){var d=arguments.length==2&&b!==void 0,c;if(typeof a=="string"&&(a=this.formWidgets[a]))a=a.widget;if(!a)return null;if(dojo.isArray(a)){if(d)return dojo.forEach(a,function(a){a.set("checked",!1,!this.watching)}),dojo.forEach(a,function(a){a.set("checked",a.value===b,!this.watching)}),this;dojo.some(a,function(a){return dojo.attr(a.focusNode,"checked")?(c=a,!0):!1});return c?c.get("value"):""}return a.declaredClass=="dijit.form.CheckBox"?d?(a.set("value",Boolean(b),!this.watching),
this):Boolean(a.get("value")):d?(a.set("value",b,!this.watching),this):a.get("value")},formPointValue:function(a,b){a&&typeof a=="string"&&(a=this[a]);return!a||!a.tagName||!a.cloneNode?null:!dojo.hasClass(a,"dojoFormValue")?null:arguments.length==2&&b!==void 0?(a.innerHTML=b,this):a.innerHTML},inspectFormWidgets:function(a,b,d){var c,e={};if(b)if(dojo.isArray(b))dojo.forEach(b,function(b){b in this.formWidgets&&(e[b]=a.call(this,b,this.formWidgets[b].widget,d))},this);else for(c in b)c in this.formWidgets&&
(e[c]=a.call(this,c,this.formWidgets[c].widget,b[c]));else for(c in this.formWidgets)e[c]=a.call(this,c,this.formWidgets[c].widget,d);return e},inspectAttachedPoints:function(a,b,d){var c,e={};if(b)if(dojo.isArray(b))dojo.forEach(b,function(b){var c=this[b];c&&c.tagName&&c.cloneNode&&(e[b]=a.call(this,b,c,d))},this);else for(c in b){var f=this[c];f&&f.tagName&&f.cloneNode&&(e[c]=a.call(this,c,f,b[c]))}else for(c in this)c in l||(f=this[c])&&f.tagName&&f.cloneNode&&(e[c]=a.call(this,c,f,d));return e},
inspect:function(a,b,d){var c=this.inspectFormWidgets(function(b,c,d){return dojo.isArray(c)?a.call(this,b,dojo.map(c,function(a){return a.domNode}),d):a.call(this,b,c.domNode,d)},b,d);this.inspectFormNodes&&dojo.mixin(c,this.inspectFormNodes(a,b,d));return dojo.mixin(c,this.inspectAttachedPoints(a,b,d))}})}(),dojo.extend(dijit._Widget,{observer:""}));