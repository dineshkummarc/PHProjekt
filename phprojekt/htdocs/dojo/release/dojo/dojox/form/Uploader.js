/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.form.Uploader"]||(dojo._hasResource["dojox.form.Uploader"]=!0,dojo.provide("dojox.form.Uploader"),dojo.experimental("dojox.form.Uploader"),dojo.require("dojox.form.uploader.Base"),dojo.require("dijit.form.Button"),dojo.declare("dojox.form.Uploader",[dojox.form.uploader.Base],{uploadOnSelect:!1,tabIndex:0,multiple:!1,label:"Upload...",url:"",name:"uploadedfile",flashFieldName:"",uploadType:"form",_nameIndex:0,widgetsInTemplate:!0,templateString:'<div class="dojoxFileInput"><div dojoType="dijit.form.Button" dojoAttachPoint="button">${label}</div></div>',
postMixInProperties:function(){this._inputs=[];this._getButtonStyle(this.srcNodeRef);this.inherited(arguments)},postCreate:function(){var a=!1,b=this._getNodePosition(this.domNode);if(!this.btnSize.w||!this.btnSize.h)dojo.body().appendChild(this.domNode),this._getButtonStyle(this.domNode),a=!0;this._setButtonStyle();a&&dojo.place(this.domNode,b.node,b.pos);this.inherited(arguments)},onChange:function(){},onBegin:function(){},onProgress:function(){},onComplete:function(){this.reset()},onCancel:function(){},
onAbort:function(){},onError:function(){},upload:function(){},submit:function(){},reset:function(){this._disconnectButton();dojo.forEach(this._inputs,dojo.destroy,dojo);this._inputs=[];this._nameIndex=0;this._createInput()},getFileList:function(){var a=[];this.supports("multiple")?dojo.forEach(this.inputNode.files,function(b,c){a.push({index:c,name:b.name,size:b.size,type:b.type})},this):dojo.forEach(this._inputs,function(b,c){a.push({index:c,name:b.value.substring(b.value.lastIndexOf("\\")+1),size:0,
type:b.value.substring(b.value.lastIndexOf(".")+1)})},this);return a},_getValueAttr:function(){return this.getFileList()},_setValueAttr:function(){console.error("Uploader value is read only")},_getDisabledAttr:function(){return this._disabled},_setDisabledAttr:function(a){this._disabled!=a&&(this.button.set("disabled",a),dojo.style(this.inputNode,"display",a?"none":"block"))},_getNodePosition:function(a){return a.previousSibling?{node:a.previousSibling,pos:"after"}:{node:a.nextSibling,pos:"before"}},
_getButtonStyle:function(a){this.btnSize=a?dojo.marginBox(a):{w:200,h:25}},_setButtonStyle:function(){var a=!0;if(!this.domNode.parentNode||!this.domNode.parentNode.tagName)document.body.appendChild(this.domNode),a=!1;dojo.style(this.domNode,{width:this.btnSize.w+"px",height:this.btnSize.h+4+"px",overflow:"hidden",position:"relative"});this.inputNodeFontSize=Math.max(2,Math.max(Math.ceil(this.btnSize.w/60),Math.ceil(this.btnSize.h/15)));this._createInput();dojo.style(this.button.domNode,{margin:"0px",
display:"block",verticalAlign:"top"});dojo.style(this.button.domNode.firstChild,{margin:"0px",display:"block"});a||document.body.removeChild(this.domNode)},_createInput:function(){this._inputs.length&&(dojo.style(this.inputNode,{top:"500px"}),this._disconnectButton(),this._nameIndex++);var a;a=this.supports("multiple")?this.name+"s[]":this.name+(this.multiple?this._nameIndex:"");this.inputNode=dojo.create("input",{type:"file",name:a,className:"dojoxInputNode"},this.domNode,"first");this.supports("multiple")&&
this.multiple&&dojo.attr(this.inputNode,"multiple",!0);this._inputs.push(this.inputNode);dojo.style(this.inputNode,{fontSize:this.inputNodeFontSize+"em"});a=dojo.marginBox(this.inputNode);dojo.style(this.inputNode,{position:"absolute",top:"-2px",left:"-"+(a.w-this.btnSize.w-2)+"px",opacity:0});this._connectButton()},_connectButton:function(){this._cons=[];var a=dojo.hitch(this,function(a){this._cons.push(dojo.connect(this.inputNode,a,this,function(){this.button._cssMouseEvent({type:a})}))});a("mouseover");
a("mouseout");a("mousedown");this._cons.push(dojo.connect(this.inputNode,"change",this,function(a){this.onChange(this.getFileList(a));!this.supports("multiple")&&this.multiple&&this._createInput()}));this.button.set("tabIndex",-1);if(this.tabIndex>-1){this.inputNode.tabIndex=this.tabIndex;var b=dojo.style(this.button.domNode.firstChild,"border");this._cons.push(dojo.connect(this.inputNode,"focus",this,function(){dojo.style(this.button.domNode.firstChild,"border","1px dashed #ccc")}));this._cons.push(dojo.connect(this.inputNode,
"blur",this,function(){dojo.style(this.button.domNode.firstChild,"border",b)}))}},_disconnectButton:function(){dojo.forEach(this._cons,dojo.disconnect,dojo)}}),function(){dojox.form.UploaderOrg=dojox.form.Uploader;var a=[dojox.form.UploaderOrg];dojox.form.addUploaderPlugin=function(b){a.push(b);dojo.declare("dojox.form.Uploader",a,{})}}());