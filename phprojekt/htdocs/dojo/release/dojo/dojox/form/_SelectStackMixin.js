/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.form._SelectStackMixin"]||(dojo._hasResource["dojox.form._SelectStackMixin"]=!0,dojo.provide("dojox.form._SelectStackMixin"),dojo.declare("dojox.form._SelectStackMixin",null,{stackId:"",stackPrefix:"",_paneIdFromOption:function(a){return(this.stackPrefix||"")+a},_optionValFromPane:function(a){var b=this.stackPrefix;return b&&a.indexOf(b)===0?a.substring(b.length):a},_togglePane:function(a,b){if(!(a._shown!=void 0&&a._shown==b)){var c=dojo.filter(a.getDescendants(),"return item.name;");
if(b){var d=a._savedStates||{};dojo.forEach(c,function(a){var b=d[a.id];b==void 0&&(b=!1);a.set("disabled",b)});delete a._savedStates}else d={},dojo.forEach(c,function(a){d[a.id]=a.disabled;a.set("disabled",!0)}),a._savedStates=d;a._shown=b}},_connectTitle:function(a,b){var c=dojo.hitch(this,function(a){this.updateOption({value:b,label:a})});a._setTitleAttr?this.connect(a,"_setTitleAttr",c):this.connect(a,"attr",function(a,b){a=="title"&&arguments.length>1&&c(b)})},onAddChild:function(a){if(!this._panes[a.id]){this._panes[a.id]=
a;var b=this._optionValFromPane(a.id);this.addOption({value:b,label:a.title});this._connectTitle(a,b)}if(!a.onShow||!a.onHide||a._shown==void 0)a.onShow=dojo.hitch(this,"_togglePane",a,!0),a.onHide=dojo.hitch(this,"_togglePane",a,!1),a.onHide()},_setValueAttr:function(a){"_savedValue"in this||this.inherited(arguments)},attr:function(a,b){if(a=="value"&&arguments.length==2&&"_savedValue"in this)this._savedValue=b;return this.inherited(arguments)},onRemoveChild:function(a){this._panes[a.id]&&(delete this._panes[a.id],
this.removeOption(this._optionValFromPane(a.id)))},onSelectChild:function(a){this._setValueAttr(this._optionValFromPane(a.id))},onStartup:function(a){var b=a.selected;this.addOption(dojo.filter(dojo.map(a.children,function(a){var c=this._optionValFromPane(a.id);this._connectTitle(a,c);var d=null;this._panes[a.id]||(this._panes[a.id]=a,d={value:c,label:a.title});if(!a.onShow||!a.onHide||a._shown==void 0)a.onShow=dojo.hitch(this,"_togglePane",a,!0),a.onHide=dojo.hitch(this,"_togglePane",a,!1),a.onHide();
"_savedValue"in this&&c===this._savedValue&&(b=a);return d},this),function(a){return a}));var c=this,d=function(){delete c._savedValue;c.onSelectChild(b);b._shown||c._togglePane(b,!0)};if(b!==a.selected)var e=this.connect(dijit.byId(this.stackId),"_showChild",function(){this.disconnect(e);d()});else d()},postMixInProperties:function(){this._savedValue=this.value;this.inherited(arguments);this.connect(this,"onChange","_handleSelfOnChange")},postCreate:function(){this.inherited(arguments);this._panes=
{};this._subscriptions=[dojo.subscribe(this.stackId+"-startup",this,"onStartup"),dojo.subscribe(this.stackId+"-addChild",this,"onAddChild"),dojo.subscribe(this.stackId+"-removeChild",this,"onRemoveChild"),dojo.subscribe(this.stackId+"-selectChild",this,"onSelectChild")];var a=dijit.byId(this.stackId);if(a&&a._started)this.onStartup({children:a.getChildren(),selected:a.selectedChildWidget})},destroy:function(){dojo.forEach(this._subscriptions,dojo.unsubscribe);delete this._panes;this.inherited("destroy",
arguments)},_handleSelfOnChange:function(a){if(a=this._panes[this._paneIdFromOption(a)]){var b=dijit.byId(this.stackId);a==b.selectedChildWidget?b._transition(a):b.selectChild(a)}}}));