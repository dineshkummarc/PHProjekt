/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.form.FilePickerTextBox"]||(dojo._hasResource["dojox.form.FilePickerTextBox"]=!0,dojo.provide("dojox.form.FilePickerTextBox"),dojo.require("dojo.window"),dojo.require("dijit.form.ValidationTextBox"),dojo.require("dijit._HasDropDown"),dojo.require("dojox.widget.FilePicker"),dojo.declare("dojox.form.FilePickerTextBox",[dijit.form.ValidationTextBox,dijit._HasDropDown],{baseClass:"dojoxFilePickerTextBox",templateString:dojo.cache("dojox.form","resources/FilePickerTextBox.html",
'<div class="dijit dijitReset dijitInlineTable dijitLeft"\n\tid="widget_${id}"\n\trole="combobox" tabIndex="-1"\n\t><div style="overflow:hidden;"\n\t\t><div class=\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton\'\n\t\t\tdojoAttachPoint="downArrowNode,_buttonNode,_popupStateNode" role="presentation"\n\t\t\t><div class="dijitArrowButtonInner">&thinsp;</div\n\t\t\t><div class="dijitArrowButtonChar">&#9660;</div\n\t\t></div\n\t\t><div class="dijitReset dijitValidationIcon"><br></div\n\t\t><div class="dijitReset dijitValidationIconText">&Chi;</div\n\t\t><div class="dijitReset dijitInputField"\n\t\t\t><input type="text" autocomplete="off" ${!nameAttrSetting} class=\'dijitReset\'\n\t\t\t\tdojoAttachEvent=\'onkeypress:_onKey\' \n\t\t\t\tdojoAttachPoint=\'textbox,focusNode\' role="textbox" aria-haspopup="true" aria-autocomplete="list"\n\t\t/></div\n\t></div\n></div>\n'),
searchDelay:500,valueItem:null,numPanes:2.25,postMixInProperties:function(){this.inherited(arguments);this.dropDown=new dojox.widget.FilePicker(this.constraints)},postCreate:function(){this.inherited(arguments);this.connect(this.dropDown,"onChange",this._onWidgetChange);this.connect(this.focusNode,"onblur","_focusBlur");this.connect(this.focusNode,"onfocus","_focusFocus");this.connect(this.focusNode,"ondblclick",function(){dijit.selectInputText(this.focusNode)})},_setValueAttr:function(a,c,b){if(!this._searchInProgress){this.inherited(arguments);
var a=a||"",d=this.dropDown.get("pathValue")||"";if(a!==d)this._skip=!0,d=dojo.hitch(this,"_setBlurValue"),this.dropDown._setPathValueAttr(a,!b,this._settingBlurValue?d:null)}},_onWidgetChange:function(a){if(!a&&this.focusNode.value)this._hasValidPath=!1,this.focusNode.value="";else{this.valueItem=a;if(a=this.dropDown._getPathValueAttr(a))this._hasValidPath=!0;this._skip||this._setValueAttr(a,void 0,!0);delete this._skip}this.validate()},startup:function(){this.dropDown._started||this.dropDown.startup();
this.inherited(arguments)},openDropDown:function(){this.dropDown.domNode.style.width="0px";"minPaneWidth"in(this.constraints||{})||this.dropDown.set("minPaneWidth",this.domNode.offsetWidth/this.numPanes);this.inherited(arguments)},toggleDropDown:function(){this.inherited(arguments);this._opened&&this.dropDown.set("pathValue",this.get("value"))},_focusBlur:function(a){a.explicitOriginalTarget==this.focusNode&&!this._allowBlur?window.setTimeout(dojo.hitch(this,function(){this._allowBlur||this.focus()}),
1):this._menuFocus&&(this.dropDown._updateClass(this._menuFocus,"Item",{Hover:!1}),delete this._menuFocus)},_focusFocus:function(){this._menuFocus&&this.dropDown._updateClass(this._menuFocus,"Item",{Hover:!1});delete this._menuFocus;var a=dijit.getFocus(this);if(a&&a.node&&(a=dijit.byNode(a.node)))this._menuFocus=a.domNode;this._menuFocus&&this.dropDown._updateClass(this._menuFocus,"Item",{Hover:!0});delete this._allowBlur},_onBlur:function(){this._allowBlur=!0;delete this.dropDown._savedFocus;this.inherited(arguments)},
_setBlurValue:function(){this.dropDown&&!this._settingBlurValue?(this._settingBlurValue=!0,this.set("value",this.focusNode.value)):(delete this._settingBlurValue,this.inherited(arguments))},parse:function(a){if(this._hasValidPath||this._hasSelection)return a;var c=this.dropDown,b=c.topDir,d=c.pathSeparator,c=c.get("pathValue"),e=function(a){b.length&&a.indexOf(b)===0&&(a=a.substring(b.length));d&&a[a.length-1]==d&&(a=a.substring(0,a.length-1));return a},c=e(c);if(e(a)==c)return a},_startSearchFromInput:function(){var a=
this.dropDown,c=this.focusNode,b=c.value,d=b,e=a.topDir;this._hasSelection&&dijit.selectInputText(c,d.length);this._hasSelection=!1;e.length&&b.indexOf(e)===0&&(b=b.substring(e.length));var i=b.split(a.pathSeparator),n=dojo.hitch(this,function(b){var e=i[b],f=a.getChildren()[b],j;this._searchInProgress=!0;var l=dojo.hitch(this,function(){delete this._searchInProgress});(e||f)&&!this._opened&&this.toggleDropDown();if(e&&f){var m=dojo.hitch(this,function(){j&&this.disconnect(j);delete j;var g=f._menu.getChildren(),
k=dojo.filter(g,function(a){return a.label==e})[0],h=dojo.filter(g,function(a){return a.label.indexOf(e)===0})[0];if(k&&(i.length>b+1&&k.children||!k.children))b++,f._menu.onItemClick(k,{type:"internal",stopPropagation:function(){},preventDefault:function(){}}),i[b]?n(b):l();else{f._setSelected(null);if(h&&i.length===b+1){a._setInProgress=!0;a._removeAfter(f);delete a._setInProgress;g=h.label;h.children&&(g+=a.pathSeparator);g=g.substring(e.length);window.setTimeout(function(){dojo.window.scrollIntoView(h.domNode)},
1);c.value=d+g;dijit.selectInputText(c,d.length);this._hasSelection=!0;try{h.focusNode.focus()}catch(m){}}else this._menuFocus&&this.dropDown._updateClass(this._menuFocus,"Item",{Hover:!1,Focus:!1}),delete this._menuFocus;l()}});f.isLoaded?m():j=this.connect(f,"onLoad",m)}else{if(f)f._setSelected(null),a._setInProgress=!0,a._removeAfter(f),delete a._setInProgress;l()}});n(0)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var c=dojo.keys,b=a.charOrCode;if(b==c.DOWN_ARROW)this._allowBlur=!0;
if(b==c.ENTER&&this._opened)this.dropDown.onExecute(),dijit.selectInputText(this.focusNode,this.focusNode.value.length),this._hasSelection=!1,dojo.stopEvent(a);else if((b==c.RIGHT_ARROW||b==c.LEFT_ARROW||b==c.TAB)&&this._hasSelection)this._startSearchFromInput(),dojo.stopEvent(a);else{this.inherited(arguments);var d=!1;(b==c.BACKSPACE||b==c.DELETE)&&this._hasSelection?this._hasSelection=!1:d=b==c.BACKSPACE||b==c.DELETE||b==" "?!0:a.keyChar!=="";this._searchTimer&&window.clearTimeout(this._searchTimer);
delete this._searchTimer;if(d)this._hasSelection=this._hasValidPath=!1,this._searchTimer=window.setTimeout(dojo.hitch(this,"_startSearchFromInput"),this.searchDelay+1)}}}}));