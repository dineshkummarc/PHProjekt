/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.form.uploader.FileList"]||(dojo._hasResource["dojox.form.uploader.FileList"]=!0,dojo.provide("dojox.form.uploader.FileList"),dojo.require("dojox.form.uploader.Base"),dojo.declare("dojox.form.uploader.FileList",[dojox.form.uploader.Base],{uploaderId:"",uploader:null,headerIndex:"#",headerType:"Type",headerFilename:"File Name",headerFilesize:"Size",_upCheckCnt:0,rowAmt:0,templateString:'<div class="dojoxUploaderFileList"><div dojoAttachPoint="progressNode" class="dojoxUploaderFileListProgress"><div dojoAttachPoint="percentBarNode" class="dojoxUploaderFileListProgressBar"></div><div dojoAttachPoint="percentTextNode" class="dojoxUploaderFileListPercentText">0%</div></div><table class="dojoxUploaderFileListTable"><tr class="dojoxUploaderFileListHeader"><th class="dojoxUploaderIndex">${headerIndex}</th><th class="dojoxUploaderIcon">${headerType}</th><th class="dojoxUploaderFileName">${headerFilename}</th><th class="dojoxUploaderFileSize">${headerFilesize}</th></tr><tr ><td colSpan="4" class="dojoxUploaderFileListContainer" dojoAttachPoint="containerNode"><table class="dojoxUploaderFileListContent" dojoAttachPoint="listNode"></table></td><tr></table><div>',
postCreate:function(){this.setUploader();this.hideProgress()},reset:function(){for(var a=0;a<this.rowAmt;a++)this.listNode.deleteRow(0);this.rowAmt=0},setUploader:function(){if(!this.uploaderId&&!this.uploader)console.warn("uploaderId not passed to UploaderFileList");else if(this.uploaderId&&!this.uploader)this.uploader=dijit.byId(this.uploaderId);else if(this._upCheckCnt>4){console.warn("uploader not found for ID ",this.uploaderId);return}this.uploader?(this.connect(this.uploader,"onChange","_onUploaderChange"),
this.connect(this.uploader,"reset","reset"),this.connect(this.uploader,"onBegin",function(){this.showProgress(!0)}),this.connect(this.uploader,"onProgress","_progress"),this.connect(this.uploader,"onComplete",function(){setTimeout(dojo.hitch(this,function(){this.hideProgress(!0)}),1250)})):(this._upCheckCnt++,setTimeout(dojo.hitch(this,"setUploader"),250))},hideProgress:function(a){this._hideShowProgress(a?{ani:!0,endDisp:"none",beg:15,end:0}:{endDisp:"none",ani:!1})},showProgress:function(a){this._hideShowProgress(a?
{ani:!0,endDisp:"block",beg:0,end:15}:{endDisp:"block",ani:!1})},_progress:function(a){this.percentTextNode.innerHTML=a.percent;dojo.style(this.percentBarNode,"width",a.percent)},_hideShowProgress:function(a){var d=this.progressNode,c=function(){dojo.style(d,"display",a.endDisp)};a.ani?(dojo.style(d,"display","block"),dojo.animateProperty({node:d,properties:{height:{start:a.beg,end:a.end,units:"px"}},onEnd:c}).play()):c()},_onUploaderChange:function(a){this.reset();dojo.forEach(a,function(a,c){this._addRow(c+
1,this.getFileType(a.name),a.name,a.size)},this)},_addRow:function(a,d,c,f){var b,e=this.listNode.insertRow(-1);b=e.insertCell(-1);dojo.addClass(b,"dojoxUploaderIndex");b.innerHTML=a;b=e.insertCell(-1);dojo.addClass(b,"dojoxUploaderIcon");b.innerHTML=d;b=e.insertCell(-1);dojo.addClass(b,"dojoxUploaderFileName");b.innerHTML=c;b=e.insertCell(-1);dojo.addClass(b,"dojoxUploaderSize");b.innerHTML=this.convertBytes(f).value;this.rowAmt++}}));