/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.io.OAuth"])dojo._hasResource["dojox.io.OAuth"]=!0,dojo.provide("dojox.io.OAuth"),dojo.require("dojox.encoding.digests.SHA1"),dojox.io.OAuth=new function(){function k(b,c){for(var a=c.consumer.key,d="",e=i.length,f=0;f<16;f++)d+=i.charAt(Math.floor(Math.random()*e));a={oauth_consumer_key:a,oauth_nonce:d,oauth_signature_method:c.sig_method||"HMAC-SHA1",oauth_timestamp:Math.floor((new Date).valueOf()/1E3)-2,oauth_version:"1.0"};if(c.token)a.oauth_token=c.token.key;b.content=
dojo.mixin(b.content||{},a)}function l(b){var c=[{}],a;if(b.form){if(!b.content)b.content={};a=dojo.byId(b.form);var d=a.getAttributeNode("action");b.url=b.url||(d?d.value:null);a=dojo.formToObject(a);delete b.form}a&&c.push(a);b.content&&c.push(b.content);var d=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(b.url);
a={};for(var f=d.length;f--;)a[d[f]]=e[f]||"";d=a.protocol.toLowerCase();e=a.authority.toLowerCase();(d=="http"&&a.port==80||d=="https"&&a.port==443)&&e.lastIndexOf(":")>-1&&(e=e.substring(0,e.lastIndexOf(":")));a.url=d+"://"+e+(a.path||"/");if(a.query){var d=dojo.queryToObject(a.query),h;for(h in d)d[h]=encodeURIComponent(d[h]);c.push(d)}b._url=a.url;a=[];d=0;for(e=c.length;d<e;d++)for(h in f=c[d],f)if(dojo.isArray(f[h]))for(var g=0,i=f.length;g<i;g++)a.push([h,f[g]]);else a.push([h,f[h]]);b._parameters=
a;return b}function m(b,c,a){k(c,a);l(c);a=c._parameters;a.sort(function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:a[1]>b[1]?1:a[1]<b[1]?-1:0});a=dojo.map(a,function(a){return g(a[0])+"="+g(a[1]||"")}).join("&");return b.toUpperCase()+"&"+g(c._url)+"&"+g(a)}function j(b,c,a){var d=g(a.consumer.secret)+"&"+(a.token&&a.token.secret?g(a.token.secret):""),b=m(b,c,a);if((a=a.sig_method||"HMAC-SHA1")&&a!="PLAINTEXT"&&a!="HMAC-SHA1")throw Error("dojox.io.OAuth: the only supported signature encodings are PLAINTEXT and HMAC-SHA1.");
d=a=="PLAINTEXT"?d:dojox.encoding.digests.SHA1._hmac(b,d);c.content.oauth_signature=d;return c}var g=this.encode=function(b){return!b?"":encodeURIComponent(b).replace(/\!/g,"%21").replace(/\*/g,"%2A").replace(/\'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")};this.decode=function(b){for(var c=[],b=b.split("&"),a=0,d=b.length;a<d;a++)if(b[a]!="")if(b[a].indexOf("=")>-1){var e=b[a].split("=");c.push([decodeURIComponent(e[0]),decodeURIComponent(e[1])])}else c.push([decodeURIComponent(b[a]),null]);
return c};var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";this.sign=function(b,c,a){return j(b,c,a)};this.xhr=function(b,c,a,d){j(b,c,a);return dojo.xhr(b,c,d)};this.xhrGet=function(b,c){return this.xhr("GET",b,c)};this.xhrPost=this.xhrRawPost=function(b,c){return this.xhr("POST",b,c,!0)};this.xhrPut=this.xhrRawPut=function(b,c){return this.xhr("PUT",b,c,!0)};this.xhrDelete=function(b,c){return this.xhr("DELETE",b,c)}};