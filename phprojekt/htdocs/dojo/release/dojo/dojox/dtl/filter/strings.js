/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.dtl.filter.strings"]||(dojo._hasResource["dojox.dtl.filter.strings"]=!0,dojo.provide("dojox.dtl.filter.strings"),dojo.require("dojox.dtl.filter.htmlstrings"),dojo.require("dojox.string.sprintf"),dojo.require("dojox.string.tokenize"),dojo.mixin(dojox.dtl.filter.strings,{_urlquote:function(a,b){b||(b="/");return dojox.string.tokenize(a,/([^\w-_.])/g,function(a){return b.indexOf(a)==-1?a==" "?"+":"%"+a.charCodeAt(0).toString(16).toUpperCase():a}).join("")},addslashes:function(a){return a.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'")},capfirst:function(a){a=""+a;return a.charAt(0).toUpperCase()+a.substring(1)},center:function(a,b){b=b||a.length;a+="";var d=b-a.length;d%2&&(a+=" ",d-=1);for(var c=0;c<d;c+=2)a=" "+a+" ";return a},cut:function(a,b){a+="";return a.replace(RegExp(b+""||"","g"),"")},_fix_ampersands:/&(?!(\w+|#\d+);)/g,fix_ampersands:function(a){return a.replace(dojox.dtl.filter.strings._fix_ampersands,"&amp;")},floatformat:function(a,b){b=parseInt(b||-1,10);a=parseFloat(a);
if(!(a-a.toFixed(0))&&b<0)return a.toFixed();a=a.toFixed(Math.abs(b));return b<0?parseFloat(a)+"":a},iriencode:function(a){return dojox.dtl.filter.strings._urlquote(a,"/#%[]=:;$&()+,!")},linenumbers:function(a){for(var b=dojox.dtl.filter,a=a.split("\n"),d=[],c=(a.length+"").length,e=0,f;e<a.length;e++)f=a[e],d.push(b.strings.ljust(e+1,c)+". "+dojox.dtl._base.escape(f));return d.join("\n")},ljust:function(a,b){a+="";for(b=parseInt(b,10);a.length<b;)a+=" ";return a},lower:function(a){return(a+"").toLowerCase()},
make_list:function(a){var b=[];typeof a=="number"&&(a+="");if(a.charAt){for(var d=0;d<a.length;d++)b.push(a.charAt(d));return b}if(typeof a=="object"){for(d in a)b.push(a[d]);return b}return[]},rjust:function(a,b){a+="";for(b=parseInt(b,10);a.length<b;)a=" "+a;return a},slugify:function(a){a=a.replace(/[^\w\s-]/g,"").toLowerCase();return a.replace(/[\-\s]+/g,"-")},_strings:{},stringformat:function(a,b){var b=""+b,d=dojox.dtl.filter.strings._strings;d[b]||(d[b]=new dojox.string.sprintf.Formatter("%"+
b));return d[b].format(a)},title:function(a){for(var b,d="",c=0,e;c<a.length;c++)e=a.charAt(c),d+=b==" "||b=="\n"||b=="\t"||!b?e.toUpperCase():e.toLowerCase(),b=e;return d},_truncatewords:/[ \n\r\t]/,truncatewords:function(a,b){b=parseInt(b,10);if(!b)return a;for(var d=0,c=a.length,e=0,f,h;d<a.length;d++){f=a.charAt(d);if(dojox.dtl.filter.strings._truncatewords.test(h)){if(!dojox.dtl.filter.strings._truncatewords.test(f)&&(++e,e==b))return a.substring(0,c+1)}else dojox.dtl.filter.strings._truncatewords.test(f)||
(c=d);h=f}return a},_truncate_words:/(&.*?;|<.*?>|(\w[\w\-]*))/g,_truncate_tag:/<(\/)?([^ ]+?)(?: (\/)| .*?)?>/,_truncate_singlets:{br:!0,col:!0,link:!0,base:!0,img:!0,param:!0,area:!0,hr:!0,input:!0},truncatewords_html:function(a,b){b=parseInt(b,10);if(b<=0)return"";for(var d=dojox.dtl.filter.strings,c=0,e=[],f=dojox.string.tokenize(a,d._truncate_words,function(a,f){if(f)if(++c,c<b)return f;else if(c==b)return f+" ...";var g=a.match(d._truncate_tag);if(g&&!(c>=b)){var h=g[1],g=g[2].toLowerCase();
!h&&!d._truncate_singlets[g]&&(h?(h=dojo.indexOf(e,g),h!=-1&&(e=e.slice(h+1))):e.unshift(g));return a}}).join(""),f=f.replace(/\s+$/g,""),h=0,g;g=e[h];h++)f+="</"+g+">";return f},upper:function(a){return a.toUpperCase()},urlencode:function(a){return dojox.dtl.filter.strings._urlquote(a)},_urlize:/^((?:[(>]|&lt;)*)(.*?)((?:[.,)>\n]|&gt;)*)$/,_urlize2:/^\S+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+$/,urlize:function(a){return dojox.dtl.filter.strings.urlizetrunc(a)},urlizetrunc:function(a,b){b=parseInt(b);return dojox.string.tokenize(a,
/(\S+)/g,function(a){var c=dojox.dtl.filter.strings._urlize.exec(a);if(!c)return a;var c=c[2],e=c.indexOf("www.")==0,f=c.indexOf("@")!=-1,h=c.indexOf(":")!=-1,g=c.indexOf("http://")==0,k=c.indexOf("https://")==0,l=/[a-zA-Z0-9]/.test(c.charAt(0)),j=c.substring(c.length-4),i=c;b>3&&(i=i.substring(0,b-3)+"...");if(e||!f&&!g&&c.length&&l&&(j==".org"||j==".net"||j==".com"))return'<a href="http://'+c+'" rel="nofollow">'+i+"</a>";else if(g||k)return'<a href="'+c+'" rel="nofollow">'+i+"</a>";else if(f&&!e&&
!h&&dojox.dtl.filter.strings._urlize2.test(c))return'<a href="mailto:'+c+'">'+c+"</a>";return a}).join("")},wordcount:function(a){a=dojo.trim(a);return!a?0:a.split(/\s+/g).length},wordwrap:function(a,b){var b=parseInt(b),d=[],c=a.split(/\s+/g);if(c.length){var e=c.shift();d.push(e);for(var f=e.length-e.lastIndexOf("\n")-1,h=0;h<c.length;h++){var e=c[h],g=e.indexOf("\n")!=-1?e.split(/\n/g):[e];f+=g[0].length+1;if(b&&f>b)d.push("\n"),f=g[g.length-1].length;else if(d.push(" "),g.length>1)f=g[g.length-
1].length;d.push(e)}}return d.join("")}}));