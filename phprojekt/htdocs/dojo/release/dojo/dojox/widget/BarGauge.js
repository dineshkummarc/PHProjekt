/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.widget.BarGauge"]||(dojo._hasResource["dojox.widget.BarGauge"]=!0,dojo.provide("dojox.widget.BarGauge"),dojo.require("dojox.gfx"),dojo.require("dojox.widget.gauge._Gauge"),dojo.experimental("dojox.widget.BarGauge"),dojo.declare("dojox.widget.gauge.BarLineIndicator",[dojox.widget.gauge._Indicator],{width:1,_getShapes:function(){if(!this._gauge)return null;var a=this.value;if(a<this._gauge.min)a=this._gauge.min;if(a>this._gauge.max)a=this._gauge.max;var a=this._gauge._getPosition(a),
b=[];this.width>1?(b[0]=this._gauge.surface.createRect({x:a,y:this._gauge.dataY+this.offset,width:this.width,height:this.length}),b[0].setStroke({color:this.color}),b[0].setFill(this.color)):(b[0]=this._gauge.surface.createLine({x1:a,y1:this._gauge.dataY+this.offset,x2:a,y2:this._gauge.dataY+this.offset+this.length}),b[0].setStroke({color:this.color}));return b},draw:function(a){if(this.shapes)this._move(a);else{if(this.shapes){for(a=0;a<this.shapes.length;a++)this._gauge.surface.remove(this.shapes[a]);
this.shapes=null}if(this.text)this._gauge.surface.rawNode.removeChild(this.text),this.text=null;this.color=this.color||"#000000";this.length=this.length||this._gauge.dataHeight;this.width=this.width||3;this.offset=this.offset||0;this.highlight=this.highlight||"#4D4D4D";this.highlight2=this.highlight2||"#A3A3A3";this.shapes=this._getShapes(this._gauge,this);if(this.label){a=this.value;if(a<this._gauge.min)a=this._gauge.min;if(a>this._gauge.max)a=this._gauge.max;this.text=this._gauge.drawText(""+this.label,
this._gauge._getPosition(a),this._gauge.dataY+this.offset-5,"middle","top",this.color,this.font)}for(a=0;a<this.shapes.length;a++)if(this.hover&&this.shapes[a].getEventSource().setAttribute("hover",this.hover),this.onDragMove&&!this.noChange)this._gauge.connect(this.shapes[a].getEventSource(),"onmousedown",this._gauge.handleMouseDown),this.shapes[a].getEventSource().style.cursor="pointer";this.currentValue=this.value}},_move:function(a){var b=this.value;if(b<this.min)b=this.min;if(b>this.max)b=this.max;
var c=this._gauge._getPosition(this.currentValue);this.currentValue=b;b=this._gauge._getPosition(b)-this._gauge.dataX;a?this.shapes[0].applyTransform(dojox.gfx.matrix.translate(b-(this.shapes[0].matrix?this.shapes[0].matrix.dx:0),0)):(a=new dojo.Animation({curve:[c,b],duration:this.duration,easing:this.easing}),dojo.connect(a,"onAnimate",dojo.hitch(this,function(a){this.shapes[0].applyTransform(dojox.gfx.matrix.translate(a-(this.shapes[0].matrix?this.shapes[0].matrix.dx:0),0))})),a.play())}}),dojo.declare("dojox.widget.BarGauge",
dojox.widget.gauge._Gauge,{dataX:5,dataY:5,dataWidth:0,dataHeight:0,_defaultIndicator:dojox.widget.gauge.BarLineIndicator,startup:function(){this.getChildren&&dojo.forEach(this.getChildren(),function(a){a.startup()});if(!this.dataWidth)this.dataWidth=this.gaugeWidth-10;if(!this.dataHeight)this.dataHeight=this.gaugeHeight-10;this.inherited(arguments)},_getPosition:function(a){return this.dataX+Math.floor((a-this.min)/(this.max-this.min)*this.dataWidth)},_getValueForPosition:function(a){return(a-this.dataX)*
(this.max-this.min)/this.dataWidth+this.min},draw:function(){this.surface||this.createSurface();var a;if(this._rangeData){for(a=0;a<this._rangeData.length;a++)this.drawRange(this._rangeData[a]);this._img&&this.image.overlay&&this._img.moveToFront()}if(this._indicatorData)for(a=0;a<this._indicatorData.length;a++)this._indicatorData[a].draw()},drawRange:function(a){if(a.shape)this.surface.remove(a.shape),a.shape=null;var b=this._getPosition(a.low),c=this._getPosition(a.high),d=this.surface.createRect({x:b,
y:this.dataY,width:c-b,height:this.dataHeight});if(dojo.isArray(a.color)||dojo.isString(a.color))d.setStroke({color:a.color}),d.setFill(a.color);else if(a.color.type){var e=this.dataY+this.dataHeight/2;a.color.x1=b;a.color.x2=c;a.color.y1=e;a.color.y2=e;d.setFill(a.color);d.setStroke({color:a.color.colors[0].color})}else d.setStroke({color:"green"}),d.setFill("green"),d.getEventSource().setAttribute("class",a.color.style);a.hover&&d.getEventSource().setAttribute("hover",a.hover);a.shape=d},getRangeUnderMouse:function(a){var b=
null,c=dojo.coords(this.gaugeContent),a=this._getValueForPosition(a.clientX-c.x);if(this._rangeData)for(c=0;c<this._rangeData.length&&!b;c++)Number(this._rangeData[c].low)<=a&&Number(this._rangeData[c].high)>=a&&(b=this._rangeData[c]);return b},_dragIndicator:function(a,b){var c=dojo.coords(a.gaugeContent),c=a._getValueForPosition(b.clientX-c.x);if(c<a.min)c=a.min;if(c>a.max)c=a.max;a._drag.value=c;a._drag.onDragMove(a._drag);a._drag.draw(!0);dojo.stopEvent(b)}}));