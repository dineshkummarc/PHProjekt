/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.widget.Toaster"]||(dojo._hasResource["dojox.widget.Toaster"]=!0,dojo.provide("dojox.widget.Toaster"),dojo.require("dojo.fx"),dojo.require("dojo.window"),dojo.require("dijit._Widget"),dojo.require("dijit._Templated"),dojo.declare("dojox.widget.Toaster",[dijit._Widget,dijit._Templated],{templateString:'<div class="dijitToasterClip" dojoAttachPoint="clipNode"><div class="dijitToasterContainer" dojoAttachPoint="containerNode" dojoAttachEvent="onclick:onSelect"><div class="dijitToasterContent" dojoAttachPoint="contentNode"></div></div></div>',
messageTopic:"",messageTypes:{MESSAGE:"message",WARNING:"warning",ERROR:"error",FATAL:"fatal"},defaultType:"message",positionDirection:"br-up",positionDirectionTypes:["br-up","br-left","bl-up","bl-right","tr-down","tr-left","tl-down","tl-right"],duration:2E3,slideDuration:500,separator:"<hr></hr>",postCreate:function(){this.inherited(arguments);this.hide();dojo.body().appendChild(this.domNode);this.messageTopic&&dojo.subscribe(this.messageTopic,this,"_handleMessage")},_handleMessage:function(a){dojo.isString(a)?
this.setContent(a):this.setContent(a.message,a.type,a.duration)},_capitalize:function(a){return a.substring(0,1).toUpperCase()+a.substring(1)},setContent:function(a,d,b){b=b||this.duration;if(this.slideAnim&&(this.slideAnim.status()!="playing"&&this.slideAnim.stop(),this.slideAnim.status()=="playing"||this.fadeAnim&&this.fadeAnim.status()=="playing")){setTimeout(dojo.hitch(this,function(){this.setContent(a,d,b)}),50);return}for(var c in this.messageTypes)dojo.removeClass(this.containerNode,"dijitToaster"+
this._capitalize(this.messageTypes[c]));dojo.style(this.containerNode,"opacity",1);this._setContent(a);dojo.addClass(this.containerNode,"dijitToaster"+this._capitalize(d||this.defaultType));this.show();c=dojo.marginBox(this.containerNode);this._cancelHideTimer();if(this.isVisible)this._placeClip(),this._stickyMessage||this._setHideTimer(b);else{var e=this.containerNode.style,f=this.positionDirection;if(f.indexOf("-up")>=0)e.left="0px",e.top=c.h+10+"px";else if(f.indexOf("-left")>=0)e.left=c.w+10+
"px",e.top="0px";else if(f.indexOf("-right")>=0)e.left=0-c.w-10+"px",e.top="0px";else if(f.indexOf("-down")>=0)e.left="0px",e.top=0-c.h-10+"px";else throw Error(this.id+".positionDirection is invalid: "+f);this.slideAnim=dojo.fx.slideTo({node:this.containerNode,top:0,left:0,duration:this.slideDuration});this.connect(this.slideAnim,"onEnd",function(){this.fadeAnim=dojo.fadeOut({node:this.containerNode,duration:1E3});this.connect(this.fadeAnim,"onEnd",function(){this.isVisible=!1;this.hide()});this._setHideTimer(b);
this.connect(this,"onSelect",function(){this._cancelHideTimer();this._stickyMessage=!1;this.fadeAnim.play()});this.isVisible=!0});this.slideAnim.play()}},_setContent:function(a){dojo.isFunction(a)?a(this):(a&&this.isVisible&&(a=this.contentNode.innerHTML+this.separator+a),this.contentNode.innerHTML=a)},_cancelHideTimer:function(){if(this._hideTimer)clearTimeout(this._hideTimer),this._hideTimer=null},_setHideTimer:function(a){this._cancelHideTimer();a>0?(this._cancelHideTimer(),this._hideTimer=setTimeout(dojo.hitch(this,
function(){if(this.bgIframe&&this.bgIframe.iframe)this.bgIframe.iframe.style.display="none";this._hideTimer=null;this._stickyMessage=!1;this.fadeAnim.play()}),a)):this._stickyMessage=!0},_placeClip:function(){var a=dojo.window.getBox(),d=dojo.marginBox(this.containerNode),b=this.clipNode.style;b.height=d.h+"px";b.width=d.w+"px";var c=this.positionDirection;if(c.match(/^t/))b.top=a.t+"px";else if(c.match(/^b/))b.top=a.h-d.h-2+a.t+"px";if(c.match(/^[tb]r-/))b.left=a.w-d.w-1-a.l+"px";else if(c.match(/^[tb]l-/))b.left=
"0px";b.clip="rect(0px, "+d.w+"px, "+d.h+"px, 0px)";if(dojo.isIE){if(!this.bgIframe)this.clipNode.id=dijit.getUniqueId("dojox_widget_Toaster_clipNode"),this.bgIframe=new dijit.BackgroundIframe(this.clipNode);if(a=this.bgIframe.iframe)a.style.display="block"}},onSelect:function(){},show:function(){dojo.style(this.domNode,"display","block");this._placeClip();if(!this._scrollConnected)this._scrollConnected=dojo.connect(window,"onscroll",this,this._placeClip)},hide:function(){dojo.style(this.domNode,
"display","none");if(this._scrollConnected)dojo.disconnect(this._scrollConnected),this._scrollConnected=!1;dojo.style(this.containerNode,"opacity",1)}}));