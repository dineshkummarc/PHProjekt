/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.drawing.ui.dom.Pan"])dojo._hasResource["dojox.drawing.ui.dom.Pan"]=!0,dojo.provide("dojox.drawing.ui.dom.Pan"),dojo.require("dojox.drawing.plugins._Plugin"),dojo.deprecated("dojox.drawing.ui.dom.Pan","It may not even make it to the 1.4 release.",1.4),dojox.drawing.ui.dom.Pan=dojox.drawing.util.oo.declare(dojox.drawing.plugins._Plugin,function(a){this.domNode=a.node;var b;dojo.connect(this.domNode,"click",this,"onSetPan");dojo.connect(this.keys,"onKeyUp",this,"onKeyUp");
dojo.connect(this.keys,"onKeyDown",this,"onKeyDown");dojo.connect(this.anchors,"onAnchorUp",this,"checkBounds");dojo.connect(this.stencils,"register",this,"checkBounds");dojo.connect(this.canvas,"resize",this,"checkBounds");dojo.connect(this.canvas,"setZoom",this,"checkBounds");dojo.connect(this.canvas,"onScroll",this,function(){this._blockScroll?this._blockScroll=!1:(b&&clearTimeout(b),b=setTimeout(dojo.hitch(this,"checkBounds"),200))});this._mouseHandle=this.mouse.register(this)},{selected:!1,type:"dojox.drawing.ui.dom.Pan",
onKeyUp:function(a){if(a.keyCode==32)this.onSetPan(!1)},onKeyDown:function(a){if(a.keyCode==32)this.onSetPan(!0)},onSetPan:function(a){if(a===!0||a===!1)this.selected=!a;this.selected?(this.selected=!1,dojo.removeClass(this.domNode,"selected")):(this.selected=!0,dojo.addClass(this.domNode,"selected"));this.mouse.setEventMode(this.selected?"pan":"")},onPanDrag:function(a){this.canvas.domNode.parentNode.scrollTop-=a.move.y;this.canvas.domNode.parentNode.scrollLeft-=a.move.x;this.canvas.onScroll()},
onStencilUp:function(){this.checkBounds()},onStencilDrag:function(){},checkBounds:function(){var a=-Infinity,b=-Infinity,i=0,j=0,k=this.stencils.group?this.stencils.group.getTransform():{dx:0,dy:0},d=this.mouse.scrollOffset(),e=this.canvas.height,f=this.canvas.width,l=this.canvas.zoom,g=this.canvas.parentHeight,h=this.canvas.parentWidth;this.stencils.withSelected(function(c){c=c.getBounds();a=Math.max(c.x2+k.dx,a);b=Math.max(c.y2+k.dy,b)});this.stencils.withUnselected(function(c){c=c.getBounds();
a=Math.max(c.x2,a);b=Math.max(c.y2,b)});b*=l;var m=0,n=0;b>g||d.top?(e=Math.max(b,g+d.top),j=d.top,m+=this.canvas.getScrollWidth()):!j&&e>g&&(e=g);a*=l;a>h||d.left?(f=Math.max(a,h+d.left),i=d.left,n+=this.canvas.getScrollWidth()):!i&&f>h&&(f=h);f+=m*2;e+=n*2;this._blockScroll=!0;this.stencils.group&&this.stencils.group.applyTransform({dx:0,dy:0});this.stencils.withUnselected(function(a){a.transformPoints({dx:0,dy:0})});this.canvas.setDimensions(f,e,i,j)}}),dojox.drawing.ui.dom.Pan.setup={name:"dojox.drawing.ui.dom.Pan",
tooltip:"Pan Tool",iconClass:"iconPan"},dojox.drawing.register(dojox.drawing.ui.dom.Pan.setup,"plugin");