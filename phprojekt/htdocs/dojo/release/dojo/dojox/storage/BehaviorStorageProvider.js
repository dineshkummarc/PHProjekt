/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.storage.BehaviorStorageProvider"]||(dojo._hasResource["dojox.storage.BehaviorStorageProvider"]=!0,dojo.provide("dojox.storage.BehaviorStorageProvider"),dojo.require("dojox.storage.Provider"),dojo.require("dojox.storage.manager"),dojo.declare("dojox.storage.BehaviorStorageProvider",[dojox.storage.Provider],{store:null,storeName:"__dojox_BehaviorStorage",keys:[],initialize:function(){try{this.store=this._createStore(),this.store.load(this.storeName)}catch(a){throw Error("Store is not available: "+
a);}this.keys=this.get("keys","dojoxSystemNS")||[];this.initialized=!0;dojox.storage.manager.loaded()},isAvailable:function(){return dojo.isIE&&dojo.isIE>=5},_createStore:function(){var a=dojo.create("link",{id:this.storeName+"Node",style:{display:"none"}},dojo.query("head")[0]);a.addBehavior("#default#userdata");return a},put:function(a,b,d,c){this._assertIsValidKey(a);c=c||this.DEFAULT_NAMESPACE;this._assertIsValidNamespace(c);var e=this.getFullKey(a,c),b=dojo.toJson(b);this.store.setAttribute(e,
b);this.store.save(this.storeName);if(b=this.store.getAttribute(e)===b)this._addKey(e),this.store.setAttribute("__dojoxSystemNS_keys",dojo.toJson(this.keys)),this.store.save(this.storeName);d&&d(b?this.SUCCESS:this.FAILED,a,null,c)},get:function(a,b){this._assertIsValidKey(a);b=b||this.DEFAULT_NAMESPACE;this._assertIsValidNamespace(b);a=this.getFullKey(a,b);return dojo.fromJson(this.store.getAttribute(a))},getKeys:function(a){a=a||this.DEFAULT_NAMESPACE;this._assertIsValidNamespace(a);for(var a="__"+
a+"_",b=[],d=0;d<this.keys.length;d++){var c=this.keys[d];this._beginsWith(c,a)&&(c=c.substring(a.length),b.push(c))}return b},clear:function(a){a=a||this.DEFAULT_NAMESPACE;this._assertIsValidNamespace(a);for(var a="__"+a+"_",b=[],d=0;d<this.keys.length;d++){var c=this.keys[d];this._beginsWith(c,a)&&b.push(c)}dojo.forEach(b,function(a){this.store.removeAttribute(a);this._removeKey(a)},this);this.put("keys",this.keys,null,"dojoxSystemNS");this.store.save(this.storeName)},remove:function(a,b){this._assertIsValidKey(a);
b=b||this.DEFAULT_NAMESPACE;this._assertIsValidNamespace(b);a=this.getFullKey(a,b);this.store.removeAttribute(a);this._removeKey(a);this.put("keys",this.keys,null,"dojoxSystemNS");this.store.save(this.storeName)},getNamespaces:function(){var a=[this.DEFAULT_NAMESPACE],b={};b[this.DEFAULT_NAMESPACE]=!0;for(var d=/^__([^_]*)_/,c=0;c<this.keys.length;c++){var e=this.keys[c];d.test(e)==!0&&(e=e.match(d)[1],typeof b[e]=="undefined"&&(b[e]=!0,a.push(e)))}return a},isPermanent:function(){return!0},getMaximumSize:function(){return 64},
hasSettingsUI:function(){return!1},isValidKey:function(a){return a===null||a===void 0?!1:/^[0-9A-Za-z_-]*$/.test(a)},isValidNamespace:function(a){return a===null||a===void 0?!1:/^[0-9A-Za-z-]*$/.test(a)},getFullKey:function(a,b){return"__"+b+"_"+a},_beginsWith:function(a,b){return b.length>a.length?!1:a.substring(0,b.length)===b},_assertIsValidNamespace:function(a){if(this.isValidNamespace(a)===!1)throw Error("Invalid namespace given: "+a);},_assertIsValidKey:function(a){if(this.isValidKey(a)===!1)throw Error("Invalid key given: "+
a);},_addKey:function(a){this._removeKey(a);this.keys.push(a)},_removeKey:function(a){this.keys=dojo.filter(this.keys,function(b){return b!==a},this)}}),dojox.storage.manager.register("dojox.storage.BehaviorStorageProvider",new dojox.storage.BehaviorStorageProvider));