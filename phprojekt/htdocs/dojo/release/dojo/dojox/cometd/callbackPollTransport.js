/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.cometd.callbackPollTransport"])dojo._hasResource["dojox.cometd.callbackPollTransport"]=!0,dojo.provide("dojox.cometd.callbackPollTransport"),dojo.require("dojox.cometd._base"),dojo.require("dojox.cometd.longPollTransport"),dojo.require("dojo.io.script"),dojox.cometd.callbackPollTransport=new function(){this._connectionType="callback-polling";this._cometd=null;this.check=function(a){return dojo.indexOf(a,"callback-polling")>=0};this.tunnelInit=function(){var a={channel:"/meta/connect",
clientId:this._cometd.clientId,connectionType:this._connectionType,id:""+this._cometd.messageId++},a=this._cometd._extendOut(a);this.openTunnelWith([a])};this.tunnelCollapse=dojox.cometd.longPollTransport.tunnelCollapse;this._connect=dojox.cometd.longPollTransport._connect;this.deliver=dojox.cometd.longPollTransport.deliver;this.openTunnelWith=function(a,b){this._cometd._polling=!0;var c={load:dojo.hitch(this,function(a){this._cometd._polling=!1;this._cometd.deliver(a);this._cometd._backon();this.tunnelCollapse()}),
error:dojo.hitch(this,function(){this._cometd._polling=!1;this._cometd._publishMeta("connect",!1);this._cometd._backoff();this.tunnelCollapse()}),url:b||this._cometd.url,content:{message:dojo.toJson(a)},callbackParamName:"jsonp"},d=this._cometd._connectTimeout();if(d>0)c.timeout=d;dojo.io.script.get(c)};this.sendMessages=function(a){for(var b=0;b<a.length;b++)a[b].clientId=this._cometd.clientId,a[b].id=""+this._cometd.messageId++,a[b]=this._cometd._extendOut(a[b]);b={url:this._cometd.url||dojo.config.cometdRoot,
load:dojo.hitch(this._cometd,"deliver"),callbackParamName:"jsonp",content:{message:dojo.toJson(a)},error:dojo.hitch(this,function(){this._cometd._publishMeta("publish",!1,{messages:a})}),timeout:this._cometd.expectedNetworkDelay};return dojo.io.script.get(b)};this.startup=function(){this._cometd._connected||this.tunnelInit()};this.disconnect=dojox.cometd.longPollTransport.disconnect;this.disconnect=function(){var a={channel:"/meta/disconnect",clientId:this._cometd.clientId,id:""+this._cometd.messageId++},
a=this._cometd._extendOut(a);dojo.io.script.get({url:this._cometd.url||dojo.config.cometdRoot,callbackParamName:"jsonp",content:{message:dojo.toJson([a])}})};this.cancelConnect=function(){}},dojox.cometd.connectionTypes.register("callback-polling",dojox.cometd.callbackPollTransport.check,dojox.cometd.callbackPollTransport);