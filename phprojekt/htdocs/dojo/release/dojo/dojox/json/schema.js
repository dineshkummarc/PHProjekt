/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.json.schema"])dojo._hasResource["dojox.json.schema"]=!0,dojo.provide("dojox.json.schema"),dojox.json.schema.validate=function(e,f){return this._validate(e,f,!1)},dojox.json.schema.checkPropertyChange=function(e,f,j){return this._validate(e,f,j||"property")},dojox.json.schema.mustBeValid=function(e){if(!e.valid)throw new TypeError(dojo.map(e.errors,function(e){return"for property "+e.property+": "+e.message}).join(", "));},dojox.json.schema._validate=function(e,f,j){function i(b,
a,h,d){function c(a){g.push({property:h,message:a})}function e(a,b){if(a){if(typeof a=="string"&&a!="any"&&(a=="null"?b!==null:typeof b!=a)&&!(b instanceof Array&&a=="array")&&!(a=="integer"&&b%1===0))return[{property:h,message:typeof b+" value found, but a "+a+" is required"}];if(a instanceof Array){for(var c=[],d=0;d<a.length;d++)if(!(c=e(a[d],b)).length)break;if(c.length)return c}else if(typeof a=="object")return c=g,g=[],i(b,a,h),d=g,g=c,d}return[]}var f;h+=h?typeof d=="number"?"["+d+"]":typeof d==
"undefined"?"":"."+d:d;if((typeof a!="object"||a instanceof Array)&&(h||typeof a!="function"))return typeof a=="function"?Object(b)instanceof a||c("is not an instance of the class/constructor "+a.name):a&&c("Invalid schema/property definition "+a),null;j&&a.readonly&&c("is a readonly field, it can not be changed");a["extends"]&&i(b,a["extends"],h,d);if(b===void 0)a.optional||c("is missing and it is not optional");else if(g=g.concat(e(a.type,b)),a.disallow&&!e(a.disallow,b).length&&c(" disallowed value was matched"),
b!==null){if(b instanceof Array){if(a.items)if(a.items instanceof Array){d=0;for(f=b.length;d<f;d++)g.concat(i(b[d],a.items[d],h,d))}else{d=0;for(f=b.length;d<f;d++)g.concat(i(b[d],a.items,h,d))}a.minItems&&b.length<a.minItems&&c("There must be a minimum of "+a.minItems+" in the array");a.maxItems&&b.length>a.maxItems&&c("There must be a maximum of "+a.maxItems+" in the array")}else a.properties&&g.concat(m(b,a.properties,h,a.additionalProperties));a.pattern&&typeof b=="string"&&!b.match(a.pattern)&&
c("does not match the regex pattern "+a.pattern);a.maxLength&&typeof b=="string"&&b.length>a.maxLength&&c("may only be "+a.maxLength+" characters long");a.minLength&&typeof b=="string"&&b.length<a.minLength&&c("must be at least "+a.minLength+" characters long");typeof a.minimum!==void 0&&typeof b==typeof a.minimum&&a.minimum>b&&c("must have a minimum value of "+a.minimum);typeof a.maximum!==void 0&&typeof b==typeof a.maximum&&a.maximum<b&&c("must have a maximum value of "+a.maximum);if(a["enum"]){d=
a["enum"];f=d.length;for(var l,k=0;k<f;k++)if(d[k]===b){l=1;break}l||c("does not have a value in the enumeration "+d.join(", "))}typeof a.maxDecimal=="number"&&b.toString().match(RegExp("\\.[0-9]{"+(a.maxDecimal+1)+",}"))&&c("may only have "+a.maxDecimal+" digits of decimal places")}return null}function m(b,a,e,d){if(typeof a=="object"){(typeof b!="object"||b instanceof Array)&&g.push({property:e,message:"an object is required"});for(var c in a)if(a.hasOwnProperty(c)&&!(c.charAt(0)=="_"&&c.charAt(1)==
"_")){var f=b[c];i(f,a[c],e,c)}}for(c in b)b.hasOwnProperty(c)&&!(c.charAt(0)=="_"&&c.charAt(1)=="_")&&a&&!a[c]&&d===!1&&g.push({property:e,message:typeof f+"The property "+c+" is not defined in the schema and the schema does not allow additional properties"}),(f=a&&a[c]&&a[c].requires)&&!(f in b)&&g.push({property:e,message:"the presence of the property "+c+" requires that "+f+" also be present"}),f=b[c],a&&typeof a=="object"&&!(c in a)&&i(f,d,e,c),!j&&f&&f.$schema&&(g=g.concat(i(f,f.$schema,e,c)));
return g}var g=[];f&&i(e,f,"",j||"");!j&&e&&e.$schema&&i(e,e.$schema,"","");return{valid:!g.length,errors:g}};