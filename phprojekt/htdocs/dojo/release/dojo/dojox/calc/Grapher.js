/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.calc.Grapher"]||(dojo._hasResource["dojox.calc.Grapher"]=!0,dojo.provide("dojox.calc.Grapher"),dojo.require("dijit._Templated"),dojo.require("dojox.math._base"),dojo.require("dijit.dijit"),dojo.require("dijit.form.DropDownButton"),dojo.require("dijit.TooltipDialog"),dojo.require("dijit.form.TextBox"),dojo.require("dijit.form.Button"),dojo.require("dijit.form.ComboBox"),dojo.require("dijit.form.Select"),dojo.require("dijit.form.CheckBox"),dojo.require("dijit.ColorPalette"),
dojo.require("dojox.charting.Chart2D"),dojo.require("dojox.charting.themes.Tufte"),dojo.require("dojo.colors"),dojo.experimental("dojox.calc.Grapher"),dojo.declare("dojox.calc.Grapher",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("dojox.calc","templates/Grapher.html",'<div>\n<div dojoAttachPoint="chartsParent" class="dojoxCalcChartHolder"></div>\n<span dojoAttachPoint="outerDiv">\n<div dojoType="dijit.form.DropDownButton" dojoAttachPoint="windowOptions" class="dojoxCalcDropDownForWindowOptions" title="Window Options">\n\t<div>Window Options</div>\n\t<div dojoType="dijit.TooltipDialog" dojoAttachPoint="windowOptionsInside" class="dojoxCalcTooltipDialogForWindowOptions" title="">\n\t\t<table class="dojoxCalcGraphOptionTable">\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\tWidth:\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType="dijit.form.TextBox" dojoAttachPoint="graphWidth" class="dojoxCalcGraphWidth" value="500" />\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\tHeight:\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType="dijit.form.TextBox" dojoAttachPoint="graphHeight" class="dojoxCalcGraphHeight" value="500" />\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\tX >=\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType="dijit.form.TextBox" dojoAttachPoint="graphMinX" class="dojoxCalcGraphMinX" value="-10" />\n\t\t\t\t</td>\n\n\t\t\t\t<td>\n\t\t\t\t\tX <=\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType="dijit.form.TextBox" dojoAttachPoint="graphMaxX" class="dojoxCalcGraphMaxX" value="10" />\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\tY >=\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType="dijit.form.TextBox" dojoAttachPoint="graphMinY" class="dojoxCalcGraphMinY" value="-10" />\n\t\t\t\t</td>\n\n\t\t\t\t<td>\n\t\t\t\t\tY <=\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType="dijit.form.TextBox" dojoAttachPoint="graphMaxY" class="dojoxCalcGraphMaxY" value="10" />\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</div>\n\n<BR>\n\n<div class="dojoxCalcGrapherFuncOuterDiv">\n\t<table class="dojoxCalcGrapherFuncTable" dojoAttachPoint="graphTable">\n\t</table>\n</div>\n\n<div dojoType="dijit.form.DropDownButton" dojoAttachPoint=\'addFuncButton\' class="dojoxCalcDropDownAddingFunction">\n\t<div>Add Function</div>\n\t<div dojoType="dijit.TooltipDialog" dojoAttachPoint="addFuncInside" class="dojoxCalcTooltipDialogAddingFunction" title="">\n\t\t<table class="dojoxCalcGrapherModeTable">\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\tMode:\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<select dojoType="dijit.form.Select" dojoAttachPoint="funcMode" class="dojoxCalcFunctionModeSelector">\n\t\t\t\t\t\t<option value="y=" selected="selected">y=</option>\n\t\t\t\t\t\t<option value="x=">x=</option>\n\t\t\t\t\t</select>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t</tr>\n\t\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\t<input dojoType="dijit.form.Button" dojoAttachPoint="createFunc" class="dojoxCalcAddFunctionButton" label="Create" />\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</div>\n<BR>\n<BR>\n<table class="dijitInline dojoxCalcGrapherLayout">\n\t<tr>\n\t\t<td class="dojoxCalcGrapherButtonContainer">\n\t\t\t<input dojoType="dijit.form.Button" class="dojoxCalcGrapherButton" dojoAttachPoint=\'selectAllButton\' label="Select All" />\n\t\t</td>\n\t\t<td class="dojoxCalcGrapherButtonContainer">\n\t\t\t<input dojoType="dijit.form.Button" class="dojoxCalcGrapherButton" dojoAttachPoint=\'deselectAllButton\' label="Deselect All" />\n\t\t</td>\n\t</tr>\n\t<tr>\n\t\t<td class="dojoxCalcGrapherButtonContainer">\n\t\t\t<input dojoType="dijit.form.Button" class="dojoxCalcGrapherButton" dojoAttachPoint=\'drawButton\'label="Draw Selected" />\n\t\t</td>\n\t\t<td class="dojoxCalcGrapherButtonContainer">\n\t\t\t<input dojoType="dijit.form.Button" class="dojoxCalcGrapherButton" dojoAttachPoint=\'eraseButton\' label="Erase Selected" />\n\t\t</td>\n\t</tr>\n\t<tr>\n\t\t<td class="dojoxCalcGrapherButtonContainer">\n\t\t\t<input dojoType="dijit.form.Button" class="dojoxCalcGrapherButton" dojoAttachPoint=\'deleteButton\' label="Delete Selected" />\n\t\t</td>\n\t\t<td class="dojoxCalcGrapherButtonContainer">\n\t\t\t<input dojoType="dijit.form.Button" class="dojoxCalcGrapherButton" dojoAttachPoint=\'closeButton\' label="Close" />\n\t\t</td>\n\t</tr>\n</table>\n</span>\n</div>\n'),
widgetsInTemplate:!0,addXYAxes:function(a){return a.addAxis("x",{max:parseInt(this.graphMaxX.get("value")),min:parseInt(this.graphMinX.get("value")),majorLabels:!0,minorLabels:!0,minorTicks:!1,microTicks:!1,htmlLabels:!0,labelFunc:function(a){return a},maxLabelSize:30,fixUpper:"major",fixLower:"major",majorTick:{length:3}}).addAxis("y",{max:parseInt(this.graphMaxY.get("value")),min:parseInt(this.graphMinY.get("value")),labelFunc:function(a){return a},maxLabelSize:50,vertical:!0,microTicks:!1,minorTicks:!0,
majorTick:{stroke:"black",length:3}})},selectAll:function(){for(var a=0;a<this.rowCount;a++)this.array[a][this.checkboxIndex].set("checked",!0)},deselectAll:function(){for(var a=0;a<this.rowCount;a++)this.array[a][this.checkboxIndex].set("checked",!1)},drawOne:function(){},onDraw:function(){console.log("Draw was pressed")},erase:function(a){for(var f=0,d="Series "+this.array[a][this.funcNumberIndex]+"_"+f;d in this.array[a][this.chartIndex].runs;)this.array[a][this.chartIndex].removeSeries(d),f++,
d="Series "+this.array[a][this.funcNumberIndex]+"_"+f;this.array[a][this.chartIndex].render();this.setStatus(a,"Hidden")},onErase:function(){for(var a=0;a<this.rowCount;a++)this.array[a][this.checkboxIndex].get("checked")&&this.erase(a)},onDelete:function(){for(var a=0;a<this.rowCount;a++)if(this.array[a][this.checkboxIndex].get("checked")){this.erase(a);for(var f=0;f<this.functionRef;f++)this.array[a][f]&&this.array[a][f].destroy&&this.array[a][f].destroy();this.graphTable.deleteRow(a);this.array.splice(a,
1);this.rowCount--;a--}},checkboxIndex:0,functionMode:1,expressionIndex:2,colorIndex:3,dropDownIndex:4,tooltipIndex:5,colorBoxFieldsetIndex:6,statusIndex:7,chartIndex:8,funcNumberIndex:9,evaluatedExpression:10,functionRef:11,createFunction:function(){var a=this.graphTable.insertRow(-1);this.array[a.rowIndex]=[];var f=a.insertCell(-1),d=dojo.create("div");f.appendChild(d);var k=new dijit.form.CheckBox({},d);this.array[a.rowIndex][this.checkboxIndex]=k;dojo.addClass(d,"dojoxCalcCheckBox");f=a.insertCell(-1);
k=this.funcMode.get("value");d=dojo.doc.createTextNode(k);f.appendChild(d);this.array[a.rowIndex][this.functionMode]=k;f=a.insertCell(-1);d=dojo.create("div");f.appendChild(d);k=new dijit.form.TextBox({},d);this.array[a.rowIndex][this.expressionIndex]=k;dojo.addClass(d,"dojoxCalcExpressionBox");d=dojo.create("div");k=new dijit.ColorPalette({changedColor:this.changedColor},d);dojo.addClass(d,"dojoxCalcColorPalette");this.array[a.rowIndex][this.colorIndex]=k;var d=dojo.create("div"),g=new dijit.TooltipDialog({content:k},
d);this.array[a.rowIndex][this.tooltipIndex]=g;dojo.addClass(d,"dojoxCalcContainerOfColor");f=a.insertCell(-1);d=dojo.create("div");f.appendChild(d);var h=dojo.create("fieldset");dojo.style(h,{backgroundColor:"black",width:"1em",height:"1em",display:"inline"});this.array[a.rowIndex][this.colorBoxFieldsetIndex]=h;f=new dijit.form.DropDownButton({label:"Color ",dropDown:g},d);f.containerNode.appendChild(h);this.array[a.rowIndex][this.dropDownIndex]=f;dojo.addClass(d,"dojoxCalcDropDownForColor");f=a.insertCell(-1);
d=dojo.create("fieldset");d.innerHTML="Hidden";this.array[a.rowIndex][this.statusIndex]=d;dojo.addClass(d,"dojoxCalcStatusBox");f.appendChild(d);d=dojo.create("div");dojo.style(d,{position:"absolute",left:"0px",top:"0px"});this.chartsParent.appendChild(d);this.array[a.rowIndex][this.chartNodeIndex]=d;dojo.addClass(d,"dojoxCalcChart");d=(new dojox.charting.Chart2D(d)).setTheme(dojox.charting.themes.Tufte).addPlot("default",{type:"Lines",shadow:{dx:1,dy:1,width:2,color:[0,0,0,0.3]}});this.addXYAxes(d);
this.array[a.rowIndex][this.chartIndex]=d;k.set("chart",d);k.set("colorBox",h);k.set("onChange",dojo.hitch(k,"changedColor"));this.array[a.rowIndex][this.funcNumberIndex]=this.funcNumber++;this.rowCount++},setStatus:function(a,f){this.array[a][this.statusIndex].innerHTML=f},changedColor:function(){for(var a=this.get("chart"),f=this.get("colorBox"),d=0;d<a.series.length;d++)if(a.series[d].stroke&&a.series[d].stroke.color)a.series[d].stroke.color=this.get("value"),a.dirty=!0;a.render();dojo.style(f,
{backgroundColor:this.get("value")})},makeDirty:function(){this.dirty=!0},checkDirty1:function(){setTimeout(dojo.hitch(this,"checkDirty"),0)},checkDirty:function(){if(this.dirty){for(var a=0;a<this.rowCount;a++)this.array[a][this.chartIndex].removeAxis("x"),this.array[a][this.chartIndex].removeAxis("y"),this.addXYAxes(this.array[a][this.chartIndex]);this.onDraw()}this.dirty=!1},postCreate:function(){this.inherited(arguments);this.createFunc.set("onClick",dojo.hitch(this,"createFunction"));this.selectAllButton.set("onClick",
dojo.hitch(this,"selectAll"));this.deselectAllButton.set("onClick",dojo.hitch(this,"deselectAll"));this.drawButton.set("onClick",dojo.hitch(this,"onDraw"));this.eraseButton.set("onClick",dojo.hitch(this,"onErase"));this.deleteButton.set("onClick",dojo.hitch(this,"onDelete"));this.dirty=!1;this.graphWidth.set("onChange",dojo.hitch(this,"makeDirty"));this.graphHeight.set("onChange",dojo.hitch(this,"makeDirty"));this.graphMaxX.set("onChange",dojo.hitch(this,"makeDirty"));this.graphMinX.set("onChange",
dojo.hitch(this,"makeDirty"));this.graphMaxY.set("onChange",dojo.hitch(this,"makeDirty"));this.graphMinY.set("onChange",dojo.hitch(this,"makeDirty"));this.windowOptionsInside.set("onClose",dojo.hitch(this,"checkDirty1"));this.rowCount=this.funcNumber=0;this.array=[]},startup:function(){this.inherited(arguments);var a=dijit.getEnclosingWidget(this.domNode.parentNode);a&&typeof a.close=="function"?this.closeButton.set("onClick",dojo.hitch(a,"close")):dojo.style(this.closeButton.domNode,"display","none");
this.createFunction();this.array[0][this.checkboxIndex].set("checked",!0);this.onDraw();this.erase(0);this.array[0][this.expressionIndex].value=""}}),function(){var a=1.0E-15/9,f=Math.log(2),d={graphNumber:0,fOfX:!0,color:{stroke:"black"}};dojox.calc.Grapher.draw=function(a,g,h){h=dojo.mixin({},d,h);a.fullGeometry();var g=h.fOfX==!0?dojox.calc.Grapher.generatePoints(g,"x","y",a.axes.x.scaler.bounds.span,a.axes.x.scaler.bounds.lower,a.axes.x.scaler.bounds.upper,a.axes.y.scaler.bounds.lower,a.axes.y.scaler.bounds.upper):
dojox.calc.Grapher.generatePoints(g,"y","x",a.axes.y.scaler.bounds.span,a.axes.y.scaler.bounds.lower,a.axes.y.scaler.bounds.upper,a.axes.x.scaler.bounds.lower,a.axes.x.scaler.bounds.upper),f=0;if(g.length>0)for(;f<g.length;f++)g[f].length>0&&a.addSeries("Series "+h.graphNumber+"_"+f,g[f],h.color);for(var i="Series "+h.graphNumber+"_"+f;i in a.runs;)a.removeSeries(i),f++,i="Series "+h.graphNumber+"_"+f;a.render();return g};dojox.calc.Grapher.generatePoints=function(d,g,h,l,i,b,o,n){function s(a,b,
c,d){for(;b<=c;){var f={};f[g]=(b[g]+c[g])/2;f[h]=a(f[g]);if(d==f[h]||f[g]==c[g]||f[g]==b[g])return f;var e=!0;d<f[h]&&(e=!1);f[h]<c[h]?e?b=f:c=f:f[h]<b[h]&&(e?c=f:b=f)}return NaN}function v(b,c,d){for(var f=[[],[]],e;c[g]<=d[g];){var i=(c[g]+d[g])/2;e={};e[g]=i;e[h]=b(i);var i=e[g]+(e[g]>-1&&e[g]<1?e[g]<0?e[g]>=-a?-e[g]:e[g]/Math.ceil(e[g]/a):a:Math.abs(e[g])*a),j={};j[g]=i;j[h]=b(i);if(Math.abs(j[h])>=Math.abs(e[h]))f[0].push(e),c=j;else{f[1].unshift(e);if(d[g]==e[g])break;d=e}}return f}function t(a,
b){var c=!1,d=!1;a<b&&(c=!0);b>0&&(d=!0);return{inc:c,pos:d}}function p(a,b){return(b[h]-a[h])/(b[g]-a[g])}var l=1<<Math.ceil(Math.log(l)/f),m=(b-i)/l,b=[],e=0,c,j;b[e]=[];for(var r=i,u=0;u<=l;r+=m,u++){i={};i[g]=r;i[h]=d({_name:g,_value:r,_graphing:!0});if(i[g]==null||i[h]==null)return{};if(!isNaN(i[h])&&!isNaN(i[g]))if(b[e].push(i),b[e].length==3)c=t(p(b[e][b[e].length-3],b[e][b[e].length-2]),p(b[e][b[e].length-2],b[e][b[e].length-1]));else if(!(b[e].length<4)&&(j=t(p(b[e][b[e].length-3],b[e][b[e].length-
2]),p(b[e][b[e].length-2],b[e][b[e].length-1])),c.inc!=j.inc||c.pos!=j.pos)){var q=v(d,b[e][b[e].length-3],b[e][b[e].length-1]),i=b[e].pop();b[e].pop();for(c=0;c<q[0].length;c++)b[e].push(q[0][c]);for(c=1;c<q.length;c++)b[++e]=q.pop();b[e].push(i);c=j}}for(;b.length>1;){for(c=0;c<b[1].length;c++)b[0][b[0].length-1][g]!=b[1][c][g]&&b[0].push(b[1][c]);b.splice(1,1)}b=b[0];l=0;m=[[]];for(c=0;c<b.length;c++)if(isNaN(b[c][h])||isNaN(b[c][g])){for(;isNaN(b[c][h])||isNaN(b[c][g]);)b.splice(c,1);m[++l]=[];
c--}else if(b[c][h]>n||b[c][h]<o){c>0&&b[c-1].y!=o&&b[c-1].y!=n&&(j=p(b[c-1],b[c]),j>1.0E200?j=1.0E200:j<-1.0E200&&(j=-1.0E200),e=b[c][h]>n?n:o,i=b[c][h]-j*b[c][g],j=(e-i)/j,i={},i[g]=j,i[h]=d(j),i[h]!=e&&(i=s(d,b[c-1],b[c],e)),m[l].push(i),m[++l]=[]);for(;c<b.length&&(b[c][h]>n||b[c][h]<o);)c++;if(c>=b.length){m[l].length==0&&m.splice(l,1);break}c>0&&b[c].y!=o&&b[c].y!=n&&(j=p(b[c-1],b[c]),j>1.0E200?j=1.0E200:j<-1.0E200&&(j=-1.0E200),e=b[c-1][h]>n?n:o,i=b[c][h]-j*b[c][g],j=(e-i)/j,i={},i[g]=j,i[h]=
d(j),i[h]!=e&&(i=s(d,b[c-1],b[c],e)),m[l].push(i),m[l].push(b[c]))}else m[l].push(b[c]);return m}}());