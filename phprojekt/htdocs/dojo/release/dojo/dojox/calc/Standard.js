/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.calc.Standard"]||(dojo._hasResource["dojox.calc.Standard"]=!0,dojo.provide("dojox.calc.Standard"),dojo.require("dijit._Templated"),dojo.require("dojox.math._base"),dojo.require("dijit.dijit"),dojo.require("dijit.Menu"),dojo.require("dijit.form.DropDownButton"),dojo.require("dijit.TooltipDialog"),dojo.require("dijit.form.TextBox"),dojo.require("dijit.form.Button"),dojo.require("dojox.calc._Executor"),dojo.experimental("dojox.calc.Standard"),dojo.declare("dojox.calc.Standard",
[dijit._Widget,dijit._Templated],{templateString:dojo.cache("dojox.calc","templates/Standard.html",'<div class="dijitReset dijitInline dojoxCalc"\n><table class="dijitReset dijitInline dojoxCalcLayout" dojoAttachPoint="calcTable" rules="none" cellspacing=0 cellpadding=0 border=0>\n\t<tr\n\t\t><td colspan="4" class="dojoxCalcInputContainer"\n\t\t\t><input dojoType="dijit.form.TextBox" dojoAttachEvent="onBlur:onBlur,onKeyPress:onKeyPress" dojoAttachPoint=\'textboxWidget\'\n\t\t/></td\n\t></tr>\n\t<tr>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="seven" label="7" value=\'7\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="eight" label="8" value=\'8\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="nine" label="9" value=\'9\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="divide" label="/" value=\'/\' dojoAttachEvent=\'onClick:insertOperator\' />\n\t\t</td>\n\t</tr>\n\t<tr>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="four" label="4" value=\'4\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="five" label="5" value=\'5\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="six" label="6" value=\'6\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="multiply" label="*" value=\'*\' dojoAttachEvent=\'onClick:insertOperator\' />\n\t\t</td>\n\t</tr>\n\t<tr>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="one" label="1" value=\'1\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="two" label="2" value=\'2\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="three" label="3" value=\'3\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="add" label="+" value=\'+\' dojoAttachEvent=\'onClick:insertOperator\' />\n\t\t</td>\n\t</tr>\n\t<tr>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="decimal" label="." value=\'.\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="zero" label="0" value=\'0\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="equals" label="x=y" value=\'=\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcMinusButtonContainer">\n\t\t\t<span dojoType="dijit.form.ComboButton" dojoAttachPoint="subtract" label=\'-\' value=\'-\' dojoAttachEvent=\'onClick:insertOperator\'>\n\n\t\t\t\t<div dojoType="dijit.Menu" style="display:none;">\n\t\t\t\t\t<div dojoType="dijit.MenuItem" dojoAttachEvent="onClick:insertMinus">\n\t\t\t\t\t\t(-)\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</span>\n\t\t</td>\n\t</tr>\n\t<tr>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="clear" label="Clear" dojoAttachEvent=\'onClick:clearText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="sqrt" label="&#x221A;" value="&#x221A;" dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="power" label="^" value="^" dojoAttachEvent=\'onClick:insertOperator\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="comma" label="," value=\',\' dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t</tr>\n\t<tr>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="AnsButton" label="Ans" value="Ans" dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="LeftParenButton" label="(" value="(" dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="RightParenButton" label=")" value=")" dojoAttachEvent=\'onClick:insertText\' />\n\t\t</td>\n\t\t<td class="dojoxCalcButtonContainer">\n\t\t\t<button dojoType="dijit.form.Button" dojoAttachPoint="enter" label="Enter" dojoAttachEvent=\'onClick:parseTextbox\' />\n\t\t</td>\n\t</tr>\n</table>\n<span dojoAttachPoint="executor" dojoType="dojox.calc._Executor" dojoAttachEvent="onLoad:executorLoaded"></span>\n</div>\n'),
readStore:null,writeStore:null,functions:[],widgetsInTemplate:!0,executorLoaded:function(){dojo.addOnLoad(dojo.hitch(this,function(){this.loadStore(this.readStore,!0);this.loadStore(this.writeStore)}))},saveFunction:function(a,b,c){this.functions[a]=this.executor.normalizedFunction(a,b,c);this.functions[a].args=b;this.functions[a].body=c},loadStore:function(a,b){function c(a){for(var b=0;b<a.length;b++)this.saveFunction(a[b].name[0],a[b].args[0],a[b].body[0])}function d(a){for(var b=0;b<a.length;b++)this.executor.normalizedFunction(a[b].name[0],
a[b].args[0],a[b].body[0])}a!=null&&(b?a.fetch({onComplete:dojo.hitch(this,d),onError:function(a){console.error(a)}}):a.fetch({onComplete:dojo.hitch(this,c),onError:function(a){console.error(a)}}))},parseTextbox:function(){var a=this.textboxWidget.textbox.value;if(a==""&&this.commandList.length>0)this.setTextboxValue(this.textboxWidget,this.commandList[this.commandList.length-1]),a=this.textboxWidget.textbox.value;if(a!=""){var b=this.executor.eval(a);if(typeof b=="number"&&isNaN(b))(this.commandList.length==
0||this.commandList[this.commandList.length-1]!=a)&&this.commandList.push(a),this.print(a,!1),this.print("Not a Number",!0);else if((typeof b=="object"&&"length"in b||typeof b!="object")&&typeof b!="function"&&b!=null)this.executor.eval("Ans="+b),(this.commandList.length==0||this.commandList[this.commandList.length-1]!=a)&&this.commandList.push(a),this.print(a,!1),this.print(b,!0);this.commandIndex=this.commandList.length-1;if(this.hasDisplay)this.displayBox.scrollTop=this.displayBox.scrollHeight;
dijit.selectInputText(this.textboxWidget.textbox)}else this.textboxWidget.focus()},cycleCommands:function(a,b,c){if(!(a==-1||this.commandList.length==0))a=c.charOrCode,a==dojo.keys.UP_ARROW?this.cycleCommandUp():a==dojo.keys.DOWN_ARROW&&this.cycleCommandDown()},cycleCommandUp:function(){this.commandIndex-1<0?this.commandIndex=0:this.commandIndex--;this.setTextboxValue(this.textboxWidget,this.commandList[this.commandIndex])},cycleCommandDown:function(){this.commandIndex+1>=this.commandList.length?
(this.commandIndex=this.commandList.length,this.setTextboxValue(this.textboxWidget,"")):(this.commandIndex++,this.setTextboxValue(this.textboxWidget,this.commandList[this.commandIndex]))},onBlur:function(){if(dojo.isIE){var a=dojo.doc.selection.createRange().duplicate(),b=a.text||"",c=this.textboxWidget.textbox.createTextRange();a.move("character",0);c.move("character",0);try{c.setEndPoint("EndToEnd",a),this.textboxWidget.textbox.selectionEnd=(this.textboxWidget.textbox.selectionStart=String(c.text).replace(/\r/g,
"").length)+b.length}catch(d){}}},onKeyPress:function(a){if(a.charOrCode==dojo.keys.ENTER)this.parseTextbox(),dojo.stopEvent(a);else if(a.charOrCode=="!"||a.charOrCode=="^"||a.charOrCode=="*"||a.charOrCode=="/"||a.charOrCode=="-"||a.charOrCode=="+"){if(dojo.isIE){var b=dojo.doc.selection.createRange().duplicate(),c=b.text||"",d=this.textboxWidget.textbox.createTextRange();b.move("character",0);d.move("character",0);try{d.setEndPoint("EndToEnd",b),this.textboxWidget.textbox.selectionEnd=(this.textboxWidget.textbox.selectionStart=
String(d.text).replace(/\r/g,"").length)+c.length}catch(e){}}this.textboxWidget.get("value")==""?this.setTextboxValue(this.textboxWidget,"Ans"):this.putInAnsIfTextboxIsHighlighted(this.textboxWidget.textbox,a.charOrCode)&&(this.setTextboxValue(this.textboxWidget,"Ans"),dijit.selectInputText(this.textboxWidget.textbox,this.textboxWidget.textbox.value.length,this.textboxWidget.textbox.value.length))}},insertMinus:function(){this.insertText("-")},print:function(a,b){var c="<span style='display:block;";
c+=b?"text-align:right;'>":"text-align:left;'>";c+=a+"<br></span>";this.hasDisplay?this.displayBox.innerHTML+=c:this.setTextboxValue(this.textboxWidget,a)},setTextboxValue:function(a,b){a.set("value",b)},putInAnsIfTextboxIsHighlighted:function(a){if(typeof a.selectionStart=="number"){if(a.selectionStart==0&&a.selectionEnd==a.value.length)return!0}else if(document.selection){var b=document.selection.createRange();if(a.value==b.text)return!0}return!1},clearText:function(){this.hasDisplay&&this.textboxWidget.get("value")==
""?this.displayBox.innerHTML="":this.setTextboxValue(this.textboxWidget,"");this.textboxWidget.focus()},insertOperator:function(a){var b;if(typeof a=="object")b=a=dijit.getEnclosingWidget(a.target).value,a=b;if(this.textboxWidget.get("value")==""||this.putInAnsIfTextboxIsHighlighted(this.textboxWidget.textbox))a="Ans"+a;this.insertText(a)},insertText:function(a){setTimeout(dojo.hitch(this,function(){var f;var b=this.textboxWidget.textbox;if(b.value=="")b.selectionStart=0,b.selectionEnd=0;if(typeof a==
"object")f=a=dijit.getEnclosingWidget(a.target).value,a=f;var c=b.value.replace(/\r/g,"");if(typeof b.selectionStart=="number"){var d=b.selectionStart,e=0;if(navigator.userAgent.indexOf("Opera")!=-1)e=(b.value.substring(0,d).match(/\r/g)||[]).length;b.value=c.substring(0,b.selectionStart-e)+a+c.substring(b.selectionEnd-e);b.focus();d+=a.length;dijit.selectInputText(this.textboxWidget.textbox,d,d)}else if(document.selection){if(this.handle)clearTimeout(this.handle),this.handle=null;b.focus();this.handle=
setTimeout(function(){var b=document.selection.createRange();b.text=a;b.select();this.handle=null},0)}}),0)},hasDisplay:!1,postCreate:function(){this.handle=null;this.commandList=[];this.commandIndex=0;if(this.displayBox)this.hasDisplay=!0;this.toFracButton&&!dojox.calc.toFrac&&dojo.style(this.toFracButton.domNode,{visibility:"hidden"});this.functionMakerButton&&!dojox.calc.FuncGen&&dojo.style(this.functionMakerButton.domNode,{visibility:"hidden"});this.grapherMakerButton&&!dojox.calc.Grapher&&dojo.style(this.grapherMakerButton.domNode,
{visibility:"hidden"});this._connects.push(dijit.typematic.addKeyListener(this.textboxWidget.textbox,{charOrCode:dojo.keys.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1},this,this.cycleCommands,200,200));this._connects.push(dijit.typematic.addKeyListener(this.textboxWidget.textbox,{charOrCode:dojo.keys.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1},this,this.cycleCommands,200,200));this.startup()}}));