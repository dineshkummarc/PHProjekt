/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.gantt.TabMenu"]||(dojo._hasResource["dojox.gantt.TabMenu"]=!0,dojo.provide("dojox.gantt.TabMenu"),dojo.require("dijit.dijit"),dojo.require("dijit.Menu"),dojo.require("dijit.Dialog"),dojo.require("dijit.form.NumberSpinner"),dojo.require("dijit.form.Button"),dojo.require("dijit.form.CheckBox"),dojo.require("dijit.form.DateTextBox"),dojo.require("dijit.form.TimeTextBox"),dojo.require("dojo.date.locale"),dojo.require("dijit.form.Form"),dojo.require("dojo.parser"),function(){dojo.declare("dojox.gantt.TabMenu",
null,{constructor:function(a){this.ganttChart=a;this.tabPanelDlgId=this.tabPanelDlg=this.paneActionBar=this.paneContentArea=this.menuPanel=null;this.arrTabs=[];this.isShow=!1;this.buildContent()},buildContent:function(){this.createMenuPanel();this.createTabPanel();var a=this.createTab(11,"Add Successor Task","t",!0,this);a.addItem(1,"Id","id",!0);a.addItem(2,"Name","name");a.addItem(3,"Start Time","startTime");a.addItem(4,"Duration (hours)","duration");a.addItem(5,"Percent Complete (%)","percentage");
a.addItem(6,"Task Assignee","taskOwner");a.addAction("addSuccessorTaskAction");a=this.createTab(10,"Add Child Task","t",!0,this);a.addItem(1,"Id","id",!0);a.addItem(2,"Name","name");a.addItem(3,"Start Time","startTime");a.addItem(4,"Duration (hours)","duration");a.addItem(5,"Percent Complete (%)","percentage");a.addItem(6,"Task Assignee","taskOwner");a.addAction("addChildTaskAction");a=this.createTab(4,"Set Duration(hours)","t",!0,this,!0);a.addItem(1,"Duration (hours)","duration",!0);a.addAction("durationUpdateAction");
a=this.createTab(5,"Set Complete Percentage (%)","t",!0,this,!0);a.addItem(1,"Percent Complete (%)","percentage",!0);a.addAction("cpUpdateAction");a=this.createTab(20,"Set Owner","t",!0,this,!0);a.addItem(1,"Task Assignee","taskOwner",!0);a.addAction("ownerUpdateAction");a=this.createTab(13,"Set Previous Task","t",!0,this);a.addItem(1,"Previous Task Id","previousTaskId",!0);a.addAction("ptUpdateAction");a=this.createTab(1,"Rename Task","t",!0,this,!0);a.addItem(1,"New Name","name",!0);a.addAction("renameTaskAction");
this.createTab(2,"Delete Task","t",!0,this).addAction("deleteAction");a=this.createTab(12,"Add New Project","p",!1,this);a.addItem(1,"Id","id",!0);a.addItem(2,"Name","name",!0);a.addItem(3,"Start Date","startDate",!0);a.addAction("addProjectAction");a=this.createTab(8,"Set Complete Percentage (%)","p",!0,this,!0);a.addItem(1,"Percent Complete (%)","percentage",!0);a.addAction("cpProjectAction");a=this.createTab(6,"Rename Project","p",!0,this,!0);a.addItem(1,"New Name","name",!0);a.addAction("renameProjectAction");
this.createTab(7,"Delete Project","p",!0,this).addAction("deleteProjectAction");a=this.createTab(9,"Add New Task","p",!0,this);a.addItem(1,"Id","id",!0);a.addItem(2,"Name","name");a.addItem(3,"Start Time","startTime");a.addItem(4,"Duration (hours)","duration");a.addItem(5,"Percent Complete (%)","percentage");a.addItem(6,"Task Assignee","taskOwner");a.addItem(7,"Parent Task Id","parentTaskId");a.addItem(8,"Previous Task Id","previousTaskId");a.addAction("addTaskAction")},createMenuPanel:function(){this.menuPanel=
dojo.create("div",{innerHTML:"<table></table>",className:"ganttMenuPanel"},this.ganttChart.content);dojo.addClass(this.menuPanel.firstChild,"ganttContextMenu");this.menuPanel.firstChild.cellPadding=0;this.menuPanel.firstChild.cellSpacing=0},createTabPanel:function(){this.tabPanelDlg=dijit.byId(this.tabPanelDlgId)||new dijit.Dialog({title:"Settings"});this.tabPanelDlgId=this.tabPanelDlg.id;this.tabPanelDlg.closeButtonNode.style.display="none";var a=this.tabPanelDlg.containerNode;this.paneContentArea=
dojo.create("div",{className:"dijitDialogPaneContentArea"},a);this.paneActionBar=dojo.create("div",{className:"dijitDialogPaneActionBar"},a);this.paneContentArea.innerHTML="<table cellpadding=0 cellspacing=0><tr><th></th></tr><tr><td></td></tr></table>";a=this.paneContentArea.firstChild.rows[0].cells[0];a.colSpan=2;a.innerHTML="Description: ";dojo.addClass(a,"ganttDialogContentHeader");a=this.paneContentArea.firstChild.rows[1].cells[0];a.innerHTML="<table></table>";dojo.addClass(a.firstChild,"ganttDialogContentCell");
a.align="center";this.ok=new dijit.form.Button({label:"OK"});this.cancel=new dijit.form.Button({label:"Cancel"});this.paneActionBar.appendChild(this.ok.domNode);this.paneActionBar.appendChild(this.cancel.domNode)},addItemMenuPanel:function(a){var b=this.menuPanel.firstChild.insertRow(this.menuPanel.firstChild.rows.length),c=dojo.create("td",{className:"ganttContextMenuItem",innerHTML:a.Description});dojo.attr(c,"tabIndex",0);this.ganttChart._events.push(dojo.connect(c,"onclick",this,function(){try{this.hide(),
a.show()}catch(b){console.log("dialog open exception: "+b.message)}}));this.ganttChart._events.push(dojo.connect(c,"onkeydown",this,function(b){if(b.keyCode==dojo.keys.ENTER)try{this.hide(),a.show()}catch(c){console.log("dialog open exception: "+c.message)}}));this.ganttChart._events.push(dojo.connect(c,"onmouseover",this,function(){dojo.addClass(c,"ganttContextMenuItemHover")}));this.ganttChart._events.push(dojo.connect(c,"onmouseout",this,function(){dojo.removeClass(c,"ganttContextMenuItemHover")}));
b.appendChild(c)},show:function(a,b){b.constructor==dojox.gantt.GanttTaskControl?dojo.forEach(this.arrTabs,function(a){if(a.type=="t")a.object=b,this.addItemMenuPanel(a)},this):b.constructor==dojox.gantt.GanttProjectControl&&dojo.forEach(this.arrTabs,function(a){if(a.type=="p")a.object=b,this.addItemMenuPanel(a)},this);this.isShow=!0;dojo.style(this.menuPanel,{zIndex:15,visibility:"visible"});var c=dojo.position(this.menuPanel,!0),e=dojo.position(this.ganttChart.content,!0),d=dojo.coords(a,!0);this.menuPanel.style.top=
d.y+c.h>e.y+e.h+50?d.y-c.h+d.h+"px":d.y+"px";this.menuPanel.style.left=dojo._isBodyLtr()?d.x+d.w+5+"px":d.x-c.w-5+"px"},hide:function(){this.isShow=!1;this.menuPanel.style.visibility="hidden"},clear:function(){this.menuPanel.removeChild(this.menuPanel.firstChild);this.menuPanel.innerHTML="<table></table>";dojo.addClass(this.menuPanel.firstChild,"ganttContextMenu");this.menuPanel.firstChild.cellPadding=0;this.menuPanel.firstChild.cellSpacing=0},createTab:function(a,b,c,e,d,f){a=new dojox.gantt.contextMenuTab(a,
b,c,e,d,f);this.arrTabs.push(a);return a}});dojo.declare("dojox.gantt.contextMenuTab",null,{constructor:function(a,b,c,e,d,f){this.id=a;this.arrItems=[];this.TabItemContainer=null;this.Description=b;this.tabMenu=d;this.type=c;this.object=null;this.showObjectInfo=e;this.withDefaultValue=f},preValueValidation:function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.required&&!c.control.textbox.value)return!1}return!0},encodeDate:function(a){return a.getFullYear()+"."+(a.getMonth()+1)+"."+a.getDate()},
decodeDate:function(a){a=a.split(".");return a.length<3?"":new Date(a[0],parseInt(a[1])-1,a[2])},renameTaskAction:function(){var a=this.arrItems[0].control.textbox.value;!(dojo.trim(a).length<=0)&&this.preValueValidation(this.arrItems)&&(this.object.setName(a),this.hide())},deleteAction:function(){this.preValueValidation(this.arrItems)&&(this.object.project.deleteTask(this.object.taskItem.id),this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct())},durationUpdateAction:function(){var a=
this.arrItems[0].control.textbox.value;this.preValueValidation(this.arrItems)&&(this.object.setDuration(a)?(this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.refresh()):alert("Duration out of Range"))},cpUpdateAction:function(){var a=this.arrItems[0].control.textbox.value;this.preValueValidation(this.arrItems)&&(this.object.setPercentCompleted(a)?this.hide():alert("Complete Percentage out of Range"))},ownerUpdateAction:function(){var a=this.arrItems[0].control.textbox.value;
this.preValueValidation(this.arrItems)&&(this.object.setTaskOwner(a)?(this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()):alert("Task owner not Valid"))},ptUpdateAction:function(){var a=this.arrItems[0].control.textbox.value;this.preValueValidation(this.arrItems)&&(this.object.setPreviousTask(a)?this.hide():alert("Please verify the Previous Task ("+a+")  and adjust its Time Range"))},renameProjectAction:function(){var a=this.arrItems[0].control.textbox.value;
!(dojo.trim(a).length<=0)&&this.preValueValidation(this.arrItems)&&(this.object.setName(a),this.hide())},deleteProjectAction:function(){this.preValueValidation(this.arrItems)&&(this.object.ganttChart.deleteProject(this.object.project.id),this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct())},cpProjectAction:function(){var a=this.arrItems[0].control.textbox.value;this.preValueValidation(this.arrItems)&&(this.object.setPercentCompleted(a)?this.hide():alert("Percentage not Acceptable"))},
addTaskAction:function(){if(this.preValueValidation(this.arrItems)){var a=this.arrItems[0].control.textbox.value,b=this.arrItems[1].control.textbox.value,c=this.decodeDate(this.arrItems[2].control.textbox.value),e=this.arrItems[3].control.textbox.value,d=this.arrItems[4].control.textbox.value,f=this.arrItems[5].control.textbox.value,g=this.arrItems[6].control.textbox.value,h=this.arrItems[7].control.textbox.value;dojo.trim(a).length<=0||(this.object.insertTask(a,b,c,e,d,h,f,g)?(this.hide(),this.tabMenu.ganttChart.resource&&
this.tabMenu.ganttChart.resource.reConstruct()):alert("Please adjust your Customization"))}},addSuccessorTaskAction:function(){if(this.preValueValidation(this.arrItems)){var a=this.object.project,b=this.arrItems[0].control.textbox.value,c=this.arrItems[1].control.textbox.value,e=this.decodeDate(this.arrItems[2].control.textbox.value),d=this.arrItems[3].control.textbox.value,f=this.arrItems[4].control.textbox.value,g=this.arrItems[5].control.textbox.value;dojo.trim(b).length<=0||(a.insertTask(b,c,
e,d,f,this.object.taskItem.id,g,!this.object.parentTask?"":this.object.parentTask.taskItem.id)?(this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()):alert("Please adjust your Customization"))}},addChildTaskAction:function(){if(this.preValueValidation(this.arrItems)){var a=this.object.project,b=this.arrItems[0].control.textbox.value,c=this.arrItems[1].control.textbox.value,e=this.decodeDate(this.arrItems[2].control.textbox.value),d=this.arrItems[3].control.textbox.value,
f=this.arrItems[4].control.textbox.value,g=this.arrItems[5].control.textbox.value,h=this.object.taskItem.id;dojo.trim(b).length<=0||(a.insertTask(b,c,e,d,f,"",g,h)?(this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()):alert("Please adjust your Customization"))}},addProjectAction:function(){if(this.preValueValidation(this.arrItems)){var a=this.arrItems[0].control.textbox.value,b=this.arrItems[1].control.textbox.value,c=this.decodeDate(this.arrItems[2].control.textbox.value);
dojo.trim(a).length<=0||dojo.trim(b).length<=0||(this.tabMenu.ganttChart.insertProject(a,b,c)?(this.hide(),this.tabMenu.ganttChart.resource&&this.tabMenu.ganttChart.resource.reConstruct()):alert("Please adjust your Customization"))}},addAction:function(a){this.actionFunc=this[a]},addItem:function(a,b,c,e){var d;d=c=="startTime"||c=="startDate"?new dijit.form.DateTextBox({type:"text",constraints:{datePattern:"yyyy.M.d",strict:!0}}):c=="percentage"?new dijit.form.NumberSpinner({constraints:{max:100,
min:0}}):c=="duration"?new dijit.form.NumberSpinner({constraints:{min:0}}):new dijit.form.TextBox;this.arrItems.push({id:a,name:b,control:d,tab:this,key:c,required:e})},show:function(){this.tabMenu.tabPanelDlg=this.tabMenu.tabPanelDlg||dijit.byId(this.tabMenu.tabPanelDlgId)||new dijit.Dialog({title:"Settings"});try{this.tabMenu.tabPanelDlg.show()}catch(a){console.log("dialog show exception: "+a.message);return}this.tabMenu.tabPanelDlg.titleNode.innerHTML=this.Description;var b=this.tabMenu.paneContentArea.firstChild.rows[1].cells[0].firstChild,
c,e,d=null;this.showObjectInfo&&this.object&&(this.object.constructor==dojox.gantt.GanttTaskControl?(this.insertData(b,"Id",this.object.taskItem.id),this.insertData(b,"Name",this.object.taskItem.name),this.insertData(b,"Start Time",this.encodeDate(this.object.taskItem.startTime)),this.insertData(b,"Duration (hours)",this.object.taskItem.duration+" hours"),this.insertData(b,"Percent Complete (%)",this.object.taskItem.percentage+"%"),this.insertData(b,"Task Assignee",this.object.taskItem.taskOwner),
this.insertData(b,"Previous Task Id",this.object.taskItem.previousTaskId)):(this.insertData(b,"Id",this.object.project.id),this.insertData(b,"Name",this.object.project.name),this.insertData(b,"Start date",this.encodeDate(this.object.project.startDate))));d=b.insertRow(b.rows.length);c=d.insertCell(d.cells.length);c.colSpan=2;c.innerHTML="<hr/>";d=b.insertRow(b.rows.length);c=d.insertCell(d.cells.length);c.colSpan=2;dojo.addClass(c,"ganttMenuDialogInputCellHeader");c.innerHTML="Customization: "+this.Description;
dojo.forEach(this.arrItems,function(a){d=b.insertRow(b.rows.length);c=d.insertCell(d.cells.length);dojo.addClass(c,"ganttMenuDialogInputCell");e=d.insertCell(d.cells.length);dojo.addClass(e,"ganttMenuDialogInputCellValue");c.innerHTML=a.name;e.appendChild(a.control.domNode);this.withDefaultValue&&this.object?a.control.textbox.value=this.object.constructor==dojox.gantt.GanttTaskControl?a.key=="startTime"?this.encodeDate(this.object.taskItem.startTime):a.key?this.object.taskItem[a.key]:"":a.key=="startDate"?
this.encodeDate(this.object.project.startDate):a.key?this.object.project[a.key]||this.object[a.key]||"":"":a.control.textbox.placeholder=a.required?"---required---":"---optional---"},this);this.tabMenu.ok.onClick=dojo.hitch(this,this.actionFunc);this.tabMenu.cancel.onClick=dojo.hitch(this,this.hide)},hide:function(){try{this.tabMenu.tabPanelDlg.hide()}catch(a){console.log("dialog show exception: "+a.message),this.tabMenu.tabPanelDlg.destroy()}var b=this.tabMenu.paneContentArea.firstChild.rows[1].cells[0];
b.firstChild.parentNode.removeChild(b.firstChild);b.innerHTML="<table></table>";dojo.addClass(b.firstChild,"ganttDialogContentCell")},insertData:function(a,b,c){var e=null,e=a.insertRow(a.rows.length),a=e.insertCell(e.cells.length);dojo.addClass(a,"ganttMenuDialogDescCell");a.innerHTML=b;b=e.insertCell(e.cells.length);dojo.addClass(b,"ganttMenuDialogDescCellValue");b.innerHTML=c}})}());