/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.gantt.GanttTaskItem"]||(dojo._hasResource["dojox.gantt.GanttTaskItem"]=!0,dojo.provide("dojox.gantt.GanttTaskItem"),dojo.require("dojo.date.locale"),dojo.declare("dojox.gantt.GanttTaskControl",null,{constructor:function(a,b,c){this.ganttChart=c;this.project=b;this.taskItem=a;this.moveChild=this.checkResize=this.checkMove=!1;this.minWidthResize=this.maxWidthResize=this.minPosXMove=this.maxPosXMove=-1;this.taskItemWidth=this.mouseX=this.posY=this.posX=0;this.isHide=!1;this.hideTasksHeight=
0;this.isExpanded=!0;this.predTask=this.parentTask=this.cTaskNameItem=this.cTaskItem=this.descrTask=null;this.childTask=[];this.childPredTask=[];this.previousParentTask=this.nextParentTask=this.previousChildTask=this.nextChildTask=null},createConnectingLinesPN:function(){var a=[],b=dojo.create("div",{innerHTML:"&nbsp;",className:"ganttTaskLineVerticalLeft"},this.ganttChart.panelNames.firstChild),c=this.cTaskNameItem[0],d=this.parentTask.cTaskNameItem[0];dojo.style(b,{height:c.offsetTop-d.offsetTop+
"px",top:d.offsetTop+5+"px",left:d.offsetLeft-9+"px"});var e=dojo.create("div",{noShade:!0,color:"#000000",className:"ganttTaskLineHorizontalLeft"},this.ganttChart.panelNames.firstChild);dojo.style(e,{left:d.offsetLeft-9+"px",top:c.offsetTop+5+"px",height:"1px",width:c.offsetLeft-d.offsetLeft+4+"px"});a.push(b);a.push(e);return a},createConnectingLinesDS:function(){var a=this.ganttChart.contentData.firstChild,b=[],c=new Image,c=dojo.create("div",{className:"ganttImageArrow"}),d=document.createElement("div"),
e=document.createElement("div"),f=dojo.style(this.predTask.cTaskItem[0],"left"),h=dojo.style(this.predTask.cTaskItem[0],"top"),g=dojo.style(this.cTaskItem[0],"left"),i=this.posY+2;parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);var j=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);h<i?(dojo.addClass(d,"ganttTaskLineVerticalRight"),dojo.style(d,{height:i-this.ganttChart.heightTaskItem/2-h-3+"px",width:"1px",left:f+j-20+"px",top:h+this.ganttChart.heightTaskItem+"px"}),
dojo.addClass(e,"ganttTaskLineHorizontal"),dojo.style(e,{width:15+(g-(j+f))+"px",left:f+j-20+"px",top:i+2+"px"}),dojo.addClass(c,"ganttTaskArrowImg")):(dojo.addClass(d,"ganttTaskLineVerticalRightPlus"),dojo.style(d,{height:h+2-i+"px",width:"1px",left:f+j-20+"px",top:i+2+"px"}),dojo.addClass(e,"ganttTaskLineHorizontalPlus"),dojo.style(e,{width:15+(g-(j+f))+"px",left:f+j-20+"px",top:i+2+"px"}),dojo.addClass(c,"ganttTaskArrowImgPlus"));dojo.style(c,{left:g-7+"px",top:i-1+"px"});a.appendChild(d);a.appendChild(e);
a.appendChild(c);b.push(d);b.push(c);b.push(e);return b},showChildTasks:function(a,b){if(b)for(var c=0;c<a.childTask.length;c++){var d=a.childTask[c],e=d.cTaskItem[0],f=d.cTaskNameItem[0],h=d.cTaskItem[1],g=d.cTaskNameItem[1],i=d.cTaskNameItem[2];if(e.style.display=="none"){e.style.display="inline";f.style.display="inline";d.showDescTask();a.isHide=!1;if(i)i.style.display="inline",b=d.isExpanded;for(e=0;e<h.length;e++)h[e].style.display="inline";for(e=0;e<g.length;e++)g[e].style.display="inline";
d.taskIdentifier&&(d.taskIdentifier.style.display="inline");this.hideTasksHeight+=this.ganttChart.heightTaskItem+this.ganttChart.heightTaskItemExtra;d.childTask.length>0&&this.showChildTasks(d,b)}}},hideChildTasks:function(a){for(var b=0;b<a.childTask.length;b++){var c=a.childTask[b],d=c.cTaskItem[0],e=c.cTaskNameItem[0],f=c.cTaskItem[1],h=c.cTaskNameItem[1],g=c.cTaskNameItem[2];if(d.style.display!="none"){d.style.display="none";e.style.display="none";c.hideDescTask();a.isHide=!0;if(g)g.style.display=
"none";for(d=0;d<f.length;d++)f[d].style.display="none";for(d=0;d<h.length;d++)h[d].style.display="none";c.taskIdentifier&&(c.taskIdentifier.style.display="none");this.hideTasksHeight+=this.ganttChart.heightTaskItem+this.ganttChart.heightTaskItemExtra;c.childTask.length>0&&this.hideChildTasks(c)}}},shiftCurrentTasks:function(a,b){this.shiftNextTask(this,b);a.project.shiftNextProject(a.project,b)},shiftTask:function(a,b){a.posY+=b;var c=a.cTaskItem[0],d=a.cTaskNameItem[0],e=a.cTaskItem[1],f=a.cTaskNameItem[1],
h=a.cTaskNameItem[2];d.style.top=parseInt(d.style.top)+b+"px";if(h)h.style.top=parseInt(h.style.top)+b+"px";if(a.parentTask)parseInt(this.cTaskNameItem[0].style.top)>parseInt(a.parentTask.cTaskNameItem[0].style.top)&&f[0].style.display!="none"?f[0].style.height=parseInt(f[0].style.height)+b+"px":f[0].style.top=parseInt(f[0].style.top)+b+"px",f[1].style.top=parseInt(f[1].style.top)+b+"px";c.style.top=parseInt(c.style.top)+b+"px";a.descrTask.style.top=parseInt(a.descrTask.style.top)+b+"px";if(a.predTask)(parseInt(this.cTaskItem[0].style.top)>
parseInt(a.predTask.cTaskItem[0].style.top)||this.cTaskItem[0].id==a.predTask.taskItem.id)&&e[0].style.display!="none"?e[0].style.height=parseInt(e[0].style.height)+b+"px":e[0].style.top=parseInt(e[0].style.top)+b+"px",e[1].style.top=parseInt(e[1].style.top)+b+"px",e[2].style.top=parseInt(e[2].style.top)+b+"px"},shiftNextTask:function(a,b){a.nextChildTask?(this.shiftTask(a.nextChildTask,b),this.shiftChildTask(a.nextChildTask,b),this.shiftNextTask(a.nextChildTask,b)):a.parentTask?this.shiftNextTask(a.parentTask,
b):a.nextParentTask&&(this.shiftTask(a.nextParentTask,b),this.shiftChildTask(a.nextParentTask,b),this.shiftNextTask(a.nextParentTask,b))},shiftChildTask:function(a,b){dojo.forEach(a.childTask,function(a){this.shiftTask(a,b);a.childTask.length>0&&this.shiftChildTask(a,b)},this)},endMove:function(){var a=this.cTaskItem[0],b=dojo.style(a,"left")-this.posX,b=this.getDateOnPosition(dojo.style(a,"left")),b=this.checkPos(b);this.checkMove&&(b=this.ganttChart.getPosOnDate(b)-this.posX,this.moveCurrentTaskItem(b,
this.moveChild),this.project.shiftProjectItem());this.checkMove=!1;this.posX=0;this.minPosXMove=this.maxPosXMove=-1;a.childNodes[1].firstChild.rows[0].cells[0].innerHTML="";this.adjustPanelTime();this.ganttChart.resource&&this.ganttChart.resource.refresh()},checkPos:function(a){var b=this.cTaskItem[0],c=a.getHours();c>=12?(a.setDate(a.getDate()+1),a.setHours(0),parseInt(b.firstChild.firstChild.width)+this.ganttChart.getPosOnDate(a)>this.maxPosXMove&&this.maxPosXMove!=-1&&(a.setDate(a.getDate()-1),
a.setHours(0))):c<12&&c!=0&&(a.setHours(0),this.ganttChart.getPosOnDate(a)<this.minPosXMove&&a.setDate(a.getDate()+1));b.style.left=this.ganttChart.getPosOnDate(a)+"px";return a},getMaxPosPredChildTaskItem:function(){for(var a=0,b=0,c=0;c<this.childPredTask.length;c++)b=this.getMaxPosPredChildTaskItemInTree(this.childPredTask[c]),b>a&&(a=b);return a},getMaxPosPredChildTaskItemInTree:function(a){var b=a.cTaskItem[0],b=parseInt(b.firstChild.firstChild.width)+dojo.style(b,"left"),c=0,d=0;dojo.forEach(a.childPredTask,
function(a){d=this.getMaxPosPredChildTaskItemInTree(a);d>c&&(c=d)},this);return c>b?c:b},moveCurrentTaskItem:function(a,b){var c=this.cTaskItem[0];this.taskItem.startTime=new Date(this.ganttChart.startDate);this.taskItem.startTime.setHours(this.taskItem.startTime.getHours()+parseInt(c.style.left)/this.ganttChart.pixelsPerHour);this.showDescTask();c=this.cTaskItem[1];if(c.length>0)c[2].style.width=parseInt(c[2].style.width)+a+"px",c[1].style.left=parseInt(c[1].style.left)+a+"px";dojo.forEach(this.childTask,
function(c){c.predTask||this.moveChildTaskItems(c,a,b)},this);dojo.forEach(this.childPredTask,function(c){this.moveChildTaskItems(c,a,b)},this)},moveChildTaskItems:function(a,b,c){var d=a.cTaskItem[0];if(c){d.style.left=parseInt(d.style.left)+b+"px";a.adjustPanelTime();a.taskItem.startTime=new Date(this.ganttChart.startDate);a.taskItem.startTime.setHours(a.taskItem.startTime.getHours()+parseInt(d.style.left)/this.ganttChart.pixelsPerHour);var e=a.cTaskItem[1];dojo.forEach(e,function(a){a.style.left=
parseInt(a.style.left)+b+"px"},this);dojo.forEach(a.childTask,function(a){a.predTask||this.moveChildTaskItems(a,b,c)},this);dojo.forEach(a.childPredTask,function(a){this.moveChildTaskItems(a,b,c)},this)}else if(e=a.cTaskItem[1],e.length>0)d=e[0],e=e[2],e.style.left=parseInt(e.style.left)+b+"px",e.style.width=parseInt(e.style.width)-b+"px",d.style.left=parseInt(d.style.left)+b+"px";a.moveDescTask()},adjustPanelTime:function(){var a=this.cTaskItem[0],a=parseInt(a.style.left)+parseInt(a.firstChild.firstChild.width)+
this.ganttChart.panelTimeExpandDelta;a+=this.descrTask.offsetWidth;this.ganttChart.adjustPanelTime(a)},getDateOnPosition:function(a){var b=new Date(this.ganttChart.startDate);b.setHours(b.getHours()+a/this.ganttChart.pixelsPerHour);return b},moveItem:function(a){var a=this.posX+(a.screenX-this.mouseX),b=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width);this.checkMove&&this.minPosXMove<=a&&(a+b<=this.maxPosXMove||this.maxPosXMove==-1)&&this.moveTaskItem(a)},moveTaskItem:function(a){var b=
this.cTaskItem[0];b.style.left=a+"px";b.childNodes[1].firstChild.rows[0].cells[0].innerHTML=this.getDateOnPosition(a).getDate()+"."+(this.getDateOnPosition(a).getMonth()+1)+"."+this.getDateOnPosition(a).getUTCFullYear()},resizeItem:function(a){this.checkResize&&(a=this.taskItemWidth+(a.screenX-this.mouseX),a>=this.taskItemWidth?a<=this.maxWidthResize||this.maxWidthResize==-1?this.resizeTaskItem(a):this.maxWidthResize!=-1&&a>this.maxWidthResize&&this.resizeTaskItem(this.maxWidthResize):a<=this.taskItemWidth&&
(a>=this.minWidthResize?this.resizeTaskItem(a):a<this.minWidthResize&&this.resizeTaskItem(this.minWidthResize)))},resizeTaskItem:function(a){var b=this.cTaskItem[0],c=Math.round(a/this.ganttChart.pixelsPerWorkHour),d=b.childNodes[0].firstChild.rows[0],e=d.cells[0],d=d.cells[1];e&&(e.firstChild.style.width=parseInt(e.width)*a/100+"px");d&&(d.firstChild.style.width=parseInt(d.width)*a/100+"px");b.childNodes[0].firstChild.width=a+"px";b.childNodes[1].firstChild.width=a+"px";this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML=
c;b=b.childNodes[2];b.childNodes[0].style.width=a+"px";b.childNodes[1].style.left=a-10+"px"},endResizeItem:function(){var a=this.cTaskItem[0];if(this.taskItemWidth!=parseInt(a.childNodes[0].firstChild.width)){var b=a.offsetLeft,c=a.offsetLeft+parseInt(a.childNodes[0].firstChild.width);this.taskItem.duration=Math.round((c-b)/this.ganttChart.pixelsPerWorkHour);if(this.childPredTask.length>0)for(b=0;b<this.childPredTask.length;b++){var d=this.childPredTask[b].cTaskItem[1],c=d[0],d=d[2],e=a.childNodes[0];
d.style.width=parseInt(d.style.width)-(parseInt(e.firstChild.width)-this.taskItemWidth)+"px";d.style.left=parseInt(d.style.left)+(parseInt(e.firstChild.width)-this.taskItemWidth)+"px";c.style.left=parseInt(c.style.left)+(parseInt(e.firstChild.width)-this.taskItemWidth)+"px"}}this.cTaskItem[0].childNodes[1].firstChild.rows[0].cells[0].innerHTML="";this.checkResize=!1;this.mouseX=this.taskItemWidth=0;this.showDescTask();this.project.shiftProjectItem();this.adjustPanelTime();this.ganttChart.resource&&
this.ganttChart.resource.refresh()},startMove:function(a){this.moveChild=a.ctrlKey;this.mouseX=a.screenX;this.getMoveInfo();this.checkMove=!0;this.hideDescTask()},showDescTask:function(){this.descrTask.style.left=parseInt(this.cTaskItem[0].style.left)+this.taskItem.duration*this.ganttChart.pixelsPerWorkHour+10+"px";this.descrTask.innerHTML=this.objKeyToStr(this.getTaskOwner());this.descrTask.style.visibility="visible"},hideDescTask:function(){dojo.style(this.descrTask,"visibility","hidden")},buildResourceInfo:function(a){if(this.childTask&&
this.childTask.length>0)for(var b=0;b<this.childTask.length;b++)this.childTask[b].buildResourceInfo(a);if(dojo.trim(this.taskItem.taskOwner).length>0)for(var c=this.taskItem.taskOwner.split(";"),b=0;b<c.length;b++){var d=c[b];dojo.trim(d).length<=0||(a[d]?a[d].push(this):a[d]=[this])}},objKeyToStr:function(a,b){var c="",b=b||" ";if(a)for(var d in a)c+=b+d;return c},getTaskOwner:function(){var a={};if(dojo.trim(this.taskItem.taskOwner).length>0)for(var b=this.taskItem.taskOwner.split(";"),c=0;c<b.length;c++)a[b[c]]=
1;dojo.forEach(this.childTask,function(b){dojo.mixin(a,b.getTaskOwner())},this);return a},moveDescTask:function(){this.descrTask.style.left=parseInt(this.cTaskItem[0].style.left)+this.taskItem.duration*this.ganttChart.pixelsPerWorkHour+10+"px"},getMoveInfo:function(){this.posX=parseInt(this.cTaskItem[0].style.left);var a=parseInt(this.cTaskItem[0].childNodes[0].firstChild.width),b=!this.parentTask?0:parseInt(this.parentTask.cTaskItem[0].style.left),c=!this.predTask?0:parseInt(this.predTask.cTaskItem[0].style.left)+
parseInt(this.predTask.cTaskItem[0].childNodes[0].firstChild.width),d=!this.parentTask?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width),e=0,f=0,h=0;if(this.childPredTask.length>0){var g=null;dojo.forEach(this.childPredTask,function(a){if(!g||g&&g>parseInt(a.cTaskItem[0].style.left))g=parseInt(a.cTaskItem[0].style.left)},this);e=g}if(this.childTask.length>0){var i=null;dojo.forEach(this.childTask,function(a){if(!i||i&&i>parseInt(a.cTaskItem[0].style.left))i=parseInt(a.cTaskItem[0].style.left)},
this);h=i;g=null;dojo.forEach(this.childTask,function(a){if(!g||g&&g<parseInt(a.cTaskItem[0].style.left)+parseInt(a.cTaskItem[0].firstChild.firstChild.width))g=parseInt(a.cTaskItem[0].style.left)+parseInt(a.cTaskItem[0].firstChild.firstChild.width)},this);f=g}if(this.moveChild){if(b>0&&c==0)this.minPosXMove=b,this.maxPosXMove=b+d;else if(b==0&&c==0)this.minPosXMove=this.ganttChart.initialPos,this.maxPosXMove=-1;else if(b>0&&c>0)this.minPosXMove=c,this.maxPosXMove=b+d;else if(b==0&&c>0)this.minPosXMove=
c,this.maxPosXMove=-1;if(this.parentTask&&this.childPredTask.length>0)g=this.getMaxPosPredChildTaskItem(this),b=parseInt(this.parentTask.cTaskItem[0].style.left)+parseInt(this.parentTask.cTaskItem[0].firstChild.firstChild.width),this.maxPosXMove=this.posX+a+b-g}else{if(this.childPredTask.length>0&&this.maxPosXMove<e)this.maxPosXMove=e;if(this.childTask.length>0){this.childPredTask.length>0&&this.maxPosXMove-a>h&&(this.maxPosXMove-=this.maxPosXMove-a-h);if(!(this.childPredTask.length>0))this.maxPosXMove=
h+a;this.minPosXMove=f-a}if(b>0){if(!(this.childPredTask.length>0)&&this.childTask.length>0&&this.maxPosXMove>b+d)this.maxPosXMove=b+d;if(this.minPosXMove<=b)this.minPosXMove=b;if(!(this.childTask.length>0)&&!(this.childPredTask.length>0))this.maxPosXMove=b+d;else if(!(this.childTask.length>0)&&this.childPredTask.length>0&&b+d>c)this.maxPosXMove=e}if(c>0&&this.minPosXMove<=c)this.minPosXMove=c;if(c==0&&b==0&&this.minPosXMove<=this.ganttChart.initialPos)this.minPosXMove=this.ganttChart.initialPos}},
startResize:function(a){this.mouseX=a.screenX;this.getResizeInfo();this.hideDescTask();this.checkResize=!0;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width)},getResizeInfo:function(){var a=this.cTaskItem[0],b=!this.parentTask?0:parseInt(this.parentTask.cTaskItem[0].style.left),c=!this.parentTask?0:parseInt(this.parentTask.cTaskItem[0].childNodes[0].firstChild.width),a=parseInt(a.style.left),d=0,e=0;if(this.childPredTask.length>0){var f=null;dojo.forEach(this.childPredTask,
function(a){if(!f||f&&f>parseInt(a.cTaskItem[0].style.left))f=parseInt(a.cTaskItem[0].style.left)},this);d=f}this.childTask.length>0&&(f=null,dojo.forEach(this.childTask,function(a){if(!f||f&&f<parseInt(a.cTaskItem[0].style.left)+parseInt(a.cTaskItem[0].firstChild.firstChild.width))f=parseInt(a.cTaskItem[0].style.left)+parseInt(a.cTaskItem[0].firstChild.firstChild.width)},this),e=f);this.minWidthResize=this.ganttChart.pixelsPerDay;if(this.childTask.length>0)this.minWidthResize=e-a;if(this.childPredTask.length>
0&&!this.parentTask)this.maxWidthResize=d-a;else if(this.childPredTask.length>0&&this.parentTask)this.maxWidthResize=Math.min(b+c-a,d-a);else if(this.childPredTask.length==0&&this.parentTask)this.maxWidthResize=b+c-a},createTaskItem:function(){this.posX=this.ganttChart.getPosOnDate(this.taskItem.startTime);var a=dojo.create("div",{id:this.taskItem.id,className:"ganttTaskItemControl"});dojo.style(a,{left:this.posX+"px",top:this.posY+"px"});var b=dojo.create("div",{className:"ganttTaskDivTaskItem"},
a),b=dojo.create("table",{cellPadding:"0",cellSpacing:"0",width:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour+"px",className:"ganttTaskTblTaskItem"},b),b=b.insertRow(b.rows.length);if(this.taskItem.percentage!=0){var c=dojo.create("td",{height:this.ganttChart.heightTaskItem+"px",width:this.taskItem.percentage+"%"},b);c.style.lineHeight="1px";c=dojo.create("div",{className:"ganttImageTaskProgressFilled"},c);dojo.style(c,{width:this.taskItem.percentage*this.taskItem.duration*this.ganttChart.pixelsPerWorkHour/
100+"px",height:this.ganttChart.heightTaskItem+"px"})}if(this.taskItem.percentage!=100)c=dojo.create("td",{height:this.ganttChart.heightTaskItem+"px",width:100-this.taskItem.percentage+"%"},b),c.style.lineHeight="1px",b=dojo.create("div",{className:"ganttImageTaskProgressBg"},c),dojo.style(b,{width:(100-this.taskItem.percentage)*this.taskItem.duration*this.ganttChart.pixelsPerWorkHour/100+"px",height:this.ganttChart.heightTaskItem+"px"});this.ganttChart.isContentEditable&&(b=dojo.create("div",{className:"ganttTaskDivTaskInfo"},
a),b=dojo.create("table",{cellPadding:"0",cellSpacing:"0",height:this.ganttChart.heightTaskItem+"px",width:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour+"px"},b).insertRow(0),dojo.create("td",{align:"center",vAlign:"top",height:this.ganttChart.heightTaskItem+"px",className:"ganttMoveInfo"},b),c=dojo.create("div",{className:"ganttTaskDivTaskName"},a),b=dojo.create("div",{},c),dojo.create("input",{className:"ganttTaskDivMoveInput",type:"text"},b),dojo.isIE&&dojo.style(b,{background:"#000000",
filter:"alpha(opacity=0)"}),dojo.style(b,{height:this.ganttChart.heightTaskItem+"px",width:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour+"px"}),c=dojo.create("div",{className:"ganttTaskDivResize"},c),dojo.create("input",{className:"ganttTaskDivResizeInput",type:"text"},c),dojo.style(c,{left:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour-10+"px",height:this.ganttChart.heightTaskItem+"px",width:"10px"}),this.ganttChart._events.push(dojo.connect(b,"onmousedown",this,function(a){this.moveMoveConn=
dojo.connect(document,"onmousemove",this,function(a){this.checkMove&&this.moveItem(a)});this.moveUpConn=dojo.connect(document,"onmouseup",this,function(){if(this.checkMove)this.endMove(),this.ganttChart.isMoving=!1,document.body.releaseCapture&&document.body.releaseCapture(),dojo.disconnect(this.moveMoveConn),dojo.disconnect(this.moveUpConn)});this.startMove(a);this.ganttChart.isMoving=!0;document.body.setCapture&&document.body.setCapture(!1)})),this.ganttChart._events.push(dojo.connect(b,"onmouseover",
this,function(a){a.target&&(a.target.style.cursor="move")})),this.ganttChart._events.push(dojo.connect(b,"onmouseout",this,function(a){a.target.style.cursor=""})),this.ganttChart._events.push(dojo.connect(c,"onmousedown",this,function(a){this.resizeMoveConn=dojo.connect(document,"onmousemove",this,function(a){this.checkResize&&this.resizeItem(a)});this.resizeUpConn=dojo.connect(document,"onmouseup",this,function(){if(this.checkResize)this.endResizeItem(),this.ganttChart.isResizing=!1,document.body.releaseCapture&&
document.body.releaseCapture(),dojo.disconnect(this.resizeMoveConn),dojo.disconnect(this.resizeUpConn)});this.startResize(a);this.ganttChart.isResizing=!0;document.body.setCapture&&document.body.setCapture(!1)})),this.ganttChart._events.push(dojo.connect(c,"onmouseover",this,function(a){!this.ganttChart.isMoving&&!this.ganttChart.isResizing&&a.target&&(a.target.style.cursor="e-resize")})),this.ganttChart._events.push(dojo.connect(c,"onmouseout",this,function(a){!this.checkResize&&a.target&&(a.target.style.cursor=
"")})));return a},createTaskNameItem:function(){var a=dojo.create("div",{id:this.taskItem.id,className:"ganttTaskTaskNameItem",title:this.taskItem.name+", id: "+this.taskItem.id+" ",innerHTML:this.taskItem.name});dojo.style(a,"top",this.posY+"px");dojo.attr(a,"tabIndex",0);this.ganttChart.isShowConMenu&&(this.ganttChart._events.push(dojo.connect(a,"onmouseover",this,function(b){dojo.addClass(a,"ganttTaskTaskNameItemHover");clearTimeout(this.ganttChart.menuTimer);this.ganttChart.tabMenu.clear();this.ganttChart.tabMenu.show(b.target,
this)})),this.ganttChart._events.push(dojo.connect(a,"onkeydown",this,function(a){a.keyCode==dojo.keys.ENTER&&(this.ganttChart.tabMenu.clear(),this.ganttChart.tabMenu.show(a.target,this));this.ganttChart.tabMenu.isShow&&(a.keyCode==dojo.keys.LEFT_ARROW||a.keyCode==dojo.keys.RIGHT_ARROW)&&dijit.focus(this.ganttChart.tabMenu.menuPanel.firstChild.rows[0].cells[0]);this.ganttChart.tabMenu.isShow&&a.keyCode==dojo.keys.ESCAPE&&this.ganttChart.tabMenu.hide()})),this.ganttChart._events.push(dojo.connect(a,
"onmouseout",this,function(){dojo.removeClass(a,"ganttTaskTaskNameItemHover");clearTimeout(this.ganttChart.menuTimer);this.ganttChart.menuTimer=setTimeout(dojo.hitch(this,function(){this.ganttChart.tabMenu.hide()}),200)})),this.ganttChart._events.push(dojo.connect(this.ganttChart.tabMenu.menuPanel,"onmouseover",this,function(){clearTimeout(this.ganttChart.menuTimer)})),this.ganttChart._events.push(dojo.connect(this.ganttChart.tabMenu.menuPanel,"onkeydown",this,function(a){this.ganttChart.tabMenu.isShow&&
a.keyCode==dojo.keys.ESCAPE&&this.ganttChart.tabMenu.hide()})),this.ganttChart._events.push(dojo.connect(this.ganttChart.tabMenu.menuPanel,"onmouseout",this,function(){clearTimeout(this.ganttChart.menuTimer);this.ganttChart.menuTimer=setTimeout(dojo.hitch(this,function(){this.ganttChart.tabMenu.hide()}),200)})));return a},createTaskDescItem:function(){var a=this.posX+this.taskItem.duration*this.ganttChart.pixelsPerWorkHour+10,b=dojo.create("div",{innerHTML:this.objKeyToStr(this.getTaskOwner()),className:"ganttTaskDescTask"});
dojo.style(b,{left:a+"px",top:this.posY+"px"});return this.descrTask=b},checkWidthTaskNameItem:function(){if(this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft>this.ganttChart.maxWidthTaskNames){var a=this.taskItem.name.substring(0,this.cTaskNameItem[0].firstChild.length-Math.round((this.cTaskNameItem[0].offsetWidth+this.cTaskNameItem[0].offsetLeft-this.ganttChart.maxWidthTaskNames)/(this.cTaskNameItem[0].offsetWidth/this.cTaskNameItem[0].firstChild.length))-3);a+="...";this.cTaskNameItem[0].innerHTML=
a}},refreshTaskItem:function(a){this.posX=this.ganttChart.getPosOnDate(this.taskItem.startTime);dojo.style(a,{left:this.posX+"px"});var b=a.childNodes[0].firstChild;b.width=(!this.taskItem.duration?1:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour)+"px";b=b.rows[0];if(this.taskItem.percentage!=0){var c=b.firstChild;c.height=this.ganttChart.heightTaskItem+"px";c.width=this.taskItem.percentage+"%";c.style.lineHeight="1px";dojo.style(c.firstChild,{width:(!this.taskItem.duration?1:this.taskItem.percentage*
this.taskItem.duration*this.ganttChart.pixelsPerWorkHour/100)+"px",height:this.ganttChart.heightTaskItem+"px"})}if(this.taskItem.percentage!=100)c=b.lastChild,c.height=this.ganttChart.heightTaskItem+"px",c.width=100-this.taskItem.percentage+"%",c.style.lineHeight="1px",dojo.style(c.firstChild,{width:(!this.taskItem.duration?1:(100-this.taskItem.percentage)*this.taskItem.duration*this.ganttChart.pixelsPerWorkHour/100)+"px",height:this.ganttChart.heightTaskItem+"px"});if(this.ganttChart.isContentEditable)b=
a.childNodes[1].firstChild,b.height=this.ganttChart.heightTaskItem+"px",b.width=(!this.taskItem.duration?1:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour)+"px",b.rows[0].firstChild.height=this.ganttChart.heightTaskItem+"px",b=a.childNodes[2],c=b.firstChild,c.style.height=this.ganttChart.heightTaskItem+"px",c.style.width=(!this.taskItem.duration?1:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour)+"px",b=b.lastChild,dojo.style(b,{left:this.taskItem.duration*this.ganttChart.pixelsPerWorkHour-
10+"px"}),b.style.height=this.ganttChart.heightTaskItem+"px",b.style.width="10px";return a},refreshTaskDesc:function(a){dojo.style(a,{left:this.posX+this.taskItem.duration*this.ganttChart.pixelsPerWorkHour+10+"px"});return a},refreshConnectingLinesDS:function(a){var b=a[1],c=a[0],d=a[2],e=dojo.style(this.predTask.cTaskItem[0],"left"),f=dojo.style(this.predTask.cTaskItem[0],"top"),h=dojo.style(this.cTaskItem[0],"left"),g=this.posY+2;parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);
var i=parseInt(this.predTask.cTaskItem[0].firstChild.firstChild.width);f<g?dojo.style(c,{height:g-this.ganttChart.heightTaskItem/2-f-3+"px",left:e+i-20+"px"}):dojo.style(c,{height:f+2-g+"px",left:e+i-20+"px"});dojo.style(d,{width:15+(h-(i+e))+"px",left:e+i-20+"px"});dojo.style(b,{left:h-7+"px"});return a},postLoadData:function(){},refresh:function(){this.childTask&&this.childTask.length>0&&dojo.forEach(this.childTask,function(a){a.refresh()},this);this.refreshTaskItem(this.cTaskItem[0]);this.refreshTaskDesc(this.cTaskItem[0].nextSibling);
this.taskItem.previousTask&&this.predTask&&this.refreshConnectingLinesDS(this.cTaskItem[1]);return this},create:function(){var a=this.ganttChart.contentData.firstChild,b=this.taskItem.previousTask,c=this.taskItem.parentTask,d=this.taskItem.cldTasks.length>0?!0:!1;this.cTaskItem=[];this.cTaskNameItem=[];if(!c)if(this.taskItem.previousParentTask){this.previousParentTask=this.project.getTaskById(this.taskItem.previousParentTask.id);var e=this.ganttChart.getLastChildTask(this.previousParentTask);this.posY=
parseInt(e.cTaskItem[0].style.top)+this.ganttChart.heightTaskItem+this.ganttChart.heightTaskItemExtra;this.previousParentTask.nextParentTask=this}else this.posY=parseInt(this.project.projectItem[0].style.top)+this.ganttChart.heightTaskItem+this.ganttChart.heightTaskItemExtra;if(c){var f=this.project.getTaskById(this.taskItem.parentTask.id);this.parentTask=f;this.taskItem.previousChildTask?(this.previousChildTask=this.project.getTaskById(this.taskItem.previousChildTask.id),e=this.ganttChart.getLastChildTask(this.previousChildTask),
this.posY=dojo.style(e.cTaskItem[0],"top")+this.ganttChart.heightTaskItem+this.ganttChart.heightTaskItemExtra,this.previousChildTask.nextChildTask=this):this.posY=dojo.style(f.cTaskItem[0],"top")+this.ganttChart.heightTaskItem+this.ganttChart.heightTaskItemExtra;f.childTask.push(this)}if(b)this.predTask=f=this.project.getTaskById(b.id),f.childPredTask.push(this);this.cTaskItem.push(this.createTaskItem());a.appendChild(this.cTaskItem[0]);this.ganttChart.panelNames&&(this.cTaskNameItem.push(this.createTaskNameItem()),
this.ganttChart.panelNames.firstChild.appendChild(this.cTaskNameItem[0]));a.appendChild(this.createTaskDescItem());a=[];b&&(a=this.createConnectingLinesDS());this.cTaskItem.push(a);if(this.ganttChart.panelNames){b=[];if(c)this.cTaskNameItem[0].style.left=dojo.style(this.parentTask.cTaskNameItem[0],"left")+15+"px",b=this.createConnectingLinesPN();this.checkWidthTaskNameItem();this.checkPosition();c=null;d&&(c=this.createTreeImg());this.cTaskNameItem.push(b);this.cTaskNameItem.push(c)}this.adjustPanelTime();
return this},checkPosition:function(){if(this.ganttChart.withTaskId){var a=dojo.coords(this.cTaskNameItem[0],!0);this.taskIdentifier?this.childTask&&this.childTask.length>0&&dojo.forEach(this.childTask,function(a){a.checkPosition()},this):this.taskIdentifier=dojo.create("div",{id:"TaskId_"+this.taskItem.id,className:"ganttTaskIdentifier",title:this.taskItem.id,innerHTML:this.taskItem.id},this.cTaskNameItem[0].parentNode);dojo.style(this.taskIdentifier,{left:a.l+a.w+4+"px",top:a.t-1+"px"})}},createTreeImg:function(){var a=
dojo.create("div",{id:this.taskItem.id,className:"ganttImageTreeCollapse"});dojo.attr(a,"tabIndex",0);dojo.forEach(["onclick","onkeydown"],function(b){this.ganttChart._events.push(dojo.connect(a,b,this,function(c){if(!(b=="onkeydown"&&c.keyCode!=dojo.keys.ENTER))this.isExpanded?(dojo.removeClass(a,"ganttImageTreeCollapse"),dojo.addClass(a,"ganttImageTreeExpand"),this.isExpanded=!1,this.hideChildTasks(this),this.shiftCurrentTasks(this,-this.hideTasksHeight)):(dojo.removeClass(a,"ganttImageTreeExpand"),
dojo.addClass(a,"ganttImageTreeCollapse"),this.isExpanded=!0,this.shiftCurrentTasks(this,this.hideTasksHeight),this.showChildTasks(this,!0),this.hideTasksHeight=0),this.ganttChart.checkPosition()}))},this);this.ganttChart.panelNames.firstChild.appendChild(a);dojo.addClass(a,"ganttTaskTreeImage");dojo.style(a,{left:dojo.style(this.cTaskNameItem[0],"left")-12+"px",top:dojo.style(this.cTaskNameItem[0],"top")+3+"px"});return a},setPreviousTask:function(a){if(a=="")this.clearPredTask();else{var b=this.taskItem;
if(b.id==a)return!1;var c=this.project.getTaskById(a);if(!c)return!1;var d=c.taskItem,e=d.parentTask==null,f=b.parentTask==null;if(e&&!f||!e&&f||!e&&!f&&d.parentTask.id!=b.parentTask.id)return!1;e=b.startTime.getTime();if(d.startTime.getTime()+d.duration*864E5/c.ganttChart.hsPerDay>e)return!1;this.clearPredTask();this.ganttChart.checkPosPreviousTask(d,b)||this.ganttChart.correctPosPreviousTask(d,b,this);b.previousTaskId=a;b.previousTask=d;this.predTask=c;c.childPredTask.push(this);this.cTaskItem[1]=
this.createConnectingLinesDS()}return!0},clearPredTask:function(){if(this.predTask){for(var a=this.predTask.childPredTask,b=0;b<a.length;b++)if(a[b]==this){a.splice(b,1);break}for(b=0;b<this.cTaskItem[1].length;b++)this.cTaskItem[1][b].parentNode.removeChild(this.cTaskItem[1][b]);this.cTaskItem[1]=[];this.taskItem.previousTaskId=null;this.predTask=this.taskItem.previousTask=null}},setStartTime:function(a,b){this.moveChild=b;this.getMoveInfo();var c=this.ganttChart.getPosOnDate(a);if(parseInt(this.cTaskItem[0].firstChild.firstChild.width)+
c>this.maxPosXMove&&this.maxPosXMove!=-1)return this.minPosXMove=this.maxPosXMove=-1,!1;if(c<this.minPosXMove)return this.minPosXMove=this.maxPosXMove=-1,!1;this.cTaskItem[0].style.left=c;this.moveCurrentTaskItem(c-this.posX,b);this.project.shiftProjectItem();this.descrTask.innerHTML=this.objKeyToStr(this.getTaskOwner());this.adjustPanelTime();this.posX=0;this.minPosXMove=this.maxPosXMove=-1;return!0},setDuration:function(a){this.getResizeInfo();a=this.ganttChart.getWidthOnDuration(a);return a>this.maxWidthResize&&
this.maxWidthResize!=-1?!1:a<this.minWidthResize?!1:(this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width),this.resizeTaskItem(a),this.endResizeItem(),this.descrTask.innerHTML=this.objKeyToStr(this.getTaskOwner()),!0)},setTaskOwner:function(a){this.taskItem.taskOwner=a==null||a==void 0?"":a;this.descrTask.innerHTML=this.objKeyToStr(this.getTaskOwner());return!0},setPercentCompleted:function(a){a=parseInt(a);if(isNaN(a)||a>100||a<0)return!1;var b=this.cTaskItem[0].childNodes[0].firstChild.rows[0],
c=b.cells[0],d=b.cells[1];if(a!=0&&a!=100)if(this.taskItem.percentage!=0&&this.taskItem.percentage!=100)c.width=a+"%",d.width=100-a+"%";else{if(this.taskItem.percentage==0||this.taskItem.percentage==100)c.parentNode.removeChild(c),c=dojo.create("td",{height:this.ganttChart.heightTaskItem+"px",width:a+"%"},b),c.style.lineHeight="1px",c=dojo.create("div",{className:"ganttImageTaskProgressFilled"},c),dojo.style(c,{width:a*this.taskItem.duration*this.ganttChart.pixelsPerWorkHour/100+"px",height:this.ganttChart.heightTaskItem+
"px"}),c=dojo.create("td",{height:this.ganttChart.heightTaskItem+"px",width:100-a+"%"},b),c.style.lineHeight="1px",c=dojo.create("div",{className:"ganttImageTaskProgressBg"},c),dojo.style(c,{width:(100-a)*this.taskItem.duration*this.ganttChart.pixelsPerWorkHour/100+"px",height:this.ganttChart.heightTaskItem+"px"})}else if(a==0)this.taskItem.percentage!=0&&this.taskItem.percentage!=100?(c.parentNode.removeChild(c),d.width="100%"):(dojo.removeClass(c.firstChild,"ganttImageTaskProgressFilled"),dojo.addClass(c.firstChild,
"ganttImageTaskProgressBg"));else if(a==100)this.taskItem.percentage!=0&&this.taskItem.percentage!=100?(d.parentNode.removeChild(d),c.width="100%"):(dojo.removeClass(c.firstChild,"ganttImageTaskProgressBg"),dojo.addClass(c.firstChild,"ganttImageTaskProgressFilled"));this.taskItem.percentage=a;this.taskItemWidth=parseInt(this.cTaskItem[0].firstChild.firstChild.width);this.resizeTaskItem(this.taskItemWidth);this.endResizeItem();this.descrTask.innerHTML=this.objKeyToStr(this.getTaskOwner());return!0},
setName:function(a){if(a)this.taskItem.name=a,this.cTaskNameItem[0].innerHTML=a,this.cTaskNameItem[0].title=a,this.checkWidthTaskNameItem(),this.checkPosition(),this.descrTask.innerHTML=this.objKeyToStr(this.getTaskOwner()),this.adjustPanelTime()}}),dojo.declare("dojox.gantt.GanttTaskItem",null,{constructor:function(a){this.id=a.id;this.name=a.name||this.id;this.startTime=a.startTime||new Date;this.duration=a.duration||8;this.percentage=a.percentage||0;this.previousTaskId=a.previousTaskId||"";this.taskOwner=
a.taskOwner||"";this.cldTasks=[];this.cldPreTasks=[];this.previousParentTask=this.nextParentTask=this.previousChildTask=this.nextChildTask=this.project=this.previousTask=this.parentTask=null},addChildTask:function(a){this.cldTasks.push(a);a.parentTask=this},setProject:function(a){this.project=a;for(var b=0;b<this.cldTasks.length;b++)this.cldTasks[b].setProject(a)}}));