/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.rails"])dojo._hasResource["dojox.rails"]=!0,dojo.provide("dojox.rails"),dojo.require("dojo.NodeList-traverse"),dojox.rails.live=function(a,f,g){dojo.isIE&&f.match(/^(on)?submit$/i)?dojox.rails.live(a,"click",function(a){var a=a.target,c=a.tagName.toLowerCase();if((c=="input"||c=="button")&&dojo.attr(a,"type").toLowerCase()=="submit")if(a=dojo.query(a).closest("form"),a.length)var f=dojo.connect(a[0],"submit",function(a){dojo.disconnect(f);g.call(a.target,a)})}):dojo.connect(dojo.body(),
f,function(e){var c=dojo.query(e.target).closest(a);c.length&&g.call(c[0],e)})},dojo.ready(function(a,f,g){return function(){var e=a.query,c=f.live,k=e("meta[name=csrf-token]").attr("content"),j=e("meta[name=csrf-param]").attr("content"),i=function(a,b){return dojo.place('<form style="display:none" method="post" action="'+a+'"><input type="hidden" name="_method" value="'+b+'" /><input type="hidden" name="'+j+'" value="'+k+'" /></form>',dojo.body())},l=function(d){a.forEach(d,function(b){if(!a.attr(b,
"disabled")){var d=b.tagName.toLowerCase()=="input"?"value":"innerHTML",c=a.attr(b,"data-disable-with"),e=a.attr(b,d);a.attr(b,"disabled",!0);a.attr(b,"data-original-value",e);a.attr(b,d,c)}})},m={text:"text",json:"application/json","json-comment-optional":"text","json-comment-filtered":"text",javascript:"application/javascript",xml:"text/xml"},h=function(d){var b=d.target,c=b.tagName.toLowerCase(),e=c.toLowerCase()=="form"?a.formToObject(b):{},f=a.attr(b,"data-type")||"javascript",g=(a.attr(b,"method")||
a.attr(b,"data-method")||"get").toLowerCase(),h=a.attr(b,"action")||a.attr(b,"href");c!="form"&&g!="get"&&(b=i(h,g),g="POST");d.preventDefault();a.publish("ajax:before",[b]);a.xhr(g,{url:h,headers:{Accept:m[f]},content:e,handleAs:f,load:function(d,c){a.publish("ajax:success",[b,d,c])},error:function(d,c){a.publish("ajax:failure",[b,d,c])},handle:function(d,c){a.publish("ajax:complete",[b,d,c])}});a.publish("ajax:after",[b])};c("*[data-confirm]","click",function(d){g.confirm(a.attr(d.target,"data-confirm"))?
a.attr(d.target,"data-remote")&&h(d):d.preventDefault()});a.subscribe("ajax:complete",function(d){e("*[data-disable-with][disabled]",d).forEach(function(b){var d=b.tagName.toLowerCase()=="input"?"value":"innerHTML",c=a.attr(b,"data-original-value");a.attr(b,"disabled",!1);a.attr(b,"data-original-value",null);a.attr(b,d,c)})});c("a[data-remote]:not([data-confirm])","click",h);c("a[data-method]:not([data-remote])","click",function(a){var b=a.target,b=i(b.href,dojo.attr(b,"data-method"));a.preventDefault();
b.submit()});c("form","submit",function(d){var b=d.target,c=e("*[data-disable-with]",b);c.length&&l(c);a.attr(b,"data-remote")&&(d.preventDefault(),h(d))})}}(dojo,dojox.rails,dojo.global));