/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.data.SnapLogicStore"]||(dojo._hasResource["dojox.data.SnapLogicStore"]=!0,dojo.provide("dojox.data.SnapLogicStore"),dojo.require("dojo.io.script"),dojo.require("dojo.data.util.sorter"),dojo.declare("dojox.data.SnapLogicStore",null,{Parts:{DATA:"data",COUNT:"count"},url:"",constructor:function(a){if(a.url)this.url=a.url;this._parameters=a.parameters},_assertIsItem:function(a){if(!this.isItem(a))throw Error("dojox.data.SnapLogicStore: a function was passed an item argument that was not an item");
},_assertIsAttribute:function(a){if(typeof a!=="string")throw Error("dojox.data.SnapLogicStore: a function was passed an attribute argument that was not an attribute name string");},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(a,b,c){this._assertIsItem(a);this._assertIsAttribute(b);b=dojo.indexOf(a.attributes,b);return b!==-1?a.values[b]:c},getAttributes:function(a){this._assertIsItem(a);return a.attributes},hasAttribute:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);
for(var c=0;c<a.attributes.length;++c)if(b==a.attributes[c])return!0;return!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(){},getLabel:function(){},getLabelAttributes:function(){return null},containsValue:function(a,b,c){return this.getValue(a,b)===c},getValues:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);var c=dojo.indexOf(a.attributes,b);return c!==-1?[a.values[c]]:[]},isItem:function(a){return a&&a._store===this?!0:!1},close:function(){},_fetchHandler:function(a){var b=
a.scope||dojo.global;a.onBegin&&a.onBegin.call(b,a._countResponse[0],a);if(a.onItem||a.onComplete){var c=a._dataResponse;if(c.length){if(a.query!="record count"){for(var f=c.shift(),d=[],e=0;e<c.length;++e){if(a._aborted)break;d.push({attributes:f,values:c[e],_store:this})}a.sort&&!a._aborted&&d.sort(dojo.data.util.sorter.createSortFunction(a.sort,self))}else d=[{attributes:["count"],values:c,_store:this}];if(a.onItem){for(e=0;e<d.length;++e){if(a._aborted)break;a.onItem.call(b,d[e],a)}d=null}a.onComplete&&
!a._aborted&&a.onComplete.call(b,d,a)}else a.onError.call(b,Error("dojox.data.SnapLogicStore: invalid response of length 0"),a)}},_partHandler:function(a,b,c){if(c instanceof Error)b==this.Parts.DATA?a._dataHandle=null:a._countHandle=null,a._aborted=!0,a.onError&&a.onError.call(a.scope,c,a);else if(!a._aborted)b==this.Parts.DATA?a._dataResponse=c:a._countResponse=c,(!a._dataHandle||a._dataResponse!==null)&&(!a._countHandle||a._countResponse!==null)&&this._fetchHandler(a)},fetch:function(a){a._countResponse=
null;a._dataResponse=null;a._aborted=!1;a.abort=function(){if(!a._aborted)a._aborted=!0,a._dataHandle&&a._dataHandle.cancel&&a._dataHandle.cancel(),a._countHandle&&a._countHandle.cancel&&a._countHandle.cancel()};if(a.onItem||a.onComplete){var b=this._parameters||{};if(a.start){if(a.start<0)throw Error("dojox.data.SnapLogicStore: request start value must be 0 or greater");b["sn.start"]=a.start+1}if(a.count){if(a.count<0)throw Error("dojox.data.SnapLogicStore: request count value 0 or greater");b["sn.limit"]=
a.count}b["sn.content_type"]="application/javascript";b={url:this.url,content:b,timeout:6E4,callbackParamName:"sn.stream_header",handle:dojo.hitch(this,"_partHandler",a,this.Parts.DATA)};a._dataHandle=dojo.io.script.get(b)}if(a.onBegin)b={"sn.count":"records","sn.content_type":"application/javascript"},b={url:this.url,content:b,timeout:6E4,callbackParamName:"sn.stream_header",handle:dojo.hitch(this,"_partHandler",a,this.Parts.COUNT)},a._countHandle=dojo.io.script.get(b);return a}}));