/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.av._Media"]||(dojo._hasResource["dojox.av._Media"]=!0,dojo.provide("dojox.av._Media"),dojo.declare("dojox.av._Media",null,{mediaUrl:"",initialVolume:1,autoPlay:!1,bufferTime:2E3,minBufferTime:300,updateTime:100,id:"",isDebug:!1,percentDownloaded:0,_flashObject:null,flashMedia:null,allowScriptAccess:"always",allowNetworking:"all",wmode:"transparent",allowFullScreen:!0,_initStatus:function(){this.status="ready";this._positionHandle=dojo.connect(this,"onPosition",this,"_figureStatus")},
getTime:function(){return this.flashMedia.getTime()},onLoad:function(){},onDownloaded:function(){},onClick:function(){},onSwfSized:function(){},onMetaData:function(a){this.duration=a.duration},onPosition:function(){},onStart:function(){},onPlay:function(){},onPause:function(){},onEnd:function(){},onStop:function(){},onBuffer:function(a){this.isBuffering=a},onError:function(a,b){console.warn("ERROR-"+a.type.toUpperCase()+":",a.info.code," - URL:",b)},onStatus:function(){},onPlayerStatus:function(){},
onResize:function(){},_figureStatus:function(){var a=this.getTime();if(this.status=="stopping")this.status="stopped",this.onStop(this._eventFactory());else if(this.status=="ending"&&a==this._prevPos)this.status="ended",this.onEnd(this._eventFactory());else if(this.duration&&a>this.duration-0.5)this.status="ending";else if(a===0){if(this.status!="ready"&&(this.status="stopped",this._prevStatus!="stopped"))this.onStop(this._eventFactory())}else if(this.status=="ready")this.status="started",this.onStart(this._eventFactory()),
this.onPlay(this._eventFactory());else if(this.isBuffering)this.status="buffering";else if(this.status=="started"||this.status=="playing"&&a!=this._prevPos)this.status="playing";else if(!this.isStopped&&this.status=="playing"&&a==this._prevPos){if(this.status="paused",console.warn("pause",a,this._prevPos),this.status!=this._prevStatus)this.onPause(this._eventFactory())}else if((this.status=="paused"||this.status=="stopped")&&a!=this._prevPos)this.status="started",this.onPlay(this._eventFactory());
this._prevPos=a;this._prevStatus=this.status;this.onStatus(this.status)},_eventFactory:function(){return{status:this.status}},_sub:function(a,b){dojo.subscribe(this.id+"/"+a,this,b)},_normalizeVolume:function(a){if(a>1)for(;a>1;)a*=0.1;return a},_normalizeUrl:function(a){console.log("  url:",a);if(a&&(a.toLowerCase().indexOf("http")<0||a.indexOf("/")==0)){var b=window.location.href.split("/");b.pop();b=b.join("/")+"/";console.log("  loc:",b);a=b+a}return a},destroy:function(){this.flashMedia?(dojo.forEach(this._subs,
function(a){dojo.unsubscribe(a)}),dojo.forEach(this._cons,function(a){dojo.disconnect(a)}),this._flashObject.destroy()):this._cons.push(dojo.connect(this,"onLoad",this,"destroy"))}}));