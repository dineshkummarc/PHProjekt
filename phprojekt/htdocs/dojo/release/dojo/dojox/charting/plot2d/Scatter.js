/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.charting.plot2d.Scatter"]||(dojo._hasResource["dojox.charting.plot2d.Scatter"]=!0,dojo.provide("dojox.charting.plot2d.Scatter"),dojo.require("dojox.charting.plot2d.common"),dojo.require("dojox.charting.plot2d.Base"),dojo.require("dojox.lang.utils"),dojo.require("dojox.lang.functional"),dojo.require("dojox.lang.functional.reversed"),dojo.require("dojox.gfx.gradutils"),function(){var p=dojox.lang.functional,l=dojox.lang.utils,q=dojox.charting.plot2d.common,v=p.lambda("item.purgeGroup()");
dojo.declare("dojox.charting.plot2d.Scatter",dojox.charting.plot2d.Base,{defaultParams:{hAxis:"x",vAxis:"y",shadows:null,animate:null},optionalParams:{markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerFont:"",markerFontColor:""},constructor:function(e,d){this.opt=dojo.clone(this.defaultParams);l.updateWithObject(this.opt,d);l.updateWithPattern(this.opt,d,this.optionalParams);this.series=[];this.hAxis=this.opt.hAxis;this.vAxis=this.opt.vAxis;this.animate=this.opt.animate},render:function(e,
d){if(this.zoom&&!this.isDataDirty())return this.performZoom(e,d);this.resetEvents();if(this.dirty=this.isDirty()){dojo.forEach(this.series,v);this._eventSeries={};this.cleanGroup();var j=this.group;p.forEachRev(this.series,function(a){a.cleanGroup(j)})}for(var k=this.chart.theme,l=this.events(),o=this.series.length-1;o>=0;--o){var a=this.series[o];if(!this.dirty&&!a.dirty)k.skip(),this._reconnectEvents(a.name);else if(a.cleanGroup(),a.data.length){var r=k.next("marker",[this.opt,a]),j=a.group,f,
s=this._hScaler.scaler.getTransformerFromModel(this._hScaler),t=this._vScaler.scaler.getTransformerFromModel(this._vScaler);f=typeof a.data[0]=="number"?dojo.map(a.data,function(a,c){return{x:s(c+1)+d.l,y:e.height-d.b-t(a)}},this):dojo.map(a.data,function(a){return{x:s(a.x)+d.l,y:e.height-d.b-t(a.y)}},this);var m=Array(f.length),g=Array(f.length),n=Array(f.length);dojo.forEach(f,function(i,c){var b=typeof a.data[c]=="number"?k.post(r,"marker"):k.addMixin(r,"marker",a.data[c],!0),f="M"+i.x+" "+i.y+
" "+b.symbol;b.marker.shadow&&(m[c]=j.createPath("M"+(i.x+b.marker.shadow.dx)+" "+(i.y+b.marker.shadow.dy)+" "+b.symbol).setStroke(b.marker.shadow).setFill(b.marker.shadow.color),this.animate&&this._animateScatter(m[c],e.height-d.b));if(b.marker.outline){var h=q.makeStroke(b.marker.outline);h.width=2*h.width+b.marker.stroke.width;n[c]=j.createPath(f).setStroke(h);this.animate&&this._animateScatter(n[c],e.height-d.b)}h=q.makeStroke(b.marker.stroke);if((b=this._plotFill(b.marker.fill,e,d))&&(b.type===
"linear"||b.type=="radial"))if(b=dojox.gfx.gradutils.getColor(b,{x:i.x,y:i.y}),h)h.color=b;g[c]=j.createPath(f).setStroke(h).setFill(b);this.animate&&this._animateScatter(g[c],e.height-d.b)},this);if(g.length)a.dyn.stroke=g[g.length-1].getStroke(),a.dyn.fill=g[g.length-1].getFill();if(l){var u=Array(g.length);dojo.forEach(g,function(d,c){var b={element:"marker",index:c,run:a,shape:d,outline:n&&n[c]||null,shadow:m&&m[c]||null,cx:f[c].x,cy:f[c].y};typeof a.data[0]=="number"?(b.x=c+1,b.y=a.data[c]):
(b.x=a.data[c].x,b.y=a.data[c].y);this._connectEvents(b);u[c]=b},this);this._eventSeries[a.name]=u}else delete this._eventSeries[a.name];a.dirty=!1}else a.dirty=!1,k.skip()}this.dirty=!1;return this},_animateScatter:function(e,d){dojox.gfx.fx.animateTransform(dojo.delegate({shape:e,duration:1200,transform:[{name:"translate",start:[0,d],end:[0,0]},{name:"scale",start:[0,0],end:[1,1]},{name:"original"}]},this.animate)).play()}})}());