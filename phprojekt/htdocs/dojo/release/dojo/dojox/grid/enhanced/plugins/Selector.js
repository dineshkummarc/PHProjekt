/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.grid.enhanced.plugins.Selector"]||(dojo._hasResource["dojox.grid.enhanced.plugins.Selector"]=!0,dojo.provide("dojox.grid.enhanced.plugins.Selector"),dojo.require("dojox.grid.enhanced._Plugin"),dojo.require("dojox.grid.enhanced.plugins.AutoScroll"),dojo.require("dojox.grid.cells._base"),function(){var k={col:"row",row:"col"},i=function(a,b,c,d,e){return a!=="cell"?(b=b[a],c=c[a],d=d[a],typeof b!=="number"||typeof c!=="number"||typeof d!=="number"?!1:e?b>=c&&b<d||b>d&&b<=c:
b>=c&&b<=d||b>=d&&b<=c):i("col",b,c,d,e)&&i("row",b,c,d,e)},n=function(a,b,c){try{if(b&&c)switch(a){case "col":case "row":return b[a]==c[a]&&typeof b[a]=="number"&&!(k[a]in b)&&!(k[a]in c);case "cell":return b.col==c.col&&b.row==c.row&&typeof b.col=="number"&&typeof b.row=="number"}}catch(d){}return!1},m=function(a){try{a&&a.preventDefault&&dojo.stopEvent(a)}catch(b){}},h=function(a,b,c){switch(a){case "col":return{col:typeof c=="undefined"?b:c,except:[]};case "row":return{row:b,except:[]};case "cell":return{row:b,
col:c}}return null};dojo.declare("dojox.grid.enhanced.plugins.Selector",dojox.grid.enhanced._Plugin,{name:"selector",constructor:function(a,b){this.grid=a;this._config={row:2,col:2,cell:2};this.setupConfig(b);if(a.selectionMode==="single")this._config.row=1;this._enabled=!0;this._selecting={};this._selected={col:[],row:[],cell:[]};this._startPoint={};this._currentPoint={};this._lastAnchorPoint={};this._lastEndPoint={};this._lastSelectedAnchorPoint={};this._lastSelectedEndPoint={};this._keyboardSelect=
{};this._lastType=null;this._selectedRowModified={};this._hacks();this._initEvents();this._initAreas();this._mixinGrid()},destroy:function(){this.inherited(arguments)},setupConfig:function(a){if(a&&dojo.isObject(a)){var b=["row","col","cell"],c;for(c in a)dojo.indexOf(b,c)>=0&&(this._config[c]=!a[c]||a[c]=="disabled"?0:a[c]=="single"?1:2);this.grid.selection.setMode(["none","single","extended"][this._config.row])}},isSelected:function(a,b,c){return this._isSelected(a,h(a,b,c))},toggleSelect:function(a,
b,c){this._startSelect(a,h(a,b,c),this._config[a]===2,!1,!1,!this.isSelected(a,b,c));this._endSelect(a)},select:function(a,b,c){this.isSelected(a,b,c)||this.toggleSelect(a,b,c)},deselect:function(a,b,c){this.isSelected(a,b,c)&&this.toggleSelect(a,b,c)},selectRange:function(a,b,c,d){this.grid._selectingRange=!0;b=a=="cell"?h(a,b.row,b.col):h(a,b);c=a=="cell"?h(a,c.row,c.col):h(a,c);this._startSelect(a,b,!1,!1,!1,d);this._highlight(a,c,d===void 0?!0:d);this._endSelect(a);this.grid._selectingRange=!1},
clear:function(a){this._clearSelection(a||"all")},isSelecting:function(a){return typeof a=="undefined"?this._selecting.col||this._selecting.row||this._selecting.cell:this._selecting[a]},selectEnabled:function(a){if(typeof a!="undefined"&&!this.isSelecting())this._enabled=!!a;return this._enabled},getSelected:function(a,b){switch(a){case "cell":return dojo.map(this._selected[a],function(a){return a});case "col":case "row":return dojo.map(b?this._selected[a]:dojo.filter(this._selected[a],function(a){return a.except.length===
0}),function(c){return b?c:c[a]})}return[]},getSelectedCount:function(a,b){switch(a){case "cell":return this._selected[a].length;case "col":case "row":return(b?this._selected[a]:dojo.filter(this._selected[a],function(a){return a.except.length===0})).length}return 0},getSelectedType:function(){var a=this._selected;return["","cell","row","row|cell","col","col|cell","col|row","col|row|cell"][!!a.cell.length|!!a.row.length<<1|!!a.col.length<<2]},getLastSelectedRange:function(a){return this._lastAnchorPoint[a]?
{start:this._lastAnchorPoint[a],end:this._lastEndPoint[a]}:null},_hacks:function(){var a=this.grid,b=function(b){if(b.cellNode)a.onMouseUp(b);a.onMouseUpRow(b)},c=dojo.hitch(a,"onMouseUp"),d=dojo.hitch(a,"onMouseDown"),e=function(a){a.cellNode.style.border="solid 1px"};dojo.forEach(a.views.views,function(a){a.content.domouseup=b;a.header.domouseup=c;if(a.declaredClass=="dojox.grid._RowSelector")a.domousedown=d,a.domouseup=c,a.dofocus=e});a.selection.clickSelect=function(){};this._oldDeselectAll=a.selection.deselectAll;
var f=this;a.selection.selectRange=function(b,c){f.selectRange("row",b,c,!0);a.selection.preserver&&a.selection.preserver._updateMapping(!0,!0,!1,b,c);a.selection.onChanged()};a.selection.deselectRange=function(b,c){f.selectRange("row",b,c,!1);a.selection.preserver&&a.selection.preserver._updateMapping(!0,!1,!1,b,c);a.selection.onChanged()};a.selection.deselectAll=function(){a._selectingRange=!0;f._oldDeselectAll.apply(a.selection,arguments);f._clearSelection("row");a._selectingRange=!1;a.selection.preserver&&
a.selection.preserver._updateMapping(!0,!1,!0);a.selection.onChanged()};var g=a.views.views[0];if(g instanceof dojox.grid._RowSelector)g.doStyleRowNode=function(b,c){dojo.removeClass(c,"dojoxGridRow");dojo.addClass(c,"dojoxGridRowbar");dojo.addClass(c,"dojoxGridNonNormalizedCell");dojo.toggleClass(c,"dojoxGridRowbarOver",a.rows.isOver(b));dojo.toggleClass(c,"dojoxGridRowbarSelected",!!a.selection.isSelected(b))};this.connect(a,"updateRow",function(b){dojo.forEach(a.layout.cells,function(a){this.isSelected("cell",
b,a.index)&&this._highlightNode(a.getNode(b),!0)},this)})},_mixinGrid:function(){var a=this.grid;a.setupSelectorConfig=dojo.hitch(this,this.setupConfig);a.onStartSelect=function(){};a.onEndSelect=function(){};a.onStartDeselect=function(){};a.onEndDeselect=function(){};a.onSelectCleared=function(){}},_initEvents:function(){var a=this.grid,b=this,c=dojo.partial,d=function(a,c){if(a==="row")b._isUsingRowSelector=!0;if(b.selectEnabled()&&b._config[a]&&c.button!=2){if(b._keyboardSelect.col||b._keyboardSelect.row||
b._keyboardSelect.cell)b._endSelect("all"),b._keyboardSelect.col=b._keyboardSelect.row=b._keyboardSelect.cell=0;if(b._usingKeyboard)b._usingKeyboard=!1;var d=h(a,c.rowIndex,c.cell&&c.cell.index);b._startSelect(a,d,c.ctrlKey,c.shiftKey)}},e=dojo.hitch(this,"_endSelect");this.connect(a,"onHeaderCellMouseDown",c(d,"col"));this.connect(a,"onHeaderCellMouseUp",c(e,"col"));this.connect(a,"onRowSelectorMouseDown",c(d,"row"));this.connect(a,"onRowSelectorMouseUp",c(e,"row"));this.connect(a,"onCellMouseDown",
function(c){if(!c.cell||!c.cell.isRowSelector){if(a.singleClickEdit)b._singleClickEdit=!0,a.singleClickEdit=!1;d(b._config.cell==0?"row":"cell",c)}});this.connect(a,"onCellMouseUp",function(c){if(b._singleClickEdit)delete b._singleClickEdit,a.singleClickEdit=!0;e("all",c)});this.connect(a,"onCellMouseOver",function(a){b._curType!="row"&&b._selecting[b._curType]&&b._config[b._curType]==2&&(b._highlight("col",h("col",a.cell.index),b._toSelect),b._keyboardSelect.cell||b._highlight("cell",h("cell",a.rowIndex,
a.cell.index),b._toSelect))});this.connect(a,"onHeaderCellMouseOver",function(a){b._selecting.col&&b._config.col==2&&b._highlight("col",h("col",a.cell.index),b._toSelect)});this.connect(a,"onRowMouseOver",function(a){b._selecting.row&&b._config.row==2&&b._highlight("row",h("row",a.rowIndex),b._toSelect)});this.connect(a,"onSelectedById","_onSelectedById");this.connect(a,"_onFetchComplete",function(){a._notRefreshSelection||this._refreshSelected(!0)});this.connect(a.scroller,"buildPage",function(){a._notRefreshSelection||
this._refreshSelected(!0)});this.connect(dojo.doc,"onmouseup",c(e,"all"));this.connect(a,"onEndAutoScroll",function(a,c,d,e){d=b._selecting.cell;c=c?1:-1;if(a&&(d||b._selecting.row))a=d?"cell":"row",d=b._currentPoint[a],b._highlight(a,h(a,d.row+c,d.col),b._toSelect);else if(!a&&(d||b._selecting.col))a=d?"cell":"col",d=b._currentPoint[a],b._highlight(a,h(a,d.row,e),b._toSelect)});this.subscribe("dojox/grid/rearrange/move/"+a.id,"_onInternalRearrange");this.subscribe("dojox/grid/rearrange/copy/"+a.id,
"_onInternalRearrange");this.subscribe("dojox/grid/rearrange/change/"+a.id,"_onExternalChange");this.subscribe("dojox/grid/rearrange/insert/"+a.id,"_onExternalChange");this.subscribe("dojox/grid/rearrange/remove/"+a.id,"clear");this.connect(a,"onSelected",function(a){this._selectedRowModified&&this._isUsingRowSelector?delete this._selectedRowModified:this.grid._selectingRange||this.select("row",a)});this.connect(a,"onDeselected",function(a){this._selectedRowModified&&this._isUsingRowSelector?delete this._selectedRowModified:
this.grid._selectingRange||this.deselect("row",a)})},_onSelectedById:function(a,b,c){if(!this.grid._noInternalMapping){var d=[this._lastAnchorPoint.row,this._lastEndPoint.row,this._lastSelectedAnchorPoint.row,this._lastSelectedEndPoint.row],d=d.concat(this._selected.row),e=!1;dojo.forEach(d,function(c){if(c)if(c.id===a)e=!0,c.row=b;else if(c.row===b&&c.id)c.row=-1});!e&&c&&dojo.some(this._selected.row,function(c){return c&&!c.id&&!c.except.length?(c.id=a,c.row=b,!0):!1});e=!1;d=[this._lastAnchorPoint.cell,
this._lastEndPoint.cell,this._lastSelectedAnchorPoint.cell,this._lastSelectedEndPoint.cell];d=d.concat(this._selected.cell);dojo.forEach(d,function(c){if(c)if(c.id===a)e=!0,c.row=b;else if(c.row===b&&c.id)c.row=-1})}},onSetStore:function(){this._clearSelection("all")},_onInternalRearrange:function(a,b){try{this._refresh("col",!1);dojo.forEach(this._selected.row,function(a){dojo.forEach(this.grid.layout.cells,function(b){this._highlightNode(b.getNode(a.row),!1)},this)},this);dojo.query(".dojoxGridRowSelectorSelected").forEach(function(a){dojo.removeClass(a,
"dojoxGridRowSelectorSelected");dojo.removeClass(a,"dojoxGridRowSelectorSelectedUp");dojo.removeClass(a,"dojoxGridRowSelectorSelectedDown")});var c=[this._lastAnchorPoint[a],this._lastEndPoint[a],this._lastSelectedAnchorPoint[a],this._lastSelectedEndPoint[a]];if(a==="cell"){this.selectRange("cell",b.to.min,b.to.max);var d=this.grid.layout.cells;dojo.forEach(c,function(a){if(!a.converted)for(var c=b.from.min.row,e=b.to.min.row;c<=b.from.max.row;++c,++e)for(var j=b.from.min.col,l=b.to.min.col;j<=b.from.max.col;++j,
++l){for(;d[j].hidden;)++j;for(;d[l].hidden;)++l;if(a.row==c&&a.col==j){a.row=e;a.col=l;a.converted=!0;return}}})}else c=this._selected.cell.concat(this._selected[a]).concat(c).concat([this._lastAnchorPoint.cell,this._lastEndPoint.cell,this._lastSelectedAnchorPoint.cell,this._lastSelectedEndPoint.cell]),dojo.forEach(c,function(c){if(c&&!c.converted){var d=c[a];d in b&&(c[a]=b[d]);c.converted=!0}}),dojo.forEach(this._selected[k[a]],function(a){for(var c=0,d=a.except.length;c<d;++c){var e=a.except[c];
e in b&&(a.except[c]=b[e])}});dojo.forEach(c,function(a){a&&delete a.converted});this._refreshSelected(!0);this._focusPoint(a,this._lastEndPoint)}catch(e){console.warn("Selector._onInternalRearrange() error",e)}},_onExternalChange:function(a,b){this.selectRange(a,a=="cell"?b.min:b[0],a=="cell"?b.max:b[b.length-1])},_refresh:function(a,b){this._keyboardSelect[a]||dojo.forEach(this._selected[a],function(c){this._highlightSingle(a,b,c,void 0,!0)},this)},_refreshSelected:function(){this._refresh("col",
!0);this._refresh("row",!0);this._refresh("cell",!0)},_initAreas:function(){var a=this.grid,b=a.focus,c=this,d=dojo.keys,e=function(d,e,l,f,g){var h=c._keyboardSelect;if(g.shiftKey&&h[d]){if(h[d]===1){if(d==="cell"){var i=c._lastEndPoint[d];if(b.cell!=a.layout.cells[i.col+f]||b.rowIndex!=i.row+l){h[d]=0;return}}c._startSelect(d,c._lastAnchorPoint[d],!0,!1,!0);c._highlight(d,c._lastEndPoint[d],c._toSelect);h[d]=2}e=e(d,l,f,g);c._isValid(d,e,a)&&c._highlight(d,e,c._toSelect);m(g)}},f=function(b,e,f,
g){if(g&&c.selectEnabled()&&c._config[b]!=0)switch(f.keyCode){case d.SPACE:c._startSelect(b,e(),f.ctrlKey,f.shiftKey);c._endSelect(b);break;case d.SHIFT:if(c._config[b]==2&&c._isValid(b,c._lastAnchorPoint[b],a))c._endSelect(b),c._keyboardSelect[b]=1,c._usingKeyboard=!0}},g=function(a,b,d){d&&b.keyCode==dojo.keys.SHIFT&&c._keyboardSelect[a]&&(c._endSelect(a),c._keyboardSelect[a]=0)};if(a.views.views[0]instanceof dojox.grid._RowSelector)this._lastFocusedRowBarIdx=0,b.addArea({name:"rowHeader",onFocus:function(d){var e=
a.views.views[0];if(e instanceof dojox.grid._RowSelector){var f=e.getCellNode(c._lastFocusedRowBarIdx,0);f&&dojo.toggleClass(f,b.focusClass,!1);if(d&&"rowIndex"in d)if(d.rowIndex>=0)c._lastFocusedRowBarIdx=d.rowIndex;else if(!c._lastFocusedRowBarIdx)c._lastFocusedRowBarIdx=0;if(f=e.getCellNode(c._lastFocusedRowBarIdx,0))dijit.focus(f),dojo.toggleClass(f,b.focusClass,!0);b.rowIndex=c._lastFocusedRowBarIdx;m(d);return!0}return!1},onBlur:function(d){var e=a.views.views[0];e instanceof dojox.grid._RowSelector&&
((e=e.getCellNode(c._lastFocusedRowBarIdx,0))&&dojo.toggleClass(e,b.focusClass,!1),m(d));return!0},onMove:function(d,e,f){e=a.views.views[0];if(d&&e instanceof dojox.grid._RowSelector&&(d=c._lastFocusedRowBarIdx+d,d>=0&&d<a.rowCount)){m(f);f=e.getCellNode(c._lastFocusedRowBarIdx,0);dojo.toggleClass(f,b.focusClass,!1);var f=a.scroller,g=f.getLastPageRow(f.page),h=Math.min(a.rowCount-1,d);d>g&&a.setScrollTop(a.scrollTop+f.findScrollTop(h)-f.findScrollTop(c._lastFocusedRowBarIdx));f=e.getCellNode(d,
0);dijit.focus(f);dojo.toggleClass(f,b.focusClass,!0);c._lastFocusedRowBarIdx=d;b.cell=f;b.cell.view=e;b.cell.getNode=function(){return b.cell};b.rowIndex=c._lastFocusedRowBarIdx;b.scrollIntoView();b.cell=null}}}),b.placeArea("rowHeader","before","content");b.addArea({name:"cellselect",onMove:dojo.partial(e,"cell",function(a,b,d){a=c._currentPoint[a];return h("cell",a.row+b,a.col+d)}),onKeyDown:dojo.partial(f,"cell",function(){return h("cell",b.rowIndex,b.cell.index)}),onKeyUp:dojo.partial(g,"cell")});
b.placeArea("cellselect","below","content");b.addArea({name:"colselect",onMove:dojo.partial(e,"col",function(a,b,d){return h("col",c._currentPoint[a].col+d)}),onKeyDown:dojo.partial(f,"col",function(){return h("col",b.getHeaderIndex())}),onKeyUp:dojo.partial(g,"col")});b.placeArea("colselect","below","header");b.addArea({name:"rowselect",onMove:dojo.partial(e,"row",function(){return h("row",b.rowIndex)}),onKeyDown:dojo.partial(f,"row",function(){return h("row",b.rowIndex)}),onKeyUp:dojo.partial(g,
"row")});b.placeArea("rowselect","below","rowHeader")},_clearSelection:function(a,b){if(a=="all")this._clearSelection("cell",b),this._clearSelection("col",b),this._clearSelection("row",b);else{this._isUsingRowSelector=!0;dojo.forEach(this._selected[a],function(c){n(a,b,c)||this._highlightSingle(a,!1,c)},this);this._blurPoint(a,this._currentPoint);this._selecting[a]=!1;this._startPoint[a]=this._currentPoint[a]=null;this._selected[a]=[];if(a=="row"&&!this.grid._selectingRange)this._oldDeselectAll.call(this.grid.selection),
this.grid.selection._selectedById={};this.grid.onEndDeselect(a,null,null,this._selected);this.grid.onSelectCleared(a)}},_startSelect:function(a,b,c,d,e,f){if(this._isValid(a,b)){var g=this._isSelected(a,this._lastEndPoint[a]),h=this._isSelected(a,b);this._toSelect=e?h:!h;if(!c||!h&&this._config[a]==1)this._clearSelection("all",b),this._toSelect=f===void 0?!0:f;this._selecting[a]=!0;this._currentPoint[a]=null;if(d&&this._lastType==a&&g==this._toSelect){if(a==="row")this._isUsingRowSelector=!0;this._startPoint[a]=
this._lastEndPoint[a];this._highlight(a,this._startPoint[a]);this._isUsingRowSelector=!1}else this._startPoint[a]=b;this._curType=a;this._fireEvent("start",a);this._isUsingRowSelector=this._isStartFocus=!0;this._highlight(a,b,this._toSelect);this._isStartFocus=!1}},_endSelect:function(a){a==="row"&&delete this._isUsingRowSelector;if(a=="all")this._endSelect("col"),this._endSelect("row"),this._endSelect("cell");else if(this._selecting[a])this._addToSelected(a),this._lastAnchorPoint[a]=this._startPoint[a],
this._lastEndPoint[a]=this._currentPoint[a],this._toSelect&&(this._lastSelectedAnchorPoint[a]=this._lastAnchorPoint[a],this._lastSelectedEndPoint[a]=this._lastEndPoint[a]),this._startPoint[a]=this._currentPoint[a]=null,this._selecting[a]=!1,this._lastType=a,this._fireEvent("end",a)},_fireEvent:function(a,b){switch(a){case "start":this.grid[this._toSelect?"onStartSelect":"onStartDeselect"](b,this._startPoint[b],this._selected);break;case "end":this.grid[this._toSelect?"onEndSelect":"onEndDeselect"](b,
this._lastAnchorPoint[b],this._lastEndPoint[b],this._selected)}},_calcToHighlight:function(a,b,c,d){if(d!==void 0){var e;if(this._usingKeyboard&&!c&&this._isInLastRange(this._lastType,b)){e=this._isSelected(a,b);if(d&&e)return!1;if(!d&&!e&&this._isInLastRange(this._lastType,b,!0))return!0}return c?d:e||this._isSelected(a,b)}return c},_highlightNode:function(a,b){a&&(dojo.toggleClass(a,"dojoxGridRowSelected",b),dojo.toggleClass(a,"dojoxGridCellSelected",b))},_highlightHeader:function(a,b){var c=this.grid.layout.cells[a].getHeaderNode();
dojo.toggleClass(c,"dojoxGridHeaderSelected",b)},_highlightRowSelector:function(a,b){var c=this.grid.views.views[0];c instanceof dojox.grid._RowSelector&&(c=c.getRowNode(a))&&dojo.toggleClass(c,"dojoxGridRowSelectorSelected",b)},_highlightSingle:function(a,b,c,d,e){var f=this,g,h=f.grid,j=h.layout.cells;switch(a){case "cell":g=this._calcToHighlight(a,c,b,d);a=j[c.col];!a.hidden&&!a.notselectable&&this._highlightNode(c.node||a.getNode(c.row),g);break;case "col":g=this._calcToHighlight(a,c,b,d);this._highlightHeader(c.col,
g);dojo.query("td[idx='"+c.col+"']",h.domNode).forEach(function(a){var b=j[c.col].view.content.findRowTarget(a);b&&f._highlightSingle("cell",g,{row:b[dojox.grid.util.rowIndexTag],col:c.col,node:a})});break;case "row":g=this._calcToHighlight(a,c,b,d),this._highlightRowSelector(c.row,g),dojo.forEach(j,function(a){f._highlightSingle("cell",g,{row:c.row,col:a.index,node:a.getNode(c.row)})}),this._selectedRowModified=!0,e||h.selection.setSelected(c.row,g)}},_highlight:function(a,b,c){if(this._selecting[a]&&
b!==null){var d=this._startPoint[a],e=this._currentPoint[a],f=this,g=function(b,d,e){f._forEach(a,b,d,function(b){f._highlightSingle(a,e,b,c)},!0)};switch(a){case "col":case "row":e!==null?i(a,b,d,e,!0)?g(e,b,!1):(i(a,d,b,e,!0)&&(g(e,d,!1),e=d),g(b,e,!0)):this._highlightSingle(a,!0,b,c);break;case "cell":e!==null&&(i("row",b,d,e,!0)||i("col",b,d,e,!0)||i("row",d,b,e,!0)||i("col",d,b,e,!0))&&g(d,e,!1),g(d,b,!0)}this._currentPoint[a]=b;this._focusPoint(a,this._currentPoint)}},_focusPoint:function(a,
b){if(!this._isStartFocus){var c=b[a],d=this.grid.focus;a=="col"?(d._colHeadFocusIdx=c.col,d.focusArea("header")):a=="row"?d.focusArea("rowHeader",{rowIndex:c.row}):a=="cell"&&d.setFocusIndex(c.row,c.col)}},_blurPoint:function(a){var b=this.grid.focus;a=="col"?b._blurHeader():a=="cell"&&b._blurContent()},_addToSelected:function(a){var b=this._toSelect,c=this,d=[],e=[],f=this._startPoint[a],g=this._currentPoint[a];this._usingKeyboard&&this._forEach(a,this._lastAnchorPoint[a],this._lastEndPoint[a],
function(c){i(a,c,f,g)||(b?e:d).push(c)});this._forEach(a,f,g,function(f){var g=c._isSelected(a,f);b&&!g?d.push(f):b||e.push(f)});this._add(a,d);this._remove(a,e);dojo.forEach(this._selected.row,function(a){if(a.except.length>0)this._selectedRowModified=!0,this.grid.selection.setSelected(a.row,!1)},this)},_forEach:function(a,b,c,d,e){if(this._isValid(a,b,!0)&&this._isValid(a,c,!0))switch(a){case "col":case "row":var b=b[a],c=c[a],f=c>b?1:-1;for(e||(c+=f);b!=c;b+=f)d(h(a,b));break;case "cell":for(var e=
c.col>b.col?1:-1,f=c.row>b.row?1:-1,g=b.row,i=c.row+f;g!=i;g+=f)for(var j=b.col,k=c.col+e;j!=k;j+=e)d(h(a,g,j))}},_makeupForExceptions:function(a,b){var c=[];dojo.forEach(this._selected[a],function(d){dojo.forEach(b,function(b){if(d[a]==b[a]){var f=dojo.indexOf(d.except,b[k[a]]);f>=0&&d.except.splice(f,1);c.push(b)}})});return c},_makeupForCells:function(a,b){var c=[];dojo.forEach(this._selected.cell,function(d){dojo.some(b,function(b){return d[a]==b[a]?(c.push(d),!0):!1})});this._remove("cell",c);
dojo.forEach(this._selected[k[a]],function(c){dojo.forEach(b,function(b){b=dojo.indexOf(c.except,b[a]);b>=0&&c.except.splice(b,1)})})},_addException:function(a,b){dojo.forEach(this._selected[a],function(c){dojo.forEach(b,function(b){c.except.push(b[k[a]])})})},_addCellException:function(a,b){dojo.forEach(this._selected[a],function(c){dojo.forEach(b,function(b){c[a]==b[a]&&c.except.push(b[k[a]])})})},_add:function(a,b){var c=this.grid.layout.cells;if(a=="cell")var d=this._makeupForExceptions("col",
b),e=this._makeupForExceptions("row",b),b=dojo.filter(b,function(a){return dojo.indexOf(d,a)<0&&dojo.indexOf(e,a)<0&&!c[a.col].hidden&&!c[a.col].notselectable});else a=="col"&&(b=dojo.filter(b,function(a){return!c[a.col].hidden&&!c[a.col].notselectable})),this._makeupForCells(a,b),this._selected[a]=dojo.filter(this._selected[a],function(c){return dojo.every(b,function(b){return c[a]!==b[a]})});a!="col"&&this.grid._hasIdentity&&dojo.forEach(b,function(a){var b=this.grid._by_idx[a.row];if(b)a.id=b.idty},
this);this._selected[a]=this._selected[a].concat(b)},_remove:function(a,b){var c=dojo.partial(n,a);this._selected[a]=dojo.filter(this._selected[a],function(a){return!dojo.some(b,function(b){return c(a,b)})});a=="cell"?(this._addCellException("col",b),this._addCellException("row",b)):this._addException(k[a],b)},_isCellNotInExcept:function(a,b){var c=b[a],d=b[k[a]];return dojo.some(this._selected[a],function(b){return b[a]==c&&dojo.indexOf(b.except,d)<0})},_isSelected:function(a,b){if(!b)return!1;var c=
dojo.some(this._selected[a],function(c){var e=n(a,b,c);return e&&a!=="cell"?c.except.length===0:e});!c&&a==="cell"&&(c=this._isCellNotInExcept("col",b)||this._isCellNotInExcept("row",b),a==="cell"&&(c=c&&!this.grid.layout.cells[b.col].notselectable));return c},_isInLastRange:function(a,b,c){var d=this[c?"_lastSelectedAnchorPoint":"_lastAnchorPoint"][a],c=this[c?"_lastSelectedEndPoint":"_lastEndPoint"][a];return!b||!d||!c?!1:i(a,b,d,c)},_isValid:function(a,b,c){if(!b)return!1;try{var d=this.grid,e=
b[a];switch(a){case "col":return e>=0&&e<d.layout.cells.length&&dojo.isArray(b.except)&&(c||!d.layout.cells[e].notselectable);case "row":return e>=0&&e<d.rowCount&&dojo.isArray(b.except);case "cell":return b.col>=0&&b.col<d.layout.cells.length&&b.row>=0&&b.row<d.rowCount&&(c||!d.layout.cells[b.col].notselectable)}}catch(f){}return!1}});dojox.grid.EnhancedGrid.registerPlugin(dojox.grid.enhanced.plugins.Selector,{dependency:["autoScroll"]})}());