/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.grid.enhanced.plugins.AutoScroll"]||(dojo._hasResource["dojox.grid.enhanced.plugins.AutoScroll"]=!0,dojo.provide("dojox.grid.enhanced.plugins.AutoScroll"),dojo.require("dojox.grid.enhanced._Plugin"),dojo.require("dojox.grid._RowSelector"),dojo.declare("dojox.grid.enhanced.plugins.AutoScroll",dojox.grid.enhanced._Plugin,{name:"autoScroll",autoScrollInterval:1E3,autoScrollMargin:30,constructor:function(c,a){this.grid=c;this._scrolling=this.readyForAutoScroll=!1;a=dojo.isObject(a)?
a:{};if("interval"in a)this.autoScrollInterval=a.interval;if("margin"in a)this.autoScrollMargin=a.margin;this._initEvents();this._mixinGrid()},_initEvents:function(){var c=this.grid;this.connect(c,"onCellMouseDown",function(){this.readyForAutoScroll=!0});this.connect(c,"onHeaderCellMouseDown",function(){this.readyForAutoScroll=!0});this.connect(c,"onRowSelectorMouseDown",function(){this.readyForAutoScroll=!0});this.connect(dojo.doc,"onmouseup",function(){this._manageAutoScroll(!0);this.readyForAutoScroll=
!1});this.connect(dojo.doc,"onmousemove",function(a){if(this.readyForAutoScroll){this._event=a;var b=dojo.position(c.domNode),e=c._getHeaderHeight(),d=this.autoScrollMargin,f=a.clientY,i=a.clientX,a=b.y,g=b.x,h=b.h,b=b.w;if(i>=g&&i<=g+b)if(f>=a+e&&f<a+e+d){this._manageAutoScroll(!1,!0,!1);return}else if(f>a+h-d&&f<=a+h){this._manageAutoScroll(!1,!0,!0);return}else if(f>=a&&f<=a+h&&dojo.some(c.views.views,function(a){if(a instanceof dojox.grid._RowSelector)return!1;var b=dojo.position(a.domNode);if(i<
b.x+d&&i>=b.x)return this._manageAutoScroll(!1,!1,!1,a),!0;else if(i>b.x+b.w-d&&i<b.x+b.w)return this._manageAutoScroll(!1,!1,!0,a),!0;return!1},this))return;this._manageAutoScroll(!0)}})},_mixinGrid:function(){var c=this.grid;c.onStartAutoScroll=function(){};c.onEndAutoScroll=function(){}},_fireEvent:function(c,a){var b=this.grid;switch(c){case "start":b.onStartAutoScroll.apply(b,a);break;case "end":b.onEndAutoScroll.apply(b,a)}},_manageAutoScroll:function(c,a,b,e){if(c)this._scrolling=!1,clearInterval(this._handler);
else if(!this._scrolling)this._scrolling=!0,this._fireEvent("start",[a,b,e]),this._autoScroll(a,b,e),this._handler=setInterval(dojo.hitch(this,"_autoScroll",a,b,e),this.autoScrollInterval)},_autoScroll:function(c,a,b){var e=this.grid,d=null;if(c){var f=e.scroller.firstVisibleRow+(a?1:-1);f>=0&&f<e.rowCount&&(e.scrollToRow(f),d=f)}else d=this._scrollColumn(a,b);d!==null&&this._fireEvent("end",[c,a,b,d,this._event])},_scrollColumn:function(c,a){var b=a.scrollboxNode,e=null;if(b.clientWidth<b.scrollWidth){var d=
dojo.filter(this.grid.layout.cells,function(a){return!a.hidden}),f=dojo.position(a.domNode),i,g,h;if(c){i=b.clientWidth;for(h=0;h<d.length;++h)if(g=dojo.position(d[h].getHeaderNode()),g=g.x-f.x+g.w,g>i){e=d[h].index;b.scrollLeft+=g-i+10;break}}else{i=0;for(h=d.length-1;h>=0;--h)if(g=dojo.position(d[h].getHeaderNode()),g=g.x-f.x,g<i){e=d[h].index;b.scrollLeft+=g-i-10;break}}}return e}}),dojox.grid.EnhancedGrid.registerPlugin(dojox.grid.enhanced.plugins.AutoScroll));