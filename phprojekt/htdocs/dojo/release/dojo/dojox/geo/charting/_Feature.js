/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.geo.charting._Feature"]||(dojo._hasResource["dojox.geo.charting._Feature"]=!0,dojo.provide("dojox.geo.charting._Feature"),dojo.require("dojox.gfx.fx"),dojo.declare("dojox.geo.charting._Feature",null,{_isZoomIn:!1,_isFocused:!1,markerText:null,constructor:function(a,c,b){this.id=c;this.shape=a.mapObj.createGroup();this.parent=a;this.mapObj=a.mapObj;this._bbox=b.bbox;this._center=b.center;this._defaultFill=a.defaultColor;this._highlightFill=a.highlightColor;this._defaultStroke=
{width:this._normalizeStrokeWeight(0.5),color:"white"};this._scale=Math.min(this.parent.containerSize.w/this._bbox.w,this.parent.containerSize.h/this._bbox.h);a=dojo.isArray(b.shape[0])?b.shape:[b.shape];dojo.forEach(a,function(a){this.shape.createPolyline(a).setStroke(this._defaultStroke).setFill(this._defaultFill)},this)},setValue:function(a){this.value=a;if(this.parent.series.length!=0)for(var c=0;c<this.parent.series.length;c++){var b=this.parent.series[c];if(a>=b.min&&a<b.max)this._setFillWith(b.color),
this._defaultFill=b.color}},_setFillWith:function(a){var c=dojo.isArray(this.shape.children)?this.shape.children:[this.shape.children];dojo.forEach(c,function(b){b.setFill(a)})},_setStrokeWith:function(a){var c=dojo.isArray(this.shape.children)?this.shape.children:[this.shape.children];dojo.forEach(c,function(b){b.setStroke({color:a.color,width:a.width,join:"round"})})},_normalizeStrokeWeight:function(a){this.shape._getRealMatrix();return dojox.gfx.renderer!="vml"?a/(this.shape._getRealMatrix()||
{xx:1}).xx:a},_onmouseoverHandler:function(){this.parent.onFeatureOver(this);this._setFillWith(this._highlightFill);this.mapObj.marker.show(this.id)},_onmouseoutHandler:function(){this._setFillWith(this._defaultFill);this.mapObj.marker.hide();dojo.style("mapZoomCursor","display","none")},_onmousemoveHandler:function(a){if(this._isFocused)a=dojo.fixEvent(a||window.event),dojo.style("mapZoomCursor","left",a.pageX+12+"px"),dojo.style("mapZoomCursor","top",a.pageY+"px"),dojo.byId("mapZoomCursor").className=
this._isZoomIn?"mapZoomOut":"mapZoomIn",dojo.style("mapZoomCursor","display","block")},_onclickHandler:function(){if(this._isFocused)this._isZoomIn?this._zoomOut():this._zoomIn();else{for(var a in this.mapObj.features)if(this.mapObj.features[a]!=this)this.mapObj.features[a]._setStrokeWith(this._defaultStroke),this.mapObj.features[a]._setFillWith(this.mapObj.features[a]._defaultFill),this.mapObj.features[a]._isFocused=!1,this.mapObj.features[a]._isZoomIn=!1;this._focus()}},_focus:function(){this.shape._moveToFront();
this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)});this.parent.onFeatureClick(this);this._isFocused=!0},_zoomIn:function(){var a=dojox.gfx.fx.animateTransform({duration:1E3,shape:this.mapObj,transform:[{name:"translate",start:[-this.mapObj.currentBBox.x,-this.mapObj.currentBBox.y],end:[-this._bbox.x,-this._bbox.y]},{name:"scaleAt",start:[this.mapObj.currentScale,this.mapObj.currentBBox.x,this.mapObj.currentBBox.y],end:[this._scale,this._bbox.x,this._bbox.y]}]});dojo.connect(a,
"onEnd",this,function(){this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)});this.parent.onZoomEnd(this)});a.play();this.mapObj.currentScale=this._scale;this.mapObj.currentBBox={x:this._bbox.x,y:this._bbox.y};this._isZoomIn=!0;dojo.byId("mapZoomCursor").className=""},_zoomOut:function(){var a=dojox.gfx.fx.animateTransform({duration:1E3,shape:this.mapObj,transform:[{name:"translate",start:[-this._bbox.x,-this._bbox.y],end:[-this.mapObj.boundBox[0],-this.mapObj.boundBox[1]]},{name:"scaleAt",
start:[this._scale,this._bbox.x,this._bbox.y],end:[this.mapObj.scale,this.mapObj.boundBox[0],this.mapObj.boundBox[1]]}]});dojo.connect(a,"onEnd",this,function(){this._setStrokeWith({color:"black",width:this._normalizeStrokeWeight(2)})});a.play();this.mapObj.currentScale=this.mapObj.scale;this.mapObj.currentBBox={x:this.mapObj.boundBox[0],y:this.mapObj.boundBox[1]};this._isZoomIn=!1;dojo.byId("mapZoomCursor").className=""},init:function(){this.shape.rawNode.id=this.id;this.tooltip=null;this.shape.connect("onmouseover",
this,this._onmouseoverHandler);this.shape.connect("onmouseout",this,this._onmouseoutHandler);this.shape.connect("onmousemove",this,this._onmousemoveHandler);this.shape.connect("onclick",this,this._onclickHandler)}}));