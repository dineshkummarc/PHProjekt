/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.layout.ResizeHandle"]||(dojo._hasResource["dojox.layout.ResizeHandle"]=!0,dojo.provide("dojox.layout.ResizeHandle"),dojo.experimental("dojox.layout.ResizeHandle"),dojo.require("dijit._Widget"),dojo.require("dijit._Templated"),dojo.require("dojo.fx"),dojo.require("dojo.window"),dojo.declare("dojox.layout.ResizeHandle",[dijit._Widget,dijit._Templated],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,
animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'<div dojoAttachPoint="resizeHandle" class="dojoxResizeHandle"><div></div></div>',postCreate:function(){this.connect(this.resizeHandle,"onmousedown","_beginSizing");if(this.activeResize)this.animateSizing=!1;else if(this._resizeHelper=dijit.byId("dojoxGlobalResizeHelper"),!this._resizeHelper)this._resizeHelper=
(new dojox.layout._ResizeHelper({id:"dojoxGlobalResizeHelper"})).placeAt(dojo.body()),dojo.addClass(this._resizeHelper.domNode,this.activeResizeClass);if(!this.minSize)this.minSize={w:this.minWidth,h:this.minHeight};if(this.constrainMax)this.maxSize={w:this.maxWidth,h:this.maxHeight};this._resizeX=this._resizeY=!1;var a=dojo.partial(dojo.addClass,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");
break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(this._isSizing)return!1;dojo.publish(this.startTopic,[this]);this.targetDomNode=(this.targetWidget=dijit.byId(this.targetId))?this.targetWidget.domNode:dojo.byId(this.targetId);if(this.targetContainer)this.targetDomNode=this.targetContainer;if(!this.targetDomNode)return!1;if(!this.activeResize){var b=dojo.position(this.targetDomNode,!0);console.log(b);console.log(dojo.window.getBox());this._resizeHelper.resize({l:b.x,
t:b.y,w:b.w,h:b.h});this._resizeHelper.show()}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};var c=this.targetWidget?dojo.marginBox(this.targetDomNode):dojo.contentBox(this.targetDomNode);this.startSize={w:c.w,h:c.h};if(this.fixedAspect)c.w>c.h?(b="w",c=c.w/c.h):(b="h",c=c.h/c.w),this._aspect={prop:b},this._aspect[b]=c;this._pconnects=[];this._pconnects.push(dojo.connect(dojo.doc,"onmousemove",this,"_updateSizing"));this._pconnects.push(dojo.connect(dojo.doc,"onmouseup",this,"_endSizing"));
dojo.stopEvent(a)},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a);if(b===!1)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a){try{if(!a.clientX||!a.clientY)return!1}catch(b){return!1}this._activeResizeLastEvent=a;var c=this.isLeftToRight()?this.startPoint.x-a.clientX:a.clientX-this.startPoint.x,a=this.startPoint.y-a.clientY;return this._checkConstraints(this.startSize.w-(this._resizeX?c:0),this.startSize.h-(this._resizeY?
a:0))},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;if(a<c.w)a=c.w;if(b<c.h)b=c.h}if(this.constrainMax&&this.maxSize){c=this.maxSize;if(a>c.w)a=c.w;if(b>c.h)b=c.h}this.fixedAspect&&(c=this._aspect[this._aspect.prop],a<b?b=a*c:b<a&&(a=b*c));return{w:a,h:b}},_changeSizing:function(a){var b=this._getNewCoords(a);if(b!==!1&&(this.targetWidget&&dojo.isFunction(this.targetWidget.resize)?this.targetWidget.resize(b):this.animateSizing?dojo.fx[this.animateMethod]([dojo.animateProperty({node:this.targetDomNode,
properties:{width:{start:this.startSize.w,end:b.w}},duration:this.animateDuration}),dojo.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:b.h}},duration:this.animateDuration})]).play():dojo.style(this.targetDomNode,{width:b.w+"px",height:b.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){dojo.forEach(this._pconnects,dojo.disconnect);var b=dojo.partial(dojo.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),
this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(){}}),dojo.declare("dojox.layout._ResizeHelper",dijit._Widget,{show:function(){dojo.fadeIn({node:this.domNode,duration:120,beforeBegin:function(a){dojo.style(a,"display","")}}).play()},hide:function(){dojo.fadeOut({node:this.domNode,duration:250,onEnd:function(a){dojo.style(a,"display","none")}}).play()},resize:function(a){dojo.marginBox(this.domNode,a)}}));