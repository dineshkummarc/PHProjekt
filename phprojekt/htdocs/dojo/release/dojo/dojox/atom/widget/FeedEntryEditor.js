/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojox.atom.widget.FeedEntryEditor"]||(dojo._hasResource["dojox.atom.widget.FeedEntryEditor"]=!0,dojo.provide("dojox.atom.widget.FeedEntryEditor"),dojo.require("dojox.atom.widget.FeedEntryViewer"),dojo.require("dijit._Widget"),dojo.require("dijit._Templated"),dojo.require("dijit._Container"),dojo.require("dijit.Editor"),dojo.require("dijit.form.TextBox"),dojo.require("dijit.form.SimpleTextarea"),dojo.requireLocalization("dojox.atom.widget","FeedEntryEditor",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"),
dojo.requireLocalization("dojox.atom.widget","PeopleEditor",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"),dojo.experimental("dojox.atom.widget.FeedEntryEditor"),dojo.declare("dojox.atom.widget.FeedEntryEditor",dojox.atom.widget.FeedEntryViewer,{_contentEditor:null,_oldContent:null,_setObject:null,enableEdit:!1,_contentEditorCreator:null,_editors:{},entryNewButton:null,_editable:!1,templateString:dojo.cache("dojox.atom","widget/templates/FeedEntryEditor.html",
'<div class="feedEntryViewer">\n    <table border="0" width="100%" class="feedEntryViewerMenuTable" dojoAttachPoint="feedEntryViewerMenu" style="display: none;">\n        <tr width="100%"  dojoAttachPoint="entryCheckBoxDisplayOptions">\n        \t<td align="left" dojoAttachPoint="entryNewButton">\n                <span class="feedEntryViewerMenu" dojoAttachPoint="doNew" dojoAttachEvent="onclick:_toggleNew"></span>\n        \t</td>\n            <td align="left" dojoAttachPoint="entryEditButton" style="display: none;">\n                <span class="feedEntryViewerMenu" dojoAttachPoint="edit" dojoAttachEvent="onclick:_toggleEdit"></span>\n            </td>\n            <td align="left" dojoAttachPoint="entrySaveCancelButtons" style="display: none;">\n                <span class="feedEntryViewerMenu" dojoAttachPoint="save" dojoAttachEvent="onclick:saveEdits"></span>\n                <span class="feedEntryViewerMenu" dojoAttachPoint="cancel" dojoAttachEvent="onclick:cancelEdits"></span>\n            </td>\n            <td align="right">\n                <span class="feedEntryViewerMenu" dojoAttachPoint="displayOptions" dojoAttachEvent="onclick:_toggleOptions"></span>\n            </td>\n        </tr>\n        <tr class="feedEntryViewerDisplayCheckbox" dojoAttachPoint="entryCheckBoxRow" width="100%" style="display: none;">\n            <td dojoAttachPoint="feedEntryCelltitle">\n                <input type="checkbox" name="title" value="Title" dojoAttachPoint="feedEntryCheckBoxTitle" dojoAttachEvent="onclick:_toggleCheckbox"/>\n\t\t\t\t<label for="title" dojoAttachPoint="feedEntryCheckBoxLabelTitle"></label>\n            </td>\n            <td dojoAttachPoint="feedEntryCellauthors">\n                <input type="checkbox" name="authors" value="Authors" dojoAttachPoint="feedEntryCheckBoxAuthors" dojoAttachEvent="onclick:_toggleCheckbox"/>\n\t\t\t\t<label for="title" dojoAttachPoint="feedEntryCheckBoxLabelAuthors"></label>\n            </td>\n            <td dojoAttachPoint="feedEntryCellcontributors">\n                <input type="checkbox" name="contributors" value="Contributors" dojoAttachPoint="feedEntryCheckBoxContributors" dojoAttachEvent="onclick:_toggleCheckbox"/>\n\t\t\t\t<label for="title" dojoAttachPoint="feedEntryCheckBoxLabelContributors"></label>\n            </td>\n            <td dojoAttachPoint="feedEntryCellid">\n                <input type="checkbox" name="id" value="Id" dojoAttachPoint="feedEntryCheckBoxId" dojoAttachEvent="onclick:_toggleCheckbox"/>\n\t\t\t\t<label for="title" dojoAttachPoint="feedEntryCheckBoxLabelId"></label>\n            </td>\n            <td rowspan="2" align="right">\n                <span class="feedEntryViewerMenu" dojoAttachPoint="close" dojoAttachEvent="onclick:_toggleOptions"></span>\n            </td>\n\t\t</tr>\n\t\t<tr class="feedEntryViewerDisplayCheckbox" dojoAttachPoint="entryCheckBoxRow2" width="100%" style="display: none;">\n            <td dojoAttachPoint="feedEntryCellupdated">\n                <input type="checkbox" name="updated" value="Updated" dojoAttachPoint="feedEntryCheckBoxUpdated" dojoAttachEvent="onclick:_toggleCheckbox"/>\n\t\t\t\t<label for="title" dojoAttachPoint="feedEntryCheckBoxLabelUpdated"></label>\n            </td>\n            <td dojoAttachPoint="feedEntryCellsummary">\n                <input type="checkbox" name="summary" value="Summary" dojoAttachPoint="feedEntryCheckBoxSummary" dojoAttachEvent="onclick:_toggleCheckbox"/>\n\t\t\t\t<label for="title" dojoAttachPoint="feedEntryCheckBoxLabelSummary"></label>\n            </td>\n            <td dojoAttachPoint="feedEntryCellcontent">\n                <input type="checkbox" name="content" value="Content" dojoAttachPoint="feedEntryCheckBoxContent" dojoAttachEvent="onclick:_toggleCheckbox"/>\n\t\t\t\t<label for="title" dojoAttachPoint="feedEntryCheckBoxLabelContent"></label>\n            </td>\n        </tr>\n    </table>\n    \n    <table class="feedEntryViewerContainer" border="0" width="100%">\n        <tr class="feedEntryViewerTitle" dojoAttachPoint="entryTitleRow" style="display: none;">\n            <td>\n                <table width="100%" cellpadding="0" cellspacing="0" border="0">\n                    <tr class="graphic-tab-lgray">\n\t\t\t\t\t\t<td class="lp2">\n\t\t\t\t\t\t\t<span class="lp" dojoAttachPoint="entryTitleHeader"></span>\n\t\t\t\t\t\t</td>\n                    </tr>\n                    <tr>\n                        <td>\n                        \t<select dojoAttachPoint="entryTitleSelect" dojoAttachEvent="onchange:_switchEditor" style="display: none">\n                        \t\t<option value="text">Text</option>\n\t\t\t\t\t\t\t\t<option value="html">HTML</option>\n\t\t\t\t\t\t\t\t<option value="xhtml">XHTML</option>\n                        \t</select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td colspan="2" dojoAttachPoint="entryTitleNode">\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n\n        <tr class="feedEntryViewerAuthor" dojoAttachPoint="entryAuthorRow" style="display: none;">\n            <td>\n                <table width="100%" cellpadding="0" cellspacing="0" border="0">\n                    <tr class="graphic-tab-lgray">\n\t\t\t\t\t\t<td class="lp2">\n\t\t\t\t\t\t\t<span class="lp" dojoAttachPoint="entryAuthorHeader"></span>\n\t\t\t\t\t\t</td>\n                    </tr>\n                    <tr>\n                        <td dojoAttachPoint="entryAuthorNode">\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n\n        <tr class="feedEntryViewerContributor" dojoAttachPoint="entryContributorRow" style="display: none;">\n            <td>\n                <table width="100%" cellpadding="0" cellspacing="0" border="0">\n                    <tr class="graphic-tab-lgray">\n\t\t\t\t\t\t<td class="lp2">\n\t\t\t\t\t\t\t<span class="lp" dojoAttachPoint="entryContributorHeader"></span>\n\t\t\t\t\t\t</td>\n                    </tr>\n                    <tr>\n                        <td dojoAttachPoint="entryContributorNode" class="feedEntryViewerContributorNames">\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n        \n        <tr class="feedEntryViewerId" dojoAttachPoint="entryIdRow" style="display: none;">\n            <td>\n                <table width="100%" cellpadding="0" cellspacing="0" border="0">\n                    <tr class="graphic-tab-lgray">\n\t\t\t\t\t\t<td class="lp2">\n\t\t\t\t\t\t\t<span class="lp" dojoAttachPoint="entryIdHeader"></span>\n\t\t\t\t\t\t</td>\n                    </tr>\n                    <tr>\n                        <td dojoAttachPoint="entryIdNode" class="feedEntryViewerIdText">\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    \n        <tr class="feedEntryViewerUpdated" dojoAttachPoint="entryUpdatedRow" style="display: none;">\n            <td>\n                <table width="100%" cellpadding="0" cellspacing="0" border="0">\n                    <tr class="graphic-tab-lgray">\n\t\t\t\t\t\t<td class="lp2">\n\t\t\t\t\t\t\t<span class="lp" dojoAttachPoint="entryUpdatedHeader"></span>\n\t\t\t\t\t\t</td>\n                    </tr>\n                    <tr>\n                        <td dojoAttachPoint="entryUpdatedNode" class="feedEntryViewerUpdatedText">\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    \n        <tr class="feedEntryViewerSummary" dojoAttachPoint="entrySummaryRow" style="display: none;">\n            <td>\n                <table width="100%" cellpadding="0" cellspacing="0" border="0">\n                    <tr class="graphic-tab-lgray">\n\t\t\t\t\t\t<td class="lp2" colspan="2">\n\t\t\t\t\t\t\t<span class="lp" dojoAttachPoint="entrySummaryHeader"></span>\n\t\t\t\t\t\t</td>\n                    </tr>\n                    <tr>\n                        <td>\n                        \t<select dojoAttachPoint="entrySummarySelect" dojoAttachEvent="onchange:_switchEditor" style="display: none">\n                        \t\t<option value="text">Text</option>\n\t\t\t\t\t\t\t\t<option value="html">HTML</option>\n\t\t\t\t\t\t\t\t<option value="xhtml">XHTML</option>\n                        \t</select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td dojoAttachPoint="entrySummaryNode">\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    \n        <tr class="feedEntryViewerContent" dojoAttachPoint="entryContentRow" style="display: none;">\n            <td>\n                <table width="100%" cellpadding="0" cellspacing="0" border="0">\n                    <tr class="graphic-tab-lgray">\n\t\t\t\t\t\t<td class="lp2">\n\t\t\t\t\t\t\t<span class="lp" dojoAttachPoint="entryContentHeader"></span>\n\t\t\t\t\t\t</td>\n                    </tr>\n                    <tr>\n                        <td>\n                        \t<select dojoAttachPoint="entryContentSelect" dojoAttachEvent="onchange:_switchEditor" style="display: none">\n                        \t\t<option value="text">Text</option>\n\t\t\t\t\t\t\t\t<option value="html">HTML</option>\n\t\t\t\t\t\t\t\t<option value="xhtml">XHTML</option>\n                        \t</select>\n                        </td>\n                    </tr>\n                    <tr>\n                        <td dojoAttachPoint="entryContentNode">\n                        </td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n</div>\n'),
postCreate:function(){if(this.entrySelectionTopic!=="")this._subscriptions=[dojo.subscribe(this.entrySelectionTopic,this,"_handleEvent")];var a=dojo.i18n.getLocalization("dojox.atom.widget","FeedEntryViewer");this.displayOptions.innerHTML=a.displayOptions;this.feedEntryCheckBoxLabelTitle.innerHTML=a.title;this.feedEntryCheckBoxLabelAuthors.innerHTML=a.authors;this.feedEntryCheckBoxLabelContributors.innerHTML=a.contributors;this.feedEntryCheckBoxLabelId.innerHTML=a.id;this.close.innerHTML=a.close;
this.feedEntryCheckBoxLabelUpdated.innerHTML=a.updated;this.feedEntryCheckBoxLabelSummary.innerHTML=a.summary;this.feedEntryCheckBoxLabelContent.innerHTML=a.content;a=dojo.i18n.getLocalization("dojox.atom.widget","FeedEntryEditor");this.doNew.innerHTML=a.doNew;this.edit.innerHTML=a.edit;this.save.innerHTML=a.save;this.cancel.innerHTML=a.cancel},setEntry:function(a,b,c){c=this._entry!==a?this._editMode=!1:!0;dojox.atom.widget.FeedEntryEditor.superclass.setEntry.call(this,a,b);this._editable=this._isEditable(a);
!c&&!this._editable&&(dojo.style(this.entryEditButton,"display","none"),dojo.style(this.entrySaveCancelButtons,"display","none"));this._editable&&this.enableEdit&&!c&&(dojo.style(this.entryEditButton,"display",""),this.enableMenuFade&&this.entrySaveCancelButton&&dojo.fadeOut({node:this.entrySaveCancelButton,duration:250}).play())},_toggleEdit:function(){if(this._editable&&this.enableEdit)dojo.style(this.entryEditButton,"display","none"),dojo.style(this.entrySaveCancelButtons,"display",""),this._editMode=
!0,this.setEntry(this._entry,this._feed,!0)},_handleEvent:function(a){a.source!=this&&a.action=="delete"&&a.entry&&a.entry==this._entry&&dojo.style(this.entryEditButton,"display","none");dojox.atom.widget.FeedEntryEditor.superclass._handleEvent.call(this,a)},_isEditable:function(a){var b=!1;if(a&&a!==null&&a.links&&a.links!==null)for(var c in a.links)if(a.links[c].rel&&a.links[c].rel=="edit"){b=!0;break}return b},setTitle:function(a,b,c){if(b){if(c.title&&c.title.value&&c.title.value!==null){if(!this._toLoad)this._toLoad=
[];this.entryTitleSelect.value=c.title.type;a=this._createEditor(a,c.title,!0,c.title.type==="html"||c.title.type==="xhtml");a.name="title";this._toLoad.push(a);this.setFieldValidity("titleedit",!0);this.setFieldValidity("title",!0)}}else dojox.atom.widget.FeedEntryEditor.superclass.setTitle.call(this,a,b,c),c.title&&c.title.value&&c.title.value!==null&&this.setFieldValidity("title",!0)},setAuthors:function(a,b,c){if(b){if(c.authors&&c.authors.length>0)this._editors.authors=this._createPeopleEditor(this.entryAuthorNode,
{data:c.authors,name:"Author"}),this.setFieldValidity("authors",!0)}else dojox.atom.widget.FeedEntryEditor.superclass.setAuthors.call(this,a,b,c),c.authors&&c.authors.length>0&&this.setFieldValidity("authors",!0)},setContributors:function(a,b,c){if(b){if(c.contributors&&c.contributors.length>0)this._editors.contributors=this._createPeopleEditor(this.entryContributorNode,{data:c.contributors,name:"Contributor"}),this.setFieldValidity("contributors",!0)}else dojox.atom.widget.FeedEntryEditor.superclass.setContributors.call(this,
a,b,c),c.contributors&&c.contributors.length>0&&this.setFieldValidity("contributors",!0)},setId:function(a,b,c){if(b){if(c.id&&c.id!==null)this._editors.id=this._createEditor(a,c.id),this.setFieldValidity("id",!0)}else dojox.atom.widget.FeedEntryEditor.superclass.setId.call(this,a,b,c),c.id&&c.id!==null&&this.setFieldValidity("id",!0)},setUpdated:function(a,b,c){if(b){if(c.updated&&c.updated!==null)this._editors.updated=this._createEditor(a,c.updated),this.setFieldValidity("updated",!0)}else dojox.atom.widget.FeedEntryEditor.superclass.setUpdated.call(this,
a,b,c),c.updated&&c.updated!==null&&this.setFieldValidity("updated",!0)},setSummary:function(a,b,c){if(b){if(c.summary&&c.summary.value&&c.summary.value!==null){if(!this._toLoad)this._toLoad=[];this.entrySummarySelect.value=c.summary.type;a=this._createEditor(a,c.summary,!0,c.summary.type==="html"||c.summary.type==="xhtml");a.name="summary";this._toLoad.push(a);this.setFieldValidity("summaryedit",!0);this.setFieldValidity("summary",!0)}}else dojox.atom.widget.FeedEntryEditor.superclass.setSummary.call(this,
a,b,c),c.summary&&c.summary.value&&c.summary.value!==null&&this.setFieldValidity("summary",!0)},setContent:function(a,b,c){if(b){if(c.content&&c.content.value&&c.content.value!==null){if(!this._toLoad)this._toLoad=[];this.entryContentSelect.value=c.content.type;a=this._createEditor(a,c.content,!0,c.content.type==="html"||c.content.type==="xhtml");a.name="content";this._toLoad.push(a);this.setFieldValidity("contentedit",!0);this.setFieldValidity("content",!0)}}else dojox.atom.widget.FeedEntryEditor.superclass.setContent.call(this,
a,b,c),c.content&&c.content.value&&c.content.value!==null&&this.setFieldValidity("content",!0)},_createEditor:function(a,b,c,d){if(!b){if(d)return{anchorNode:a,entryValue:"",editor:null,generateEditor:function(){var a=document.createElement("div");a.innerHTML=this.entryValue;this.anchorNode.appendChild(a);return this.editor=a=new dijit.Editor({},a)}};c?(c=document.createElement("textarea"),a.appendChild(c),dojo.style(c,"width","90%"),a=new dijit.form.SimpleTextarea({},c)):(c=document.createElement("input"),
a.appendChild(c),dojo.style(c,"width","95%"),a=new dijit.form.TextBox({},c));a.attr("value","");return a}b=b.value!==void 0?b.value:b.attr?b.attr("value"):b;if(d)return b.indexOf("<")!=-1&&(b=b.replace(/</g,"&lt;")),{anchorNode:a,entryValue:b,editor:null,generateEditor:function(){var a=document.createElement("div");a.innerHTML=this.entryValue;this.anchorNode.appendChild(a);return this.editor=a=new dijit.Editor({},a)}};c?(c=document.createElement("textarea"),a.appendChild(c),dojo.style(c,"width","90%"),
a=new dijit.form.SimpleTextarea({},c)):(c=document.createElement("input"),a.appendChild(c),dojo.style(c,"width","95%"),a=new dijit.form.TextBox({},c));a.attr("value",b);return a},_switchEditor:function(a){var b=null,c=null,d=null,c=dojo.isIE?a.srcElement:a.target;c===this.entryTitleSelect?(d=this.entryTitleNode,b="title"):c===this.entrySummarySelect?(d=this.entrySummaryNode,b="summary"):(d=this.entryContentNode,b="content");a=this._editors[b];if(c.value==="text"){if(a.declaredClass==="dijit.Editor"){c=
a.attr("value",!1);a.close(!1,!0);for(a.destroy();d.firstChild;)dojo.destroy(d.firstChild);d=this._createEditor(d,{value:c},!0,!1);this._editors[b]=d}}else if(a.declaredClass!="dijit.Editor"){c=a.attr("value");for(a.destroy();d.firstChild;)dojo.destroy(d.firstChild);d=this._createEditor(d,{value:c},!0,!0);d=dojo.hitch(d,d.generateEditor)();this._editors[b]=d}},_createPeopleEditor:function(a,b){var c=document.createElement("div");a.appendChild(c);return new dojox.atom.widget.PeopleEditor(b,c)},saveEdits:function(){dojo.style(this.entrySaveCancelButtons,
"display","none");dojo.style(this.entryEditButton,"display","");dojo.style(this.entryNewButton,"display","");var a=!1,b,c,d,e;if(this._new){this._new=!1;d=new dojox.atom.io.model.Entry;a=this._editors.title.attr("value");this.entryTitleSelect.value==="xhtml"&&(a=this._enforceXhtml(a),a='<div xmlns="http://www.w3.org/1999/xhtml">'+a+"</div>");d.setTitle(a,this.entryTitleSelect.value);d.id=this._editors.id.attr("value");e=this._editors.authors.getValues();for(b in e)(e[b].name||e[b].email||e[b].uri)&&
d.addAuthor(e[b].name,e[b].email,e[b].uri);e=this._editors.contributors.getValues();for(b in e)(e[b].name||e[b].email||e[b].uri)&&d.addContributor(e[b].name,e[b].email,e[b].uri);a=this._editors.summary.attr("value");this.entrySummarySelect.value==="xhtml"&&(a=this._enforceXhtml(a),a='<div xmlns="http://www.w3.org/1999/xhtml">'+a+"</div>");d.summary=new dojox.atom.io.model.Content("summary",a,null,this.entrySummarySelect.value);a=this._editors.content.attr("value");this.entryContentSelect.value===
"xhtml"&&(a=this._enforceXhtml(a),a='<div xmlns="http://www.w3.org/1999/xhtml">'+a+"</div>");d.content=new dojox.atom.io.model.Content("content",a,null,this.entryContentSelect.value);dojo.style(this.entryNewButton,"display","");dojo.publish(this.entrySelectionTopic,[{action:"post",source:this,entry:d}])}else{d=this.getEntry();if(this._editors.title&&(this._editors.title.attr("value")!=d.title.value||this.entryTitleSelect.value!=d.title.type))a=this._editors.title.attr("value"),this.entryTitleSelect.value===
"xhtml"&&(a=this._enforceXhtml(a),a.indexOf('<div xmlns="http://www.w3.org/1999/xhtml">')!==0&&(a='<div xmlns="http://www.w3.org/1999/xhtml">'+a+"</div>")),d.title=new dojox.atom.io.model.Content("title",a,null,this.entryTitleSelect.value),a=!0;if(this._editors.id.attr("value")!=d.id)d.id=this._editors.id.attr("value"),a=!0;if(this._editors.summary&&(this._editors.summary.attr("value")!=d.summary.value||this.entrySummarySelect.value!=d.summary.type))a=this._editors.summary.attr("value"),this.entrySummarySelect.value===
"xhtml"&&(a=this._enforceXhtml(a),a.indexOf('<div xmlns="http://www.w3.org/1999/xhtml">')!==0&&(a='<div xmlns="http://www.w3.org/1999/xhtml">'+a+"</div>")),d.summary=new dojox.atom.io.model.Content("summary",a,null,this.entrySummarySelect.value),a=!0;if(this._editors.content&&(this._editors.content.attr("value")!=d.content.value||this.entryContentSelect.value!=d.content.type))a=this._editors.content.attr("value"),this.entryContentSelect.value==="xhtml"&&(a=this._enforceXhtml(a),a.indexOf('<div xmlns="http://www.w3.org/1999/xhtml">')!==
0&&(a='<div xmlns="http://www.w3.org/1999/xhtml">'+a+"</div>")),d.content=new dojox.atom.io.model.Content("content",a,null,this.entryContentSelect.value),a=!0;if(this._editors.authors)if(a)for(b in d.authors=[],e=this._editors.authors.getValues(),e)(e[b].name||e[b].email||e[b].uri)&&d.addAuthor(e[b].name,e[b].email,e[b].uri);else{var f=d.authors;e=this._editors.authors.getValues();c=!1;for(b in e){var g;a:{for(b in f)if(f[b].name===e[b].name&&f[b].email===e[b].email&&f[b].uri===e[b].uri){g=!0;break a}g=
!1}if(!g){c=!0;break}}if(c){d.authors=[];for(b in e)(e[b].name||e[b].email||e[b].uri)&&d.addAuthor(e[b].name,e[b].email,e[b].uri);a=!0}}if(this._editors.contributors)if(a)for(b in d.contributors=[],e=this._editors.contributors.getValues(),e)(e[b].name||e[b].email||e[b].uri)&&d.addAuthor(e[b].name,e[b].email,e[b].uri);else{f=d.contributors;e=this._editors.contributors.getValues();c=!1;for(b in e){a:{for(b in f)if(f[b].name===e[b].name&&f[b].email===e[b].email&&f[b].uri===e[b].uri){g=!0;break a}g=!1}if(g){c=
!0;break}}if(c){d.contributors=[];for(b in e)(e[b].name||e[b].email||e[b].uri)&&d.addContributor(e[b].name,e[b].email,e[b].uri);a=!0}}a&&dojo.publish(this.entrySelectionTopic,[{action:"update",source:this,entry:d,callback:this._handleSave}])}this._editMode=!1;this.setEntry(d,this._feed,!0)},_handleSave:function(a){this._editMode=!1;this.clear();this.setEntry(a,this.getFeed(),!0)},cancelEdits:function(){this._new=!1;dojo.style(this.entrySaveCancelButtons,"display","none");this._editable&&dojo.style(this.entryEditButton,
"display","");dojo.style(this.entryNewButton,"display","");this._editMode=!1;this.clearEditors();this.setEntry(this.getEntry(),this.getFeed(),!0)},clear:function(){this._editable=!1;this.clearEditors();dojox.atom.widget.FeedEntryEditor.superclass.clear.apply(this);if(this._contentEditor)this._contentEditor=this._setObject=this._oldContent=this._contentEditorCreator=null,this._editors={}},clearEditors:function(){for(var a in this._editors)this._editors[a].declaredClass==="dijit.Editor"&&this._editors[a].close(!1,
!0),this._editors[a].destroy();this._editors={}},_enforceXhtml:function(a){var b=null;a&&(b=a.replace(/<br>/g,"<br/>"),b=this._closeTag(b,"hr"),b=this._closeTag(b,"img"));return b},_closeTag:function(a,b){var c="<"+b,d=a.indexOf(c);if(d!==-1)for(;d!==-1;){for(var e="",f=!1,g=0;g<a.length;g++){var h=a.charAt(g);if(!(g<=d||f)&&h===">")e+="/",f=!0;e+=h}a=e;d=a.indexOf(c,d+1)}return a},_toggleNew:function(){dojo.style(this.entryNewButton,"display","none");dojo.style(this.entryEditButton,"display","none");
dojo.style(this.entrySaveCancelButtons,"display","");this.entrySummarySelect.value="text";this.entryContentSelect.value="text";this.entryTitleSelect.value="text";this.clearNodes();this._new=!0;var a=dojo.i18n.getLocalization("dojox.atom.widget","FeedEntryViewer");this.entryTitleHeader.appendChild((new dojox.atom.widget.EntryHeader({title:a.title})).domNode);this._editors.title=this._createEditor(this.entryTitleNode,null);this.setFieldValidity("title",!0);this.entryAuthorHeader.appendChild((new dojox.atom.widget.EntryHeader({title:a.authors})).domNode);
this._editors.authors=this._createPeopleEditor(this.entryAuthorNode,{name:"Author"});this.setFieldValidity("authors",!0);this.entryContributorHeader.appendChild((new dojox.atom.widget.EntryHeader({title:a.contributors})).domNode);this._editors.contributors=this._createPeopleEditor(this.entryContributorNode,{name:"Contributor"});this.setFieldValidity("contributors",!0);this.entryIdHeader.appendChild((new dojox.atom.widget.EntryHeader({title:a.id})).domNode);this._editors.id=this._createEditor(this.entryIdNode,
null);this.setFieldValidity("id",!0);this.entryUpdatedHeader.appendChild((new dojox.atom.widget.EntryHeader({title:a.updated})).domNode);this._editors.updated=this._createEditor(this.entryUpdatedNode,null);this.setFieldValidity("updated",!0);this.entrySummaryHeader.appendChild((new dojox.atom.widget.EntryHeader({title:a.summary})).domNode);this._editors.summary=this._createEditor(this.entrySummaryNode,null,!0);this.setFieldValidity("summaryedit",!0);this.setFieldValidity("summary",!0);this.entryContentHeader.appendChild((new dojox.atom.widget.EntryHeader({title:a.content})).domNode);
this._editors.content=this._createEditor(this.entryContentNode,null,!0);this.setFieldValidity("contentedit",!0);this.setFieldValidity("content",!0);this._displaySections()},_displaySections:function(){dojo.style(this.entrySummarySelect,"display","none");dojo.style(this.entryContentSelect,"display","none");dojo.style(this.entryTitleSelect,"display","none");this.isFieldValid("contentedit")&&dojo.style(this.entryContentSelect,"display","");this.isFieldValid("summaryedit")&&dojo.style(this.entrySummarySelect,
"display","");this.isFieldValid("titleedit")&&dojo.style(this.entryTitleSelect,"display","");dojox.atom.widget.FeedEntryEditor.superclass._displaySections.apply(this);if(this._toLoad){for(var a in this._toLoad){var b;b=this._toLoad[a].generateEditor?dojo.hitch(this._toLoad[a],this._toLoad[a].generateEditor)():this._toLoad[a];this._editors[this._toLoad[a].name]=b;this._toLoad[a]=null}this._toLoad=null}}}),dojo.declare("dojox.atom.widget.PeopleEditor",[dijit._Widget,dijit._Templated,dijit._Container],
{templateString:dojo.cache("dojox.atom","widget/templates/PeopleEditor.html",'<div class="peopleEditor">\n\t<table style="width: 100%">\n\t\t<tbody dojoAttachPoint="peopleEditorEditors"></tbody>\n\t</table>\n\t<span class="peopleEditorButton" dojoAttachPoint="peopleEditorButton" dojoAttachEvent="onclick:_add"></span>\n</div>\n'),_rows:[],_editors:[],_index:0,_numRows:0,postCreate:function(){var a=dojo.i18n.getLocalization("dojox.atom.widget","PeopleEditor");this.name?this.name=="Author"?this.peopleEditorButton.appendChild(document.createTextNode("["+
a.addAuthor+"]")):this.name=="Contributor"&&this.peopleEditorButton.appendChild(document.createTextNode("["+a.addContributor+"]")):this.peopleEditorButton.appendChild(document.createTextNode("["+a.add+"]"));this._editors=[];if(!this.data||this.data.length===0)this._createEditors(null,null,null,0,this.name),this._index=1;else for(var b in this.data)this._createEditors(this.data[b].name,this.data[b].email,this.data[b].uri,b),this._index++,this._numRows++},destroy:function(){for(var a in this._editors)for(var b in this._editors[a])this._editors[a][b].destroy();
this._editors=[]},_createEditors:function(a,b,c,d,e){var f=document.createElement("tr");this.peopleEditorEditors.appendChild(f);f.id="removeRow"+d;var g=document.createElement("td");g.setAttribute("align","right");f.appendChild(g);g.colSpan=2;if(this._numRows>0)f=document.createElement("hr"),g.appendChild(f),f.id="hr"+d;f=document.createElement("span");g.appendChild(f);f.className="peopleEditorButton";dojo.style(f,"font-size","x-small");dojo.connect(f,"onclick",this,"_removeEditor");f.id="remove"+
d;g=document.createTextNode("[X]");f.appendChild(g);f=document.createElement("tr");this.peopleEditorEditors.appendChild(f);f.id="editorsRow"+d;var h=document.createElement("td");f.appendChild(h);dojo.style(h,"width","20%");g=document.createElement("td");f.appendChild(g);f=document.createElement("table");h.appendChild(f);dojo.style(f,"width","100%");h=document.createElement("tbody");f.appendChild(h);f=document.createElement("table");g.appendChild(f);dojo.style(f,"width","100%");g=document.createElement("tbody");
f.appendChild(g);this._editors[d]=[];this._editors[d].push(this._createEditor(a,e+"name"+d,"Name:",h,g));this._editors[d].push(this._createEditor(b,e+"email"+d,"Email:",h,g));this._editors[d].push(this._createEditor(c,e+"uri"+d,"URI:",h,g))},_createEditor:function(a,b,c,d,e){var f=document.createElement("tr");d.appendChild(f);var g=document.createElement("label");g.setAttribute("for",b);g.appendChild(document.createTextNode(c));d=document.createElement("td");d.appendChild(g);f.appendChild(d);f=document.createElement("tr");
e.appendChild(f);e=document.createElement("td");f.appendChild(e);c=document.createElement("input");c.setAttribute("id",b);e.appendChild(c);dojo.style(c,"width","95%");b=new dijit.form.TextBox({},c);b.attr("value",a);return b},_removeEditor:function(a){var b=null,b=dojo.isIE?a.srcElement:a.target,a=b.id,a=a.substring(6),c;for(c in this._editors[a])this._editors[a][c].destroy();c=dojo.byId("editorsRow"+a);b=c.parentNode;b.removeChild(c);c=dojo.byId("removeRow"+a);b=c.parentNode;b.removeChild(c);this._numRows--;
if(this._numRows===1&&b.firstChild.firstChild.firstChild.tagName.toLowerCase()==="hr")c=b.firstChild.firstChild,c.removeChild(c.firstChild);this._editors[a]=null},_add:function(){this._createEditors(null,null,null,this._index);this._index++;this._numRows++},getValues:function(){var a=[],b;for(b in this._editors)this._editors[b]&&a.push({name:this._editors[b][0].attr("value"),email:this._editors[b][1].attr("value"),uri:this._editors[b][2].attr("value")});return a}}));