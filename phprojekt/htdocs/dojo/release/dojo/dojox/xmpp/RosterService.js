/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojox.xmpp.RosterService"])dojo._hasResource["dojox.xmpp.RosterService"]=!0,dojo.provide("dojox.xmpp.RosterService"),dojox.xmpp.roster={ADDED:101,CHANGED:102,REMOVED:103},dojo.declare("dojox.xmpp.RosterService",null,{constructor:function(a){this.session=a},addRosterItem:function(a,e,c){if(!a)throw Error("Roster::addRosterItem() - User ID is null");var b={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},d=new dojox.string.Builder(dojox.xmpp.util.createElement("iq",
b,!1));d.append(dojox.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1));a=dojox.xmpp.util.encodeJid(a);a.indexOf("@")==-1&&(a=a+"@"+this.session.domain);d.append(dojox.xmpp.util.createElement("item",{jid:a,name:dojox.xmpp.util.xmlEncode(e)},!1));if(c)for(a=0;a<c.length;a++)d.append("<group>"),d.append(c[a]),d.append("</group>");d.append("</item></query></iq>");c=this.session.dispatchPacket(d.toString(),"iq",b.id);c.addCallback(this,"verifyRoster");return c},updateRosterItem:function(a,
e,c){a.indexOf("@")==-1&&(a+=a+"@"+this.session.domain);var b={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},d=new dojox.string.Builder(dojox.xmpp.util.createElement("iq",b,!1));d.append(dojox.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1));var f=this.session.getRosterIndex(a);if(f!=-1){a={jid:a};if(e)a.name=e;else if(this.session.roster[f].name)a.name=this.session.roster[f].name;if(a.name)a.name=dojox.xmpp.util.xmlEncode(a.name);d.append(dojox.xmpp.util.createElement("item",
a,!1));if(e=c?c:this.session.roster[f].groups)for(c=0;c<e.length;c++)d.append("<group>"),d.append(e[c]),d.append("</group>");d.append("</item></query></iq>");b=this.session.dispatchPacket(d.toString(),"iq",b.id);b.addCallback(this,"verifyRoster");return b}},verifyRoster:function(a){if(a.getAttribute("type")!="result")this.onAddRosterItemFailed(this.session.processXmppError(a));return a},addRosterItemToGroup:function(a,e){if(!a)throw Error("Roster::addRosterItemToGroup() JID is null or undefined");
if(!e)throw Error("Roster::addRosterItemToGroup() group is null or undefined");var c=this.session.getRosterIndex(a);if(c!=-1){for(var b=this.session.roster[c],d=!1,f=0;b<b.groups.length&&!d;f++)b.groups[f]==e&&(d=!0);return!d?this.updateRosterItem(a,b.name,b.groups.concat(e),c):dojox.xmpp.xmpp.INVALID_ID}},removeRosterGroup:function(a){for(var e=this.session.roster,c=0;c<e.length;c++){var b=e[c];if(b.groups.length>0)for(var d=0;d<b.groups.length;d++)b.groups[d]==a&&(b.groups.splice(d,1),this.updateRosterItem(b.jid,
b.name,b.groups))}},renameRosterGroup:function(a,e){for(var c=this.session.roster,b=0;b<c.length;b++){var d=c[b];if(d.groups.length>0)for(var f=0;f<d.groups.length;f++)d.groups[f]==a&&(d.groups[f]=e,this.updateRosterItem(d.jid,d.name,d.groups))}},removeRosterItemFromGroup:function(a,e){if(!a)throw Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!e)throw Error("Roster::addRosterItemToGroup() group is null or undefined");var c=this.session.getRosterIndex(a);if(c!=-1){for(var b=this.session.roster[c],
d=!1,f=0;f<b.groups.length&&!d;f++)b.groups[f]==e&&(d=!0,c=f);return d==!0?(b.groups.splice(c,1),this.updateRosterItem(a,b.name,b.groups)):dojox.xmpp.xmpp.INVALID_ID}},rosterItemRenameGroup:function(a,e,c){if(!a)throw Error("Roster::rosterItemRenameGroup() JID is null or undefined");if(!c)throw Error("Roster::rosterItemRenameGroup() group is null or undefined");var b=this.session.getRosterIndex(a);if(b!=-1){for(var b=this.session.roster[b],d=!1,f=0;f<b.groups.length&&!d;f++)b.groups[f]==e&&(b.groups[f]=
c,d=!0);return d==!0?this.updateRosterItem(a,b.name,b.groups):dojox.xmpp.xmpp.INVALID_ID}},renameRosterItem:function(a,e){if(!a)throw Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!e)throw Error("Roster::addRosterItemToGroup() New Name is null or undefined");var c=this.session.getRosterIndex(a);return c==-1?void 0:this.updateRosterItem(a,e,this.session.roster.groups,c)},removeRosterItem:function(a){if(!a)throw Error("Roster::addRosterItemToGroup() JID is null or undefined");
var e={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},c=new dojox.string.Builder(dojox.xmpp.util.createElement("iq",e,!1));c.append(dojox.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1));a.indexOf("@")==-1&&(a+=a+"@"+this.session.domain);c.append(dojox.xmpp.util.createElement("item",{jid:a,subscription:"remove"},!0));c.append("</query></iq>");a=this.session.dispatchPacket(c.toString(),"iq",e.id);a.addCallback(this,"verifyRoster");return a},
getAvatar:function(){},publishAvatar:function(){},onVerifyRoster:function(){},onVerifyRosterFailed:function(){}});