/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dijit._PaletteMixin"]||(dojo._hasResource["dijit._PaletteMixin"]=!0,dojo.provide("dijit._PaletteMixin"),dojo.require("dijit._CssStateMixin"),dojo.declare("dijit._PaletteMixin",[dijit._CssStateMixin],{defaultTimeout:500,timeoutChangeRate:0.9,value:null,_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:"",_preparePalette:function(a,c,b){this._cells=[];for(var j=this._blankGif,b=b||dojo.getObject(this.dyeClass),e=0;e<a.length;e++)for(var k=dojo.create("tr",{tabIndex:"-1"},
this.gridNode),f=0;f<a[e].length;f++){var d=a[e][f];if(d){var h=new b(d,e,f),d=dojo.create("td",{"class":this.cellClass,tabIndex:"-1",title:c[d]});h.fillCell(d,j);this.connect(d,"ondijitclick","_onCellClick");this._trackMouseState(d,this.cellClass);dojo.place(d,k);d.index=this._cells.length;this._cells.push({node:d,dye:h})}}this._xDim=a[0].length;this._yDim=a.length;var i={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},g;for(g in i)this._connects.push(dijit.typematic.addKeyListener(this.domNode,
{charOrCode:dojo.keys[g],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=i[g];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){dijit.focus(this._currentFocus)},_onCellClick:function(a){var c=a.currentTarget,b=this._getDye(c).getValue();this._setCurrent(c);setTimeout(dojo.hitch(this,function(){dijit.focus(c);this._setValueAttr(b,!0)}));dojo.removeClass(c,
"dijitPaletteCellHover");dojo.stopEvent(a)},_setCurrent:function(a){"_currentFocus"in this&&dojo.attr(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&dojo.attr(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,c){this._selectedCell>=0&&dojo.removeClass(this._cells[this._selectedCell].node,"dijitPaletteCellSelected");this._selectedCell=-1;if(a)for(var b=0;b<this._cells.length;b++)if(a==this._cells[b].dye.getValue()){this._selectedCell=b;dojo.addClass(this._cells[b].node,"dijitPaletteCellSelected");
break}this._set("value",this._selectedCell>=0?a:null);if(c||c===void 0)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,c){if(c!=-1){var b=this._currentFocus.index+a;if(b<this._cells.length&&b>-1)b=this._cells[b].node,this._setCurrent(b),setTimeout(dojo.hitch(dijit,"focus",b),0)}},_getDye:function(a){return this._cells[a.index].dye}}));