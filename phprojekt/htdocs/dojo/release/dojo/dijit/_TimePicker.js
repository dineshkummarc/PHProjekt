/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dijit._TimePicker"]||(dojo._hasResource["dijit._TimePicker"]=!0,dojo.provide("dijit._TimePicker"),dojo.require("dijit.form._FormWidget"),dojo.require("dojo.date.locale"),dojo.declare("dijit._TimePicker",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("dijit","templates/TimePicker.html",'<div id="widget_${id}" class="dijitMenu"\n    ><div dojoAttachPoint="upArrow" class="dijitButtonNode dijitUpArrowButton" dojoAttachEvent="onmouseenter:_buttonMouse,onmouseleave:_buttonMouse"\n\t\t><div class="dijitReset dijitInline dijitArrowButtonInner" role="presentation">&nbsp;</div\n\t\t><div class="dijitArrowButtonChar">&#9650;</div></div\n    ><div dojoAttachPoint="timeMenu,focusNode" dojoAttachEvent="onclick:_onOptionSelected,onmouseover,onmouseout"></div\n    ><div dojoAttachPoint="downArrow" class="dijitButtonNode dijitDownArrowButton" dojoAttachEvent="onmouseenter:_buttonMouse,onmouseleave:_buttonMouse"\n\t\t><div class="dijitReset dijitInline dijitArrowButtonInner" role="presentation">&nbsp;</div\n\t\t><div class="dijitArrowButtonChar">&#9660;</div></div\n></div>\n'),
baseClass:"dijitTimePicker",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",visibleRange:"T05:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:dojo.date.stamp.toISOString,setValue:function(a){dojo.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",a)},_setValueAttr:function(a){this._set("value",a);this._showText()},_setFilterStringAttr:function(a){this._set("filterString",
a);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(a,c,d,b){var f=[],b=b?b.date:this._refDate,e=a,h=this._maxIncrement+Math.abs(e),i=d?-1:1,g=d?1:0,j=1-g;do{e-=g;if(a=this._createOption(e)){if(d&&a.date>b||!d&&a.date<b)break;f[d?"unshift":"push"](a);b=a.date}e+=j}while(f.length<c&&e*i<h);return f},_showText:function(){var a=dojo.date.stamp.fromISOString;this.timeMenu.innerHTML="";this._clickableIncrementDate=a(this.clickableIncrement);this._visibleIncrementDate=a(this.visibleIncrement);
this._visibleRangeDate=a(this.visibleRange);var c=function(a){return a.getHours()*3600+a.getMinutes()*60+a.getSeconds()},a=c(this._clickableIncrementDate),d=c(this._visibleIncrementDate),c=c(this._visibleRangeDate),b=(this.value||this.currentFocus).getTime();this._refDate=new Date(b-b%(d*1E3));this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._totalIncrements=c/a;this._visibleIncrement=d/a;this._maxIncrement=86400/a;a=this._getFilteredNodes(0,Math.min(this._totalIncrements>>1,10)-
1);d=this._getFilteredNodes(0,Math.min(this._totalIncrements,10)-a.length,!0,a[0]);dojo.forEach(d.concat(a),function(a){this.timeMenu.appendChild(a)},this)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(a){dojo.mixin(this,a);if(!a.locale)a.locale=this.lang},postCreate:function(){this.connect(this.timeMenu,dojo.isIE?"onmousewheel":"DOMMouseScroll","_mouseWheeled");this._connects.push(dijit.typematic.addMouseListener(this.upArrow,
this,"_onArrowUp",33,250));this._connects.push(dijit.typematic.addMouseListener(this.downArrow,this,"_onArrowDown",33,250));this.inherited(arguments)},_buttonMouse:function(a){dojo.toggleClass(a.currentTarget,a.currentTarget==this.upArrow?"dijitUpArrowHover":"dijitDownArrowHover",a.type=="mouseenter"||a.type=="mouseover")},_createOption:function(a){var c=new Date(this._refDate),d=this._clickableIncrementDate;c.setHours(c.getHours()+d.getHours()*a,c.getMinutes()+d.getMinutes()*a,c.getSeconds()+d.getSeconds()*
a);this.constraints.selector=="time"&&c.setFullYear(1970,0,1);d=dojo.date.locale.format(c,this.constraints);if(this.filterString&&d.toLowerCase().indexOf(this.filterString)!==0)return null;var b=dojo.create("div",{"class":this.baseClass+"Item"});b.date=c;b.index=a;dojo.create("div",{"class":this.baseClass+"ItemInner",innerHTML:d},b);a%this._visibleIncrement<1&&a%this._visibleIncrement>-1?dojo.addClass(b,this.baseClass+"Marker"):a%this._clickableIncrement||dojo.addClass(b,this.baseClass+"Tick");this.isDisabledDate(c)&&
dojo.addClass(b,this.baseClass+"ItemDisabled");if(this.value&&!dojo.date.compare(this.value,c,this.constraints.selector))b.selected=!0,dojo.addClass(b,this.baseClass+"ItemSelected"),dojo.hasClass(b,this.baseClass+"Marker")?dojo.addClass(b,this.baseClass+"MarkerSelected"):dojo.addClass(b,this.baseClass+"TickSelected"),this._highlightOption(b,!0);return b},_onOptionSelected:function(a){if((a=a.target.date||a.target.parentNode.date)&&!this.isDisabledDate(a))this._highlighted_option=null,this.set("value",
a),this.onChange(a)},onChange:function(){},_highlightOption:function(a,c){if(a){if(c)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=a;else if(this._highlighted_option!==a)return;else this._highlighted_option=null;dojo.toggleClass(a,this.baseClass+"ItemHover",c);dojo.hasClass(a,this.baseClass+"Marker")?dojo.toggleClass(a,this.baseClass+"MarkerHover",c):dojo.toggleClass(a,this.baseClass+"TickHover",c)}},onmouseover:function(a){this._keyboardSelected=
null;a=a.target.parentNode===this.timeMenu?a.target:a.target.parentNode;dojo.hasClass(a,this.baseClass+"Item")&&this._highlightOption(a,!0)},onmouseout:function(a){this._keyboardSelected=null;this._highlightOption(a.target.parentNode===this.timeMenu?a.target:a.target.parentNode,!1)},_mouseWheeled:function(a){this._keyboardSelected=null;dojo.stopEvent(a);this[(dojo.isIE?a.wheelDelta:-a.detail)>0?"_onArrowUp":"_onArrowDown"]()},_onArrowUp:function(a){!(typeof a=="number"&&a==-1)&&this.timeMenu.childNodes.length&&
(a=this._getFilteredNodes(this.timeMenu.childNodes[0].index,1,!0,this.timeMenu.childNodes[0]),a.length&&(this.timeMenu.removeChild(this.timeMenu.childNodes[this.timeMenu.childNodes.length-1]),this.timeMenu.insertBefore(a[0],this.timeMenu.childNodes[0])))},_onArrowDown:function(a){!(typeof a=="number"&&a==-1)&&this.timeMenu.childNodes.length&&(a=this._getFilteredNodes(this.timeMenu.childNodes[this.timeMenu.childNodes.length-1].index+1,1,!1,this.timeMenu.childNodes[this.timeMenu.childNodes.length-1]),
a.length&&(this.timeMenu.removeChild(this.timeMenu.childNodes[0]),this.timeMenu.appendChild(a[0])))},handleKey:function(a){var c=dojo.keys;if(a.charOrCode==c.DOWN_ARROW||a.charOrCode==c.UP_ARROW){dojo.stopEvent(a);if(this._highlighted_option&&!this._highlighted_option.parentNode)this._highlighted_option=null;var d=this.timeMenu,b=this._highlighted_option||dojo.query("."+this.baseClass+"ItemSelected",d)[0];b?d.childNodes.length&&(a.charOrCode==c.DOWN_ARROW&&!b.nextSibling?this._onArrowDown():a.charOrCode==
c.UP_ARROW&&!b.previousSibling&&this._onArrowUp(),b=a.charOrCode==c.DOWN_ARROW?b.nextSibling:b.previousSibling):b=d.childNodes[0];this._highlightOption(b,!0);this._keyboardSelected=b;return!1}else if(a.charOrCode==c.ENTER||a.charOrCode===c.TAB){if(!this._keyboardSelected&&a.charOrCode===c.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option});return a.charOrCode===c.TAB}}}));