/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dijit._editor.plugins.FontChoice"]||(dojo._hasResource["dijit._editor.plugins.FontChoice"]=!0,dojo.provide("dijit._editor.plugins.FontChoice"),dojo.require("dijit._editor._Plugin"),dojo.require("dijit._editor.range"),dojo.require("dijit._editor.selection"),dojo.require("dijit.form.FilteringSelect"),dojo.require("dojo.data.ItemFileReadStore"),dojo.require("dojo.i18n"),dojo.requireLocalization("dijit._editor","FontChoice",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"),
dojo.declare("dijit._editor.plugins._FontDropDown",[dijit._Widget,dijit._Templated],{label:"",widgetsInTemplate:!0,plainText:!1,templateString:"<span style='white-space: nowrap' class='dijit dijitReset dijitInline'><label class='dijitLeft dijitInline' for='${selectId}'>${label}</label><input dojoType='dijit.form.FilteringSelect' required='false' labelType='html' labelAttr='label' searchAttr='name' tabIndex='-1' id='${selectId}' dojoAttachPoint='select' value=''/></span>",postMixInProperties:function(){this.inherited(arguments);
this.strings=dojo.i18n.getLocalization("dijit._editor","FontChoice");this.label=this.strings[this.command];this.id=dijit.getUniqueId(this.declaredClass.replace(/\./g,"_"));this.selectId=this.id+"_select";this.inherited(arguments)},postCreate:function(){var b=dojo.map(this.values,function(b){var d=this.strings[b]||b;return{label:this.getLabel(b,d),name:d,value:b}},this);this.select.store=new dojo.data.ItemFileReadStore({data:{identifier:"value",items:b}});this.select.set("value","",!1);this.disabled=
this.select.get("disabled")},_setValueAttr:function(b,a){a=a!==!1?!0:!1;this.select.set("value",dojo.indexOf(this.values,b)<0?"":b,a);if(!a)this.select._lastValueReported=null},_getValueAttr:function(){return this.select.get("value")},focus:function(){this.select.focus()},_setDisabledAttr:function(b){this.disabled=b;this.select.set("disabled",b)}}),dojo.declare("dijit._editor.plugins._FontNameDropDown",dijit._editor.plugins._FontDropDown,{generic:!1,command:"fontName",postMixInProperties:function(){if(!this.values)this.values=
this.generic?["serif","sans-serif","monospace","cursive","fantasy"]:["Arial","Times New Roman","Comic Sans MS","Courier New"];this.inherited(arguments)},getLabel:function(b,a){return this.plainText?a:"<div style='font-family: "+b+"'>"+a+"</div>"},_setValueAttr:function(b,a){this.generic&&(b={Arial:"sans-serif",Helvetica:"sans-serif",Myriad:"sans-serif",Times:"serif","Times New Roman":"serif","Comic Sans MS":"cursive","Apple Chancery":"cursive",Courier:"monospace","Courier New":"monospace",Papyrus:"fantasy"}[b]||
b);this.inherited(arguments,[b,a!==!1?!0:!1])}}),dojo.declare("dijit._editor.plugins._FontSizeDropDown",dijit._editor.plugins._FontDropDown,{command:"fontSize",values:[1,2,3,4,5,6,7],getLabel:function(b,a){return this.plainText?a:"<font size="+b+"'>"+a+"</font>"},_setValueAttr:function(b,a){a=a!==!1?!0:!1;b.indexOf&&b.indexOf("px")!=-1&&(b={10:1,13:2,16:3,18:4,24:5,32:6,48:7}[parseInt(b,10)]||b);this.inherited(arguments,[b,a])}}),dojo.declare("dijit._editor.plugins._FormatBlockDropDown",dijit._editor.plugins._FontDropDown,
{command:"formatBlock",values:["noFormat","p","h1","h2","h3","pre"],postCreate:function(){this.inherited(arguments);this.set("value","noFormat",!1)},getLabel:function(b,a){return this.plainText||b=="noFormat"?a:"<"+b+">"+a+"</"+b+">"},_execCommand:function(b,a,d){if(d==="noFormat"){var c;if((a=dijit.range.getSelection(b.window))&&a.rangeCount>0){var d=a.getRangeAt(0),g;if(d){a=d.startContainer;for(c=d.endContainer;a&&a!==b.editNode&&a!==b.document.body&&a.nodeType!==1;)a=a.parentNode;for(;c&&c!==
b.editNode&&c!==b.document.body&&c.nodeType!==1;)c=c.parentNode;var f=dojo.hitch(this,function(a,c){if(a.childNodes&&a.childNodes.length){var d;for(d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];if(e.nodeType==1&&dojo.withGlobal(b.window,"inSelection",dijit._editor.selection,[e])){var g=e.tagName?e.tagName.toLowerCase():"";dojo.indexOf(this.values,g)!==-1&&c.push(e);f(e,c)}}}}),d=dojo.hitch(this,function(a){if(a&&a.length){for(b.beginEditing();a.length;)this._removeFormat(b,a.pop());b.endEditing()}}),
e=[];if(a==c){var h;for(c=a;c&&c!==b.editNode&&c!==b.document.body;){if(c.nodeType==1&&(g=c.tagName?c.tagName.toLowerCase():"",dojo.indexOf(this.values,g)!==-1)){h=c;break}c=c.parentNode}f(a,e);h&&(e=[h].concat(e))}else for(c=a;dojo.withGlobal(b.window,"inSelection",dijit._editor.selection,[c]);)c.nodeType==1&&(g=c.tagName?c.tagName.toLowerCase():"",dojo.indexOf(this.values,g)!==-1&&e.push(c),f(c,e)),c=c.nextSibling;d(e);b.onDisplayChanged()}}}else b.execCommand(a,d)},_removeFormat:function(b,a){if(b.customUndo){for(;a.firstChild;)dojo.place(a.firstChild,
a,"before");a.parentNode.removeChild(a)}else{dojo.withGlobal(b.window,"selectElementChildren",dijit._editor.selection,[a]);var d=dojo.withGlobal(b.window,"getSelectedHtml",dijit._editor.selection,[null]);dojo.withGlobal(b.window,"selectElement",dijit._editor.selection,[a]);b.execCommand("inserthtml",d||"")}}}),dojo.declare("dijit._editor.plugins.FontChoice",dijit._editor._Plugin,{useDefaultCommand:!1,_initButton:function(){var b={fontName:dijit._editor.plugins._FontNameDropDown,fontSize:dijit._editor.plugins._FontSizeDropDown,
formatBlock:dijit._editor.plugins._FormatBlockDropDown}[this.command],a=this.params;if(this.params.custom)a.values=this.params.custom;var d=this.editor;this.button=new b(dojo.delegate({dir:d.dir,lang:d.lang},a));this.connect(this.button.select,"onChange",function(a){this.editor.focus();this.command=="fontName"&&a.indexOf(" ")!=-1&&(a="'"+a+"'");this.button._execCommand?this.button._execCommand(this.editor,this.command,a):this.editor.execCommand(this.command,a)})},updateState:function(){var b=this.editor,
a=this.command;if(b&&b.isLoaded&&a.length&&this.button){var d=this.get("disabled");this.button.set("disabled",d);if(!d){var c;try{c=b.queryCommandValue(a)||""}catch(g){c=""}(d=dojo.isString(c)&&c.match(/'([^']*)'/))&&(c=d[1]);if(a==="formatBlock")if(!c||c=="p"){c=null;var f;if((a=dijit.range.getSelection(this.editor.window))&&a.rangeCount>0)if(a=a.getRangeAt(0))f=a.endContainer;for(;f&&f!==b.editNode&&f!==b.document;){if((a=f.tagName?f.tagName.toLowerCase():"")&&dojo.indexOf(this.button.values,a)>
-1){c=a;break}f=f.parentNode}c||(c="noFormat")}else dojo.indexOf(this.button.values,c)<0&&(c="noFormat");c!==this.button.get("value")&&this.button.set("value",c,!1)}}}}),dojo.subscribe(dijit._scopeName+".Editor.getPlugin",null,function(b){if(!b.plugin)switch(b.args.name){case "fontName":case "fontSize":case "formatBlock":b.plugin=new dijit._editor.plugins.FontChoice({command:b.args.name,plainText:b.args.plainText?b.args.plainText:!1})}}));