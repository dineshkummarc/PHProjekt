/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dijit.form.FilteringSelect"]||(dojo._hasResource["dijit.form.FilteringSelect"]=!0,dojo.provide("dijit.form.FilteringSelect"),dojo.require("dijit.form.ComboBox"),dojo.declare("dijit.form.FilteringSelect",[dijit.form.MappedTextBox,dijit.form.ComboBoxMixin],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return this.item||!this.required&&this.get("displayedValue")==""},_refreshState:function(){this.searchTimer||this.inherited(arguments)},
_callbackSetLabel:function(a,c,b){if(!(c&&c.query[this.searchAttr]!=this._lastQuery||!c&&a.length&&this.store.getIdentity(a[0])!=this._lastQuery))a.length?this.set("item",a[0],b):(this.valueNode.value="",dijit.form.TextBox.superclass._setValueAttr.call(this,"",b||b===void 0&&!this._focused),this._set("item",null),this.validate(this._focused))},_openResultList:function(a,c){c.query[this.searchAttr]==this._lastQuery&&(dijit.form.ComboBoxMixin.prototype._openResultList.apply(this,arguments),this.item===
void 0&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(a,c){this._onChangeActive||(c=null);this._lastQuery=a;if(a===null||a==="")this._setDisplayedValueAttr("",c);else{var b=this;this.store.fetchItemByIdentity({identity:a,onItem:function(a){b._callbackSetLabel(a?[a]:[],void 0,c)}})}},_setItemAttr:function(a,c,b){this.inherited(arguments);this.valueNode.value=this.value;this._lastDisplayedValue=this.textbox.value},
_getDisplayQueryString:function(a){return a.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(a,c){a==null&&(a="");if(!this._created){if(!("displayedValue"in this.params))return;c=!1}if(this.store){this.closeDropDown();var b=dojo.clone(this.query);this._lastQuery=b[this.searchAttr]=this._getDisplayQueryString(a);this._lastDisplayedValue=this.textbox.value=a;this._set("displayedValue",a);var d=this,b={query:b,queryOptions:{ignoreCase:this.ignoreCase,deep:!0},onComplete:function(a,b){d._fetchHandle=
null;dojo.hitch(d,"_callbackSetLabel")(a,b,c)},onError:function(a){d._fetchHandle=null;console.error("dijit.form.FilteringSelect: "+a);dojo.hitch(d,"_callbackSetLabel")([],void 0,!1)}};dojo.mixin(b,this.fetchProperties);this._fetchHandle=this.store.fetch(b)}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}}));