/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dijit.form._FormSelectWidget"]||(dojo._hasResource["dijit.form._FormSelectWidget"]=!0,dojo.provide("dijit.form._FormSelectWidget"),dojo.require("dijit.form._FormWidget"),dojo.require("dojo.data.util.sorter"),dojo.declare("dijit.form._FormSelectWidget",dijit.form._FormValueWidget,{multiple:!1,options:null,store:null,query:null,queryOptions:null,onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,getOptions:function(a){var b=a,c=this.options||[],d=c.length;if(b===void 0)return c;if(dojo.isArray(b))return dojo.map(b,
"return this.getOptions(item);",this);dojo.isObject(a)&&(dojo.some(this.options,function(a,c){return a===b||a.value&&a.value===b.value?(b=c,!0):!1})||(b=-1));if(typeof b=="string")for(a=0;a<d;a++)if(c[a].value===b){b=a;break}return typeof b=="number"&&b>=0&&b<d?this.options[b]:null},addOption:function(a){dojo.isArray(a)||(a=[a]);dojo.forEach(a,function(a){a&&dojo.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){dojo.isArray(a)||(a=[a]);a=this.getOptions(a);dojo.forEach(a,
function(a){if(a)this.options=dojo.filter(this.options,function(c){return c.value!==a.value||c.label!==a.label}),this._removeOptionItem(a)},this);this._loadChildren()},updateOption:function(a){dojo.isArray(a)||(a=[a]);dojo.forEach(a,function(a){var c=this.getOptions(a),d;if(c)for(d in a)c[d]=a[d]},this);this._loadChildren()},setStore:function(a,b,c){var d=this.store,c=c||{};if(d!==a){dojo.forEach(this._notifyConnections||[],dojo.disconnect);delete this._notifyConnections;if(a&&a.getFeatures()["dojo.data.api.Notification"])this._notifyConnections=
[dojo.connect(a,"onNew",this,"_onNewItem"),dojo.connect(a,"onDelete",this,"_onDeleteItem"),dojo.connect(a,"onSet",this,"_onSetItem")];this._set("store",a)}this._onChangeActive=!1;this.options&&this.options.length&&this.removeOption(this.options);a?(this._loadingStore=!0,a.fetch(dojo.delegate(c,{onComplete:function(d,f){this.sortByLabel&&!c.sort&&d.length&&d.sort(dojo.data.util.sorter.createSortFunction([{attribute:a.getLabelAttributes(d[0])[0]}],a));c.onFetch&&(d=c.onFetch.call(this,d,f));dojo.forEach(d,
function(a){this._addOptionForItem(a)},this);this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(d):this._loadChildren();this._fetchedWith=f;this._lastValueReported=this.multiple?[]:null;this._onChangeActive=!0;this.onSetStore();this._handleOnChange(this.value)},scope:this}))):delete this._fetchedWith;return d},_setValueAttr:function(a,b){if(this._loadingStore)this._pendingValue=a;else{var c=
this.getOptions()||[];dojo.isArray(a)||(a=[a]);dojo.forEach(a,function(b,d){dojo.isObject(b)||(b+="");typeof b==="string"&&(a[d]=dojo.filter(c,function(a){return a.value===b})[0]||{value:"",label:""})},this);a=dojo.filter(a,function(a){return a&&a.value});if(!this.multiple&&(!a[0]||!a[0].value)&&c.length)a[0]=c[0];dojo.forEach(c,function(b){b.selected=dojo.some(a,function(a){return a.value===b.value})});var d=dojo.map(a,function(a){return a.value}),e=dojo.map(a,function(a){return a.label});this._set("value",
this.multiple?d:d[0]);this._setDisplay(this.multiple?e:e[0]);this._updateSelection();this._handleOnChange(this.value,b)}},_getDisplayedValueAttr:function(){var a=this.get("value");dojo.isArray(a)||(a=[a]);a=dojo.map(this.getOptions(a),function(a){if(a&&"label"in a)return a.label;else if(a)return a.value;return null},this);return this.multiple?a:a[0]},_loadChildren:function(){this._loadingStore||(dojo.forEach(this._getChildren(),function(a){a.destroyRecursive()}),dojo.forEach(this.options,this._addOptionItem,
this),this._updateSelection())},_updateSelection:function(){this._set("value",this._getValueFromOpts());var a=this.value;dojo.isArray(a)||(a=[a]);a&&a[0]&&dojo.forEach(this._getChildren(),function(b){var c=dojo.some(a,function(a){return b.option&&a===b.option.value});dojo.toggleClass(b.domNode,this.baseClass+"SelectedOption",c);dijit.setWaiState(b.domNode,"selected",c)},this)},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=dojo.filter(a,function(a){return a.selected})[0];
return b&&b.value?b.value:(a[0].selected=!0,a[0].value)}else if(this.multiple)return dojo.map(dojo.filter(a,function(a){return a.selected}),function(a){return a.value})||[];return""},_onNewItem:function(a,b){(!b||!b.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption(this.store.getIdentity(a))},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,
item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded(a)?this.addOption(this._getOptionObjForItem(a)):b.loadItem({item:a,onComplete:function(){this._addOptionForItem(a)},scope:this})},constructor:function(a){this._oValue=(a||{}).value||null},buildRendering:function(){this.inherited(arguments);dojo.setSelectable(this.focusNode,!1)},_fillContent:function(){var a=this.options;if(!a)a=this.options=this.srcNodeRef?dojo.query(">",this.srcNodeRef).map(function(a){return a.getAttribute("type")===
"separator"?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+dojo._scopeName+"-value")||a.getAttribute("value"),label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[];this.value?this.multiple&&typeof this.value=="string"&&this_set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);this.connect(this,"onChange","_updateSelection");this.connect(this,
"startup","_loadChildren");this._setValueAttr(this.value,null)},startup:function(){this.inherited(arguments);var a=this.store,b={};dojo.forEach(["query","queryOptions","onFetch"],function(a){this[a]&&(b[a]=this[a]);delete this[a]},this);if(a&&a.getFeatures()["dojo.data.api.Identity"])this.store=null,this.setStore(a,this._oValue,b)},destroy:function(){dojo.forEach(this._notifyConnections||[],dojo.disconnect);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},
_getChildren:function(){return[]},_getSelectedOptionsAttr:function(){return this.getOptions(this.get("value"))},_pseudoLoadChildren:function(){},onSetStore:function(){}}));