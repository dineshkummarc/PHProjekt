/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dijit.layout.StackController"]||(dojo._hasResource["dijit.layout.StackController"]=!0,dojo.provide("dijit.layout.StackController"),dojo.require("dijit._Widget"),dojo.require("dijit._Templated"),dojo.require("dijit._Container"),dojo.require("dijit.form.ToggleButton"),dojo.requireLocalization("dijit","common",null,"ROOT,ar,ca,cs,da,de,el,es,fi,fr,he,hu,it,ja,kk,ko,nb,nl,pl,pt,pt-pt,ro,ru,sk,sl,sv,th,tr,zh,zh-tw"),dojo.declare("dijit.layout.StackController",[dijit._Widget,dijit._Templated,
dijit._Container],{templateString:"<span role='tablist' dojoAttachEvent='onkeypress' class='dijitStackController'></span>",containerId:"",buttonWidget:"dijit.layout._StackButton",constructor:function(){this.pane2button={};this.pane2connects={};this.pane2watches={}},buildRendering:function(){this.inherited(arguments);dijit.setWaiRole(this.domNode,"tablist")},postCreate:function(){this.inherited(arguments);this.subscribe(this.containerId+"-startup","onStartup");this.subscribe(this.containerId+"-addChild",
"onAddChild");this.subscribe(this.containerId+"-removeChild","onRemoveChild");this.subscribe(this.containerId+"-selectChild","onSelectChild");this.subscribe(this.containerId+"-containerKeyPress","onContainerKeyPress")},onStartup:function(a){dojo.forEach(a.children,this.onAddChild,this);if(a.selected)this.onSelectChild(a.selected)},destroy:function(){for(var a in this.pane2button)this.onRemoveChild(dijit.byId(a));this.inherited(arguments)},onAddChild:function(a,b){var c=new (dojo.getObject(this.buttonWidget))({id:this.id+
"_"+a.id,label:a.title,dir:a.dir,lang:a.lang,showLabel:a.showTitle,iconClass:a.iconClass,closeButton:a.closable,title:a.tooltip});dijit.setWaiState(c.focusNode,"selected","false");var d=["label","showLabel","iconClass","closeButton","title"];this.pane2watches[a.id]=dojo.map(["title","showTitle","iconClass","closable","tooltip"],function(b,e){return a.watch(b,function(a,b,f){c.set(d[e],f)})});this.pane2connects[a.id]=[this.connect(c,"onClick",dojo.hitch(this,"onButtonClick",a)),this.connect(c,"onClickCloseButton",
dojo.hitch(this,"onCloseButtonClick",a))];this.addChild(c,b);this.pane2button[a.id]=c;a.controlButton=c;if(!this._currentChild)c.focusNode.setAttribute("tabIndex","0"),dijit.setWaiState(c.focusNode,"selected","true"),this._currentChild=a;!this.isLeftToRight()&&dojo.isIE&&this._rectifyRtlTabList&&this._rectifyRtlTabList()},onRemoveChild:function(a){if(this._currentChild===a)this._currentChild=null;dojo.forEach(this.pane2connects[a.id],dojo.hitch(this,"disconnect"));delete this.pane2connects[a.id];
dojo.forEach(this.pane2watches[a.id],function(a){a.unwatch()});delete this.pane2watches[a.id];var b=this.pane2button[a.id];b&&(this.removeChild(b),delete this.pane2button[a.id],b.destroy());delete a.controlButton},onSelectChild:function(a){if(a){if(this._currentChild){var b=this.pane2button[this._currentChild.id];b.set("checked",!1);dijit.setWaiState(b.focusNode,"selected","false");b.focusNode.setAttribute("tabIndex","-1")}b=this.pane2button[a.id];b.set("checked",!0);dijit.setWaiState(b.focusNode,
"selected","true");this._currentChild=a;b.focusNode.setAttribute("tabIndex","0");a=dijit.byId(this.containerId);dijit.setWaiState(a.containerNode,"labelledby",b.id)}},onButtonClick:function(a){dijit.byId(this.containerId).selectChild(a)},onCloseButtonClick:function(a){dijit.byId(this.containerId).closeChild(a);this._currentChild&&(a=this.pane2button[this._currentChild.id])&&dijit.focus(a.focusNode||a.domNode)},adjacent:function(a){if(!this.isLeftToRight()&&(!this.tabPosition||/top|bottom/.test(this.tabPosition)))a=
!a;var b=this.getChildren(),c=dojo.indexOf(b,this.pane2button[this._currentChild.id]);return b[(c+(a?1:b.length-1))%b.length]},onkeypress:function(a){if(!this.disabled&&!a.altKey){var b=null;if(a.ctrlKey||!a._djpage){var c=dojo.keys;switch(a.charOrCode){case c.LEFT_ARROW:case c.UP_ARROW:a._djpage||(b=!1);break;case c.PAGE_UP:a.ctrlKey&&(b=!1);break;case c.RIGHT_ARROW:case c.DOWN_ARROW:a._djpage||(b=!0);break;case c.PAGE_DOWN:a.ctrlKey&&(b=!0);break;case c.HOME:case c.END:var d=this.getChildren();
if(d&&d.length)d[a.charOrCode==c.HOME?0:d.length-1].onClick();dojo.stopEvent(a);break;case c.DELETE:if(this._currentChild.closable)this.onCloseButtonClick(this._currentChild);dojo.stopEvent(a);break;default:if(a.ctrlKey)if(a.charOrCode===c.TAB)this.adjacent(!a.shiftKey).onClick(),dojo.stopEvent(a);else if(a.charOrCode=="w"){if(this._currentChild.closable)this.onCloseButtonClick(this._currentChild);dojo.stopEvent(a)}}b!==null&&(this.adjacent(b).onClick(),dojo.stopEvent(a))}}},onContainerKeyPress:function(a){a.e._djpage=
a.page;this.onkeypress(a.e)}}),dojo.declare("dijit.layout._StackButton",dijit.form.ToggleButton,{tabIndex:"-1",buildRendering:function(a){this.inherited(arguments);dijit.setWaiRole(this.focusNode||this.domNode,"tab")},onClick:function(){dijit.focus(this.focusNode)},onClickCloseButton:function(a){a.stopPropagation()}}));