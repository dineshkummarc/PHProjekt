/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


dojo._hasResource["dojo.io.script"]||(dojo._hasResource["dojo.io.script"]=!0,dojo.provide("dojo.io.script"),dojo.getObject("io",!0,dojo),function(){var e=dojo.isIE?"onreadystatechange":"load",f=/complete|loaded/;dojo.io.script={get:function(a){var c=this._makeScriptDeferred(a),b=c.ioArgs;dojo._ioAddQueryToUrl(b);dojo._ioNotifyStart(c);if(this._canAttach(b)){var d=this.attach(b.id,b.url,a.frameDoc);if(!b.jsonp&&!b.args.checkString)var g=dojo.connect(d,e,function(a){if(a.type=="load"||f.test(d.readyState))dojo.disconnect(g),
b.scriptLoaded=a})}dojo._ioWatch(c,this._validCheck,this._ioCheck,this._resHandle);return c},attach:function(a,c,b){var b=b||dojo.doc,d=b.createElement("script");d.type="text/javascript";d.src=c;d.id=a;d.charset="utf-8";return b.getElementsByTagName("head")[0].appendChild(d)},remove:function(a,c){dojo.destroy(dojo.byId(a,c));this["jsonp_"+a]&&delete this["jsonp_"+a]},_makeScriptDeferred:function(a){var c=dojo._ioSetArgs(a,this._deferredCancel,this._deferredOk,this._deferredError),b=c.ioArgs;b.id=
dojo._scopeName+"IoScript"+this._counter++;b.canDelete=!1;b.jsonp=a.callbackParamName||a.jsonp;if(b.jsonp)b.query=b.query||"",b.query.length>0&&(b.query+="&"),b.query+=b.jsonp+"="+(a.frameDoc?"parent.":"")+dojo._scopeName+".io.script.jsonp_"+b.id+"._jsonpCallback",b.frameDoc=a.frameDoc,b.canDelete=!0,c._jsonpCallback=this._jsonpCallback,this["jsonp_"+b.id]=c;return c},_deferredCancel:function(a){a.canceled=!0;a.ioArgs.canDelete&&dojo.io.script._addDeadScript(a.ioArgs)},_deferredOk:function(a){a=a.ioArgs;
a.canDelete&&dojo.io.script._addDeadScript(a);return a.json||a.scriptLoaded||a},_deferredError:function(a,c){c.ioArgs.canDelete&&(a.dojoType=="timeout"?dojo.io.script.remove(c.ioArgs.id,c.ioArgs.frameDoc):dojo.io.script._addDeadScript(c.ioArgs));console.log("dojo.io.script error",a);return a},_deadScripts:[],_counter:1,_addDeadScript:function(a){dojo.io.script._deadScripts.push({id:a.id,frameDoc:a.frameDoc});a.frameDoc=null},_validCheck:function(){var a=dojo.io.script,c=a._deadScripts;if(c&&c.length>
0){for(var b=0;b<c.length;b++)a.remove(c[b].id,c[b].frameDoc),c[b].frameDoc=null;dojo.io.script._deadScripts=[]}return!0},_ioCheck:function(a){a=a.ioArgs;return a.json||a.scriptLoaded&&!a.args.checkString?!0:(a=a.args.checkString)&&eval("typeof("+a+") != 'undefined'")?!0:!1},_resHandle:function(a){dojo.io.script._ioCheck(a)?a.callback(a):a.errback(Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(a){this.ioArgs.json=a}}}());